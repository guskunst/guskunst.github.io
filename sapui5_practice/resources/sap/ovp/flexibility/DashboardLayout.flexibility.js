sap.ui.define(["sap/ovp/changeHandler/HideCardContainer","sap/ovp/changeHandler/UnhideCardContainer","sap/ovp/changeHandler/UnhideControl","sap/ovp/changeHandler/RemoveCardContainer","sap/ui/dt/OverlayRegistry","sap/ui/core/ComponentContainer","sap/m/MessageToast","sap/ovp/cards/rta/SettingsDialogConstants","sap/ovp/cards/SettingsUtils","sap/ovp/cards/CommonUtils","sap/ovp/app/resources"],function(H,U,a,R,O,C,M,S,b,c,d){"use strict";return{"moveControls":{"changeHandler":"default","layers":{"CUSTOMER_BASE":true,"CUSTOMER":true,"USER":true}},"unhideControl":a,"unhideCardContainer":U,"hideCardContainer":H,"removeCardContainer":R,"editCardSettings":{changeHandler:{applyChange:function(o,e,p){var m=p.appComponent.getRootControl(),f=m.getController(),g=o.getContent(),h=g.newAppDescriptor,i=m.byId(h.id),j=f.getLayout(),l=j.getDashboardLayoutModel(),L=j.getDashboardLayoutUtil(),k=l.getCardById(h.id),n=L.calculateCardProperties(h.id),N=h.settings.defaultSpan&&h.settings.defaultSpan.rows,q=h.settings.defaultSpan&&h.settings.defaultSpan.cols,r=l.getColCount()+1,s=[],F=false;o.setRevertData(g.oldAppDescriptor);if(i){if(h.settings.tabs){var D=h.settings.selectedKey;if(!D||D<1){D=1;}S.tabFields.forEach(function(u){var v=h.settings.tabs[D-1][u];if(u!=='entitySet'||(u==='entitySet'&&v)){delete h.settings[u];}if(v){h.settings[u]=v;}});}if(typeof N==='number'){if(N===0){k.dashboardLayout.showOnlyHeader=true;N=Math.ceil((n.headerHeight+2*L.CARD_BORDER_PX)/L.getRowHeightPx());}else{k.dashboardLayout.showOnlyHeader=false;if(h.template==='sap.ovp.cards.list'||h.template==='sap.ovp.cards.table'){k.dashboardLayout.noOfItems=N;}}}if(q){if(k.dashboardLayout.column+q>r){k.dashboardLayout.maxColSpan=q;q=r-k.dashboardLayout.column;}F=true;}if(F){l._arrangeCards(k,{row:N,column:q},'resize',s);l._removeSpaceBeforeCard(s);L._positionCards(l.aCards);F=false;}var t=i.getComponentInstance();t.destroy();}f.recreateRTAClonedCard(h);return true;},revertChange:function(o,e,p){var m=p.appComponent.getRootControl(),f=m.getController(),g=o.getRevertData(),h=m.byId(g.id),i=f.getLayout(),l=i.getDashboardLayoutModel(),L=i.getDashboardLayoutUtil(),j=l.getCardById(g.id),k=g.settings.defaultSpan&&g.settings.defaultSpan.rowSpan,n=g.settings.defaultSpan&&g.settings.defaultSpan.colSpan,s=g.settings.defaultSpan&&g.settings.defaultSpan.showOnlyHeader,q=[];if(h){j.dashboardLayout.rowSpan=k;j.dashboardLayout.colSpan=n;j.dashboardLayout.showOnlyHeader=s;l._arrangeCards(j,{row:k,column:n},'resize',q);l._removeSpaceBeforeCard(q);L._positionCards(l.aCards);var r=h.getComponentInstance();r.destroy();}f.recreateRTAClonedCard(g);o.resetRevertData();return true;},completeChangeContent:function(o,s,p){return;}},layers:{"CUSTOMER_BASE":true,"CUSTOMER":true,"USER":true}},"newCardSettings":{changeHandler:{applyChange:function(o,e,p){var m=p.appComponent.getRootControl(),f=m.getController(),g=o.getContent();o.setRevertData(g.id);var n=new C(m.getId()+"--"+g.id),A=p.appComponent,u=f.getUIModel(),h=u.getProperty("/cards"),j=f.getLayout(),l=j.getDashboardLayoutUtil(),L=j.getDashboardLayoutModel(),N=(g.id.indexOf("newStaticLinkListCard_N")!==-1)&&!b.checkClonedCard(g.id),k=(g.id.indexOf("newKPICard_N")!==-1)&&!b.checkClonedCard(g.id),q=(g.id.indexOf("newCard_N")!==-1)&&!b.checkClonedCard(g.id);if(k){var s=g.settings.selectedKPI,r=new sap.ui.model.odata.v2.ODataModel(s.ODataURI,{'annotationURI':s.ModelURI,'defaultCountMode':sap.ui.model.odata.CountMode.None}),t=g.model;if(g.settings["sAnnoKey"]){b.setDataSources(g.settings["sAnnoKey"],s.ModelURI);}m.setModel(r,t);A.setModel(r,t);}g.settings.baseUrl=f._getBaseUrl();if(N||k||q){g.settings.newCard=true;L._setCardSpanFromDefault(g);g.dashboardLayout.row=1;g.dashboardLayout.column=1;}else{g.settings.cloneCard=true;}var I=-1,i;for(i=0;i<h.length;i++){if(g.id.lastIndexOf(c._getLayerNamespace()+"."+h[i].id,0)===0){I=i;var v=L.getCardById(h[i].id);g.dashboardLayout=jQuery.extend(true,{},v.dashboardLayout);var w=g.dashboardLayout.column+g.dashboardLayout.colSpan;g.dashboardLayout.column=w<L.getColCount()?w:1;break;}}h.splice(I+1,0,g);l.getCards().splice(I+1,0,g);u.setProperty("/cards",h);j.insertContent(n,I+1);setTimeout(function(){var x=O.getOverlay(n);x.setSelected(true);x.focus();var y=(N||k||q)?d.getText("OVP_KEYUSER_TOAST_MESSAGE_FOR_NEW"):d.getText("OVP_KEYUSER_TOAST_MESSAGE_FOR_CLONE");M.show(y,{duration:10000});},0);f.recreateRTAClonedCard(g);return true;},revertChange:function(o,e,p){var m=p.appComponent.getRootControl(),A=p.appComponent,f=m.getController(),s=o.getRevertData(),g=o.getContent();var h=m.byId(s),u=f.getUIModel(),k=u.getProperty("/cards"),l=f.getLayout(),L=l.getDashboardLayoutUtil(),n=l.getDashboardLayoutModel(),q=L.getCards();var I=-1,i,j,r=-1;for(i=0;i<k.length;i++){if(s===k[i].id){I=i;break;}}k.splice(I,1);for(j=0;j<q.length;j++){if(s===q[j].id){r=j;break;}}q.splice(r,1);n._removeSpaceBeforeCard();u.setProperty("/cards",k);if(h){var t=h.getComponentInstance(),v=t.getComponentData(),N=(v.cardId.indexOf("newKPICard_N")!==-1)&&!b.checkClonedCard(s);if(N){var w=v.modelName,x=m.getModel(w);x.destroy();if(g.settings["sAnnoKey"]){b.removeDataSources(g.settings["sAnnoKey"]);}m.setModel(null,w);A.setModel(null,w);}t.destroy();}l.removeContent(I);h.destroy();o.resetRevertData();return true;},completeChangeContent:function(o,s,p){return;}},layers:{"CUSTOMER_BASE":true,"CUSTOMER":true,"USER":true}},"dragAndDropUI":{changeHandler:{applyChange:function(o,p,P){var m=P.appComponent.getRootControl().getController(),e=o.getContent(),f=m.getLayout(),l=f.getDashboardLayoutUtil(),L=f.getDashboardLayoutModel(),g=L.getCardById(e.cardId),s='C'+L.getColCount(),h=[];o.setRevertData(e);L._arrangeCards(g,{row:e.dashboardLayout[s].row,column:e.dashboardLayout[s].column},'drag',h);L._removeSpaceBeforeCard(h);l._positionCards(L.aCards);return true;},revertChange:function(o,e,p){var m=p.appComponent.getRootControl().getController(),f=o.getContent(),g=m.getLayout(),l=g.getDashboardLayoutUtil(),L=g.getDashboardLayoutModel(),h=L.getCardById(f.cardId),s='C'+L.getColCount(),i=[];L._arrangeCards(h,{row:f.dashboardLayout[s].oldRow,column:f.dashboardLayout[s].oldColumn},'drag',i);if(f.dashboardLayout[s].oldColSpan){L._arrangeCards(h,{row:f.dashboardLayout[s].rowSpan,column:f.dashboardLayout[s].oldColSpan},'resize',i);}L._removeSpaceBeforeCard(i);l._positionCards(L.aCards);o.resetRevertData();return true;},completeChangeContent:function(o,s,p){return;}},layers:{"CUSTOMER_BASE":true,"CUSTOMER":true,"USER":true}},"manageCardsForDashboardLayout":{changeHandler:{applyChange:function(o,p,P){var m=P.appComponent.getRootControl().getController();m.storeIncomingDeltaChanges(o.getContent());return true;},completeChangeContent:function(o,s,p){o.setContent(s.content);return;},revertChange:function(o,e,p){return;}},layers:{"USER":true}},"viewSwitch":{changeHandler:{applyChange:function(o,p,P){var m=P.appComponent.getRootControl().getController();m.appendIncomingDeltaChange(o);return true;},completeChangeContent:function(o,s,p){return;},revertChange:function(o,e,p){return;}},layers:{"CUSTOMER_BASE":true,"CUSTOMER":true,"USER":true}},"visibility":{changeHandler:{applyChange:function(o,p,P){var m=P.appComponent.getRootControl().getController();m.appendIncomingDeltaChange(o);return true;},completeChangeContent:function(o,s,p){return;},revertChange:function(o,e,p){return;}},layers:{"USER":true}},"dragOrResize":{changeHandler:{applyChange:function(o,p,P){var m=P.appComponent.getRootControl().getController();m.appendIncomingDeltaChange(o);return true;},completeChangeContent:function(o,s,p){return;},revertChange:function(o,e,p){return;}},layers:{"VENDOR":true,"CUSTOMER_BASE":true,"CUSTOMER":true,"USER":true}},"manageCardsForEasyScanLayout":{changeHandler:{applyChange:function(o,p,P){return true;},completeChangeContent:function(o,s,p){o.setContent(s.content);return;},revertChange:function(o,e,p){return;}},layers:{"USER":true}}};},true);
