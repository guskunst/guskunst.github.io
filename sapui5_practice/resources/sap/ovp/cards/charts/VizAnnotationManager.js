sap.ui.define(["jquery.sap.global","sap/ovp/cards/charts/Utils","sap/ui/model/odata/CountMode","sap/ovp/cards/AnnotationHelper","sap/ui/core/format/NumberFormat","sap/ui/core/format/DateFormat","sap/viz/ui5/api/env/Format","sap/viz/ui5/controls/VizTooltip","sap/ovp/cards/CommonUtils","sap/ovp/cards/OVPCardAsAPIUtils","sap/viz/ui5/data/DimensionDefinition","sap/viz/ui5/data/MeasureDefinition","sap/viz/ui5/controls/common/feeds/FeedItem","sap/ui/core/Element","sap/ovp/app/resources","sap/ovp/app/OVPUtils"],function(q,U,C,a,N,D,V,b,c,O,e,M,F,g,h,l){"use strict";var n={LABEL_KEY:"sap:label",LABEL_KEY_V4:"com.sap.vocabularies.Common.v1.Label",TEXT_KEY:"sap:text",TEXT_KEY_V4:"com.sap.vocabularies.Common.v1.Text",TEXT_ARRANGEMENT_ANNO:"com.sap.vocabularies.UI.v1.TextArrangement",TYPE_KEY:"type",DISPLAY_FORMAT_KEY:"sap:display-format",SEMANTICS_KEY:"sap:semantics",UNIT_KEY:"sap:unit",UNIT_KEY_V4_ISOCurrency:"Org.OData.Measures.V1.ISOCurrency",UNIT_KEY_V4_Unit:"Org.OData.Measures.V1.Unit",CURRENCY_CODE:"currency-code",NAME_KEY:"name",NAME_CAP_KEY:"Name",EDM_TYPE:"type",EDM_INT32:"Edm.Int32",EDM_INT64:"Edm.Int64",SCATTER_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Scatter",BUBBLE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Bubble",LINE_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Line",COLUMNSTACKED_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/ColumnStacked",VERTICALBULLET_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/VerticalBullet",COLUMN_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Column",COMBINATION_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Combination",DONUT_CHARTTYPE:"com.sap.vocabularies.UI.v1.ChartType/Donut"};var o={CARD_WARNING:"OVP-AC: Analytic card: Warning: ",CARD_ERROR:"OVP-AC: Analytic card Error: ",DATA_ANNO_ERROR:"OVP-AC: Analytic card Error:",CARD_ANNO_ERROR:"OVP-AC: Analytic card: Error ",CHART_ANNO_ERROR:"OVP-AC: Analytic card: Error ",INVALID_CHART_ANNO:"OVP-AC: Analytic Cards: Invalid Chart Annotation.",ANALYTICAL_CONFIG_ERROR:"Analytic card configuration error",CACHING_ERROR:"no model defined while caching OdataMetaData",INVALID_MAXITEMS:"maxItems is Invalid. ",NO_DATASET:"OVP-AC: Analytic Cards: Could not obtain dataset.",SORTORDER_WARNING:"SortOrder is present in PresentationVariant, but it is empty or not well formed.",BOOLEAN_ERROR:"Boolean value is not present in PresentationVariant.",IS_MANDATORY:"is mandatory.",IS_MISSING:"is missing.",NOT_WELL_FORMED:"is not found or not well formed)",MISSING_CHARTTYPE:"Missing ChartType in ",CHART_ANNO:"Chart Annotation.",DATA_ANNO:"Data Annotation",CARD_ANNO:"card annotation.",CARD_CONFIG:"card configuration.",CARD_CONFIG_ERROR:"Could not obtain configuration for ",CARD_CONTAINER_ERROR:"Could not obtain card container. ",DATA_UNAVAIALABLE:"No data available.",CONFIG_LOAD_ERROR:"Failed to load config.json. Reason: ",INVALID_CHARTTYPE:"Invalid ChartType given for ",INVALID_CONFIG:"No valid configuration given for ",CONFIG_JSON:"in config.json",ENTER_INTEGER:"Please enter an Integer.",NO_CARD_MODEL:"Could not obtain Cards model.",ANNO_REF:"com.sap.vocabularies.UI.v1 annotation.",INVALID_REDUNDANT:"Invalid/redundant role configured for ",CHART_IS:"chart is/are ",CARD_CONFIG_JSON:"card from config.json",ALLOWED_ROLES:"Allowed role(s) for ",DIMENSIONS_MANDATORY:"DimensionAttributes are mandatory.",MEASURES_MANDATORY:"MeasureAttributes are mandatory.",CARD_LEAST:"card: Enter at least ",CARD_MOST:"card: Enter at most ",FEEDS:"feed(s).",MIN_FEEDS:"Minimum number of feeds required for ",FEEDS_OBTAINED:"card is not configured. Obtained ",FEEDS_REQUIRED:"feed(s), Required: ",INVALID_SEMANTIC_MEASURES:"More than one measure is being semantically coloured",INVALID_IMPROVEMENT_DIR:"No Improvement Direction Found",INVALID_CRITICALITY:"Invalid criticality values",INVALID_DIMMEAS:"Invalid number of Measures or Dimensions",INVALID_FORECAST:"Invalid/Redundant Datapoint or Forecast measure",INVALID_TARGET:"Invalid/Redundant Datapoint or Target measure",ERROR_MISSING_AXISSCALES:"Minimum and Maximum values are mandatory for AxisScale MinMax to work"};var G;function p(f,j,v,x,v1,w1,x1){var y1="{";if(!f||!f.getSetting('ovpCardProperties')){q.sap.log.error(o.ANALYTICAL_CONFIG_ERROR);y1+="}";return y1;}var z1=f.getSetting("dataModel");var A1;if(x1&&x1.EnumMember){A1=x1.EnumMember.split("/");if(A1&&(A1[1]==='Donut')){z1.setDefaultCountMode(C.Inline);}if(A1&&(A1[1]!='Donut')&&(v1===undefined)){return null;}}var B1=[];var C1=[];var D1=[];var E1=[];var F1=[];var G1=[];var H1=[];var I1=v&&v.Parameters;var J1=x&&x.SortOrder;var K1=x&&x.MaxItems,L1=null;var M1;var N1;var O1;var P1=null;var Q1=n.TEXT_KEY;var R1=n.TEXT_KEY_V4;var S1=n.UNIT_KEY;var T1=n.UNIT_KEY_V4_ISOCurrency;var U1=n.UNIT_KEY_V4_Unit;var V1={};if(K1){L1=K1.Int32?K1.Int32:K1.Int;}if(L1){if(L1==="0"){q.sap.log.error("OVP-AC: Analytic card Error: maxItems is configured as "+L1);y1+="}";return y1;}if(!/^\d+$/.test(L1)){q.sap.log.error("OVP-AC: Analytic card Error: maxItems is Invalid. "+"Please enter an Integer.");y1+="}";return y1;}}var W1=f.getSetting('ovpCardProperties'),X1=W1.getProperty('/parameters');var Y1=W1.getProperty("/metaModel");I1=I1||!!X1;if(I1){var Z1=a.resolveParameterizedEntitySet(z1,j,v,X1);y1+="path: '"+Z1+"'";}else{y1+="path: '/"+j.name+"'";}var $1=[];P1=f.getSetting('ovpCardProperties').getProperty("/entitySet");if(!z1||!P1){return y1;}var _1=j1(z1,P1);var a2=f.getSetting('ovpCardProperties').getProperty("/cardLayout");var b2=1,c2;var d2=P();var e2;var f2;if(v1&&a2&&a2.colSpan&&a2.colSpan>1){c2=a2.colSpan-b2;for(var g2 in d2){if((f2=d2[g2].reference)&&d2[f2]){var h2=q.extend(true,{},d2[f2]);d2[g2]=h2;}if(g2===A1[1]||(d2[g2].time&&d2[g2].time.type===A1[1].toLowerCase())){e2=d2[g2];break;}}var i2=Q(v1,e2,z1,P1);if(i2){e2=e2.time;}else{e2=e2.default;}var j2=f.getSetting('ovpCardProperties').getProperty("/dataStep");if(!j2){if(e2.resize&&e2.resize.hasOwnProperty("dataStep")&&!isNaN(e2.resize.dataStep)){j2=e2.resize.dataStep;}}j2=parseInt(j2,10);if(c2>0&&j2&&!isNaN(j2)){L1=parseInt(L1,10)+j2*c2;}}if(v){var W1=f.getSetting('ovpCardProperties');$1=a.getFilters(W1,v);}if($1.length>0){y1+=", filters: "+JSON.stringify($1);}if(J1){var k2=x.SortOrder;if(!k2.length){k2=U.getSortAnnotationCollection(z1,x,j);}if(k2.length<1){q.sap.log.warning(o.CARD_WARNING+o.SORTORDER_WARNING);}else{var l2="";var m2;var n2;var o2;for(var i=0;i<k2.length;i++){m2=k2[i];o2=m2.Property.PropertyPath;H1.push(o2);if(typeof m2.Descending==="undefined"){n2='true';}else{var _=m2.Descending.Bool||m2.Descending.Boolean;if(!_){q.sap.log.warning(o.CARD_WARNING+o.BOOLEAN_ERROR);n2='true';}else{n2=_.toLowerCase()==='true'?'true':'false';}}l2=l2+"{path: '"+o2+"',descending: "+n2+"},";}y1+=", sorter: ["+l2.substring(0,l2.length-1)+"]";}}var p2=f.getSetting("ovpCardProperties").getProperty("/entityType");q.each(w1,function(i,m){M1=m.Measure.PropertyPath;if(m.DataPoint&&m.DataPoint.AnnotationPath){var d=p2[m.DataPoint.AnnotationPath.substring(1)];if(d.ForecastValue&&(d.ForecastValue.PropertyPath||d.ForecastValue.Path)){var r=(d.ForecastValue.PropertyPath||d.ForecastValue.Path);F1.push((d.ForecastValue.PropertyPath||d.ForecastValue.Path));if(_1&&_1[r]){var s;if(_1[r][T1]){s=_1[r][T1].Path?_1[r][T1].Path:undefined;}else if(_1[r][U1]){s=_1[r][U1].Path?_1[r][U1].Path:undefined;}else if(_1[r][S1]){s=_1[r][S1];}if(s){if(q.inArray(s,F1)===-1){F1.push(s);}}}}if(d.TargetValue&&(d.TargetValue.PropertyPath||d.TargetValue.Path)){var u2=(d.TargetValue.PropertyPath||d.TargetValue.Path);F1.push((d.TargetValue.PropertyPath||d.TargetValue.Path));if(_1&&_1[u2]){var s;if(_1[u2][T1]){s=_1[u2][T1].Path?_1[u2][T1].Path:undefined;}else if(_1[u2][U1]){s=_1[u2][U1].Path?_1[u2][U1].Path:undefined;}else if(_1[u2][S1]){s=_1[u2][S1];}if(s){if(q.inArray(s,F1)===-1){F1.push(s);}}}}}F1.push(M1);if(_1&&_1[M1]){if(_1[M1][R1]){if(_1[M1][R1].String&&M1!=_1[M1][R1].String){F1.push(_1[M1][R1].String?_1[M1][R1].String:M1);}else if(_1[M1][R1].Path&&M1!=_1[M1][R1].Path){F1.push(_1[M1][R1].Path?_1[M1][R1].Path:M1);}}else if(_1[M1][Q1]&&M1!=_1[M1][Q1]){F1.push(_1[M1][Q1]?_1[M1][Q1]:M1);}}if(_1&&_1[M1]){var s;if(_1[M1][T1]){s=_1[M1][T1].Path?_1[M1][T1].Path:undefined;}else if(_1[M1][U1]){s=_1[M1][U1].Path?_1[M1][U1].Path:undefined;}else if(_1[M1][S1]){s=_1[M1][S1];}if(s){if(q.inArray(s,F1)===-1){F1.push(s);}}}});q.each(v1,function(i,d){M1=d.Dimension.PropertyPath;B1.push(M1);if(_1&&_1[M1]){if(_1[M1][R1]){if(_1[M1][R1].String&&M1!=_1[M1][R1].String){B1.push(_1[M1][R1].String?_1[M1][R1].String:M1);}else if(_1[M1][R1].Path&&M1!=_1[M1][R1].Path){O1=_1[M1][R1].Path;var m=O1.split("/");if(m.length>1){N1=t(Y1,p2,O1);if(N1!==""){B1.push(O1);C1.push(N1);E1=u(Y1,p2,O1);if(E1.length>0){D1=D1.concat(E1);}}}else{B1.push(O1?O1:M1);}}}else if(_1[M1][Q1]&&M1!=_1[M1][Q1]){B1.push(_1[M1][Q1]?_1[M1][Q1]:M1);}}});if(D1.length>0){var k=0;while(k<D1.length){if(B1.indexOf(D1[k])!==-1){D1.splice(k,1);}else{k++;}}}if(F1.length>0){q.each(F1,function(i,m){V1[m]=true;});}if(B1.length>0){q.each(B1,function(i,d){V1[d]=true;});}y1+=", parameters: {select:'"+[].concat(B1,F1).join(",");var q2=Y1.getODataEntityType(j.entityType);if(q2){var r2=a.getRequestFields(x);if(r2&&r2.length>0){q.each(r2,function(i,r){if(!V1.hasOwnProperty(r)){V1[r]=true;G1.push(r);}});if(G1.length>0){y1+=","+G1.join(",");}}}if(H1.length>0){var s2=[];q.each(H1,function(i,s){if(!V1.hasOwnProperty(s)){s2.push(s);}});if(s2.length>0){y1+=","+s2.join(",");}}if(C1.length>0){y1+="'"+","+" expand:'"+C1.join(',');}var t2=a.checkFilterPreference(f.getSetting("ovpCardProperties"));if(t2){y1+="', custom: {cardId: '"+f.getSetting("ovpCardProperties").getProperty("/cardId")+"'}}";}else{y1+="'}";}if(A1&&(A1[1]==='Donut')&&(v1===undefined)){y1+=", length: 1";}else if(A1&&(A1[1]==='Donut')&&(v1)&&L1){y1+=", length: "+(parseInt(L1,10)+1);}else if(L1){y1+=", length: "+L1;}y1+="}";return y1;}p.requiresIContext=true;function t(m,d,s){var f="";var j=s.split("/");if(j.length>1){for(var i=0;i<(j.length-1);i++){var k=m.getODataAssociationEnd(d,j[i]);if(k){d=m.getODataEntityType(k.type);if(f){f=f+"/";}f=f+j[i];}else{return f;}}}return f;}function u(m,d,s){var f=[];var k=[];var r;var v=s.split("/");if(v.length>1){for(var i=0;i<(v.length-1);i++){var x=m.getODataAssociationEnd(d,v[i]);if(x){d=m.getODataEntityType(x.type);if(d){k=d&&d.key&&d.key.propertyRef;for(var j=0;j<k.length;j++){r=v[i]+"/"+k[j].name;f.push(r);}}}}}return f;}function w(m,d){var f=false;var r;if(m.DataPoint&&m.DataPoint.AnnotationPath){var i=d[m.DataPoint.AnnotationPath.substring(1)];if(i&&i.ForecastValue&&(i.ForecastValue.PropertyPath||i.ForecastValue.Path)){f=true;r=m;}}if(f===true){return r;}else{q.sap.log.warning(o.CARD_WARNING+o.INVALID_FORECAST);return undefined;}}function y(m,d){var f=false;var r;if(m.DataPoint&&m.DataPoint.AnnotationPath){var i=d[m.DataPoint.AnnotationPath.substring(1)];if(i&&i.TargetValue&&(i.TargetValue.PropertyPath||i.TargetValue.Path)){f=true;r=m;}}if(f===true){return r;}else{q.sap.log.warning(o.CARD_WARNING+o.INVALID_TARGET);return undefined;}}function z(m,d){var f;q.each(d,function(i,v){if(v.name===m){if(v["com.sap.vocabularies.Common.v1.Label"]){f=v["com.sap.vocabularies.Common.v1.Label"].String?v["com.sap.vocabularies.Common.v1.Label"].String:v["com.sap.vocabularies.Common.v1.Label"].Path;}else if(v["sap:label"]){f=v["sap:label"];}return false;}});return f;}function A(f,d){var j=true;if(d==="line"||d==="column"){q.each(f,function(i,v){if((v.getUid()==='valueAxis')||(v.getUid()==='categoryAxis')){if(v.getValues().length!=1){j=false;q.sap.log.warning(o.CARD_WARNING+o.INVALID_DIMMEAS);return false;}}});}else if(d==="vertical_bullet"){q.each(f,function(i,v){if((v.getUid()==='actualValues')||(v.getUid()==='categoryAxis')){if(v.getValues().length!=1){j=false;q.sap.log.warning(o.CARD_WARNING+o.INVALID_DIMMEAS);return false;}}});}if(j===true){return true;}}function B(m,s,v){var d=n.TYPE_KEY;if(!m||!m[s]||!m[s][d]){return v;}var f=["Edm.Int","Edmt.Int16","Edm.Int32","Edm.Int64","Edm.Decimal"];var i=m[s][d];if(q.inArray(i,f)!==-1){return Number(v);}return v;}function E(d){if(d){return d;}return"";}function H(){var d={locale:function(){},format:function(v,f){var i="";if(f){i=f.split('/');}if(i.length>0){var m,s;if(i.length===3){m=Number(i[1]);s=Number(i[2]);if(isNaN(m)){m=-1;}if(isNaN(s)){s=0;}}else{m=2;s=0;}if(i[0]==="axisFormatter"||(i[0]==="ShortFloat")){var j;j=N.getFloatInstance({style:'short',minFractionDigits:m,maxFractionDigits:m});if(i[0]==="ShortFloat"){j=N.getFloatInstance({style:'short',minFractionDigits:m,maxFractionDigits:m});}if(m===-1){j=N.getFloatInstance({style:'short'});}return j.format(Number(v));}else if(i[0]==="tooltipNoScaleFormatter"){var k=N.getFloatInstance({style:'short',currencyCode:false,shortRefNumber:s,showScale:false,minFractionDigits:m,maxFractionDigits:m});if(m===-1){k=N.getFloatInstance({minFractionDigits:0,currencyCode:false});}return k.format(Number(v));}else if(i[0]==="CURR"){var r=N.getCurrencyInstance({style:'short',currencyCode:false,minFractionDigits:m,maxFractionDigits:m});if(m===-1){r=N.getCurrencyInstance({style:'short',currencyCode:false});}return r.format(Number(v));}else if(i[0].search("%")!==-1){var x=N.getPercentInstance({style:'short',minFractionDigits:m,maxFractionDigits:m});if(m===-1){x=N.getPercentInstance({style:'short',minFractionDigits:1,maxFractionDigits:1});}v=x.format(Number(v));return v;}}if(v.constructor===Date){var v1=D.getDateTimeInstance({pattern:f});if(f==="YearMonthDay"){v1=D.getDateInstance({style:"medium"});}if(f==="YearMonth"){v1=D.getDateTimeInstance({format:"YYYYMMM"});}if(f==="YearQuarter"||f==="Quarter"){v1=D.getDateTimeInstance({format:"YYYYQ"});}if(f==="YearWeek"||f==="Week"){v1=D.getDateTimeInstance({format:"YYYYWW"});}v=v1.format(new Date(v));}return v;}};V.numericFormatter(d);}function I(v,f){var d=v.getModel();var k=v.getVizType();if(k!="line"&&k!="bubble"){return;}if(!f){f=k==="line"?"categoryAxis":"valueAxis";}var m=v.getModel('ovpCardProperties').getProperty("/entitySet");if(!d||!m){return;}var r=j1(d,m);var s=v.getFeeds();for(var i=0;i<s.length;i++){if(s[i].getUid()===f){var x=s[i].getValues();if(!x){return;}for(var j=0;j<x.length;j++){if(r[x[j][n.TYPE_KEY]]!="Edm.DateTime"){return;}}v.setVizProperties({categoryAxis:{title:{visible:false}}});return;}}}function J(d,f,i,m,j,k){m=typeof m==="undefined"?false:m;var r=false;var s;if(!d&&m){q.sap.log.error(j+o.CARD_ERROR+i+o.IS_MANDATORY);return r;}if(!d){q.sap.log.warning(j+o.CARD_WARNING+i+o.IS_MISSING);r=true;return r;}s=f[d];if(!s||typeof s!=="object"){var v=m?q.sap.log.error:q.sap.log.warning;v(j+o.CARD_ERROR+"in "+i+". ("+d+" "+o.NOT_WELL_FORMED);return r;}if(k&&k==="sap.ovp.cards.charts.analytical.analyticalChart"&&i==="Chart Annotation"&&(!s.ChartType||!s.ChartType.EnumMember)){q.sap.log.error(j+o.CARD_ERROR+o.MISSING_CHARTTYPE+o.CHART_ANNO);return r;}r=true;return r;}function K(d){var r=false;if(!d){return r;}var s;var f;var i;var j;var k;var m;var v;var x="";var v1;var w1=d.getView();if(w1){x="["+w1.getId()+"] ";}if(!(v1=d.getCardPropertiesModel())){q.sap.log.error(x+o.CARD_ERROR+"in "+o.CARD_CONFIG+o.NO_CARD_MODEL);return r;}v=v1.getProperty("/entityType");if(!v||q.isEmptyObject(v)){q.sap.log.error(x+o.CARD_ERROR+"in "+o.CARD_ANNO);return r;}s=v1.getProperty("/selectionAnnotationPath");f=v1.getProperty("/chartAnnotationPath");j=v1.getProperty("/presentationAnnotationPath");k=v1.getProperty("/identificationAnnotationPath");m=v1.getProperty("/dataPointAnnotationPath");i=v1.getProperty("/contentFragment");r=J(s,v,"Selection Variant",false,x);r=J(f,v,"Chart Annotation",true,x,i)&&r;r=J(j,v,"Presentation Variant",false,x)&&r;r=J(k,v,"Identification Annotation",true,x)&&r;r=J(m,v,"Data Point",false,x)&&r;return r;}function L(d,f,v){}function P(d){return U.getConfig(d);}function Q(d,f,i,j){var r=false;var m;var k;var s;var v;var x;var v1;if(!f.time||q.isEmptyObject(f.time)){return r;}if(!d){return r;}for(var w1=0;w1<d.length;w1++){if(!d[w1].Dimension||!(k=d[w1].Dimension.PropertyPath)){return r;}m=j1(i,j);if(m&&m[k]){s=m[k][n.TYPE_KEY];v=m[k][n.DISPLAY_FORMAT_KEY];x=m[k][n.SEMANTICS_KEY];v1=m[k]["com.sap.vocabularies.Common.v1.IsCalendarYear"];}if(s&&s.lastIndexOf("Edm.Date",0)===0){if(s.toLowerCase()==="edm.datetime"){if(v&&v.toLowerCase()==="date"){r=true;}}else{r=true;}}if(s==="Edm.String"&&(v1||x&&x.lastIndexOf("year",0)===0)){r=true;}if(r){d.unshift(d.splice(w1,1)[0]);break;}}return r;}function R(i,d,f){var r="";var j=P(d);var k,m;if(!j){return r;}r=j.default.type;k=i.getSetting("dataModel");m=i.getSetting('ovpCardProperties').getProperty("/entitySet");if(Q(f,j,k,m)){r=j.time.type;}return r;}R.requiresIContext=true;function S(d,j,k){if(!d.length){return;}var m=k==="dimension"?"Dimension":"Measure";var r=[];q.each(d,function(i,v){if(!v||!v[m]||!v[m].PropertyPath){q.sap.log.error(o.INVALID_CHART_ANNO);return false;}r.push(v[m].PropertyPath);});var s=q.map(j.feeds,function(f){if(f.type===k){if(f.role){return f.role.split("|");}return[];}});s=q.grep(s,function(f,i){return q.inArray(f,s)===i;}).join(", ");q.sap.log.error(o.CARD_ERROR+o.INVALID_REDUNDANT+k+"(s) "+r.join(", ")+". "+o.ALLOWED_ROLES+j.type+o.CHART_IS+s);}function T(v,i){var d;if(v){if(v.String){d=v.String;}else if(v.Boolean||v.Bool){d=W(v);}else{d=X(v,i);}}return d;}function W(v,d){if(v&&v.Boolean){if(v.Boolean.toLowerCase()==="true"){return true;}else if(v.Boolean.toLowerCase()==="false"){return false;}}else if(v&&v.Bool){if(v.Bool.toLowerCase()==="true"){return true;}else if(v.Bool.toLowerCase()==="false"){return false;}}return d;}function X(v,i){var d;if(v){if(v.String){d=Number(v.String);}else if(v.Int){d=Number(v.Int);}else if(v.Decimal){d=Number(v.Decimal);}else if(v.Double){d=Number(v.Double);}else if(v.Single){d=Number(v.Single);}}if(i){var f=N.getFloatInstance({style:'short',minFractionDigits:2,maxFractionDigits:2});if(d){d=f.format(Number(d));}}return d;}function Y(i,d){function $(v1){if(v1){if(v1.Path){return"{path:'"+v1.Path+"'}";}else{return T(v1);}}else{return"";}}var v=i[i.measureNames];if(d&&d.CriticalityCalculation&&d.CriticalityCalculation.ImprovementDirection){var s=d.CriticalityCalculation.ImprovementDirection.EnumMember;var f=$(d.CriticalityCalculation.DeviationRangeLowValue);var j=$(d.CriticalityCalculation.DeviationRangeHighValue);var k=$(d.CriticalityCalculation.ToleranceRangeLowValue);var m=$(d.CriticalityCalculation.ToleranceRangeHighValue);return a._calculateCriticalityState(v,s,f,j,k,m,a.criticalityConstants.StateValues);}else{var r=d.Criticality.EnumMember;var x=r?r.split("/"):[];if(x){return x[1];}}}function Z(d,m,f){var j,k;q.each(m,function(i,v){if(v["com.sap.vocabularies.Common.v1.Label"]&&v["com.sap.vocabularies.Common.v1.Label"].String===d.measureNames){j=v.name;return false;}else if(v["com.sap.vocabularies.Common.v1.Label"]&&v["com.sap.vocabularies.Common.v1.Label"].Path===d.measureNames){j=v.name;return false;}else if(v["sap:label"]===d.measureNames){j=v.name;return false;}});q.each(f,function(i,v){if(v.Measure.PropertyPath===j){if(!v.DataPoint||!v.DataPoint.AnnotationPath){return false;}k=v.DataPoint.AnnotationPath;return false;}});return k;}function $(i,d){if(i){if(i.Path){return i.Path;}else{return T(i,d);}}else{return"";}}function _(m,d){function f(s,i){return s&&s.indexOf(i,s.length-i.length)!==-1;}var j=false;q.each(m,function(i,v){if(v.DataPoint&&v.DataPoint.AnnotationPath){var k=d[v.DataPoint.AnnotationPath.substring(1)];if(k&&k.CriticalityCalculation&&k.CriticalityCalculation.ImprovementDirection&&k.CriticalityCalculation.ImprovementDirection.EnumMember){var s=k.CriticalityCalculation.ImprovementDirection.EnumMember;var r=$(k.CriticalityCalculation.DeviationRangeLowValue);var x=$(k.CriticalityCalculation.DeviationRangeHighValue);var v1=$(k.CriticalityCalculation.ToleranceRangeLowValue);var w1=$(k.CriticalityCalculation.ToleranceRangeHighValue);if(f(s,"Minimize")||f(s,"Minimizing")){if(w1&&x){j=true;return false;}else{q.sap.log.warning(o.CARD_WARNING+o.INVALID_CRITICALITY);}}else if(f(s,"Maximize")||f(s,"Maximizing")){if(v1&&r){j=true;return false;}else{q.sap.log.warning(o.CARD_WARNING+o.INVALID_CRITICALITY);}}else if(f(s,"Target")){if(v1&&r&&w1&&x){j=true;return false;}else{q.sap.log.warning(o.CARD_WARNING+o.INVALID_CRITICALITY);}}}else if(k&&k.Criticality){j=true;return false;}else{q.sap.log.warning(o.CARD_WARNING+o.INVALID_IMPROVEMENT_DIR);}}});if(j===true&&m.length>1){q.sap.log.warning(o.CARD_WARNING+o.INVALID_SEMANTIC_MEASURES);}return j;}function a1(m,d,f,v){function i(A1,B1){return A1&&A1.indexOf(B1,A1.length-B1.length)!==-1;}var r=[null,null];var j=true;var k=m.Measure.PropertyPath;if(f[k]){if(f[k][n.LABEL_KEY_V4]){k=i1(f[k][n.LABEL_KEY_V4].String?f[k][n.LABEL_KEY_V4].String:f[k][n.LABEL_KEY_V4].Path,v,f);}else if(f[k][n.LABEL_KEY]){k=f[k][n.LABEL_KEY];}else if(k){k=k;}}var s=m.DataPoint.AnnotationPath;var x=d[s.substring(1)];if(!x.CriticalityCalculation||!x.CriticalityCalculation.ImprovementDirection||!x.CriticalityCalculation.ImprovementDirection.EnumMember){return r;}var v1=x.CriticalityCalculation.ImprovementDirection.EnumMember;var w1=$(x.CriticalityCalculation.DeviationRangeLowValue,j);var x1=$(x.CriticalityCalculation.DeviationRangeHighValue,j);var y1=$(x.CriticalityCalculation.ToleranceRangeLowValue,j);var z1=$(x.CriticalityCalculation.ToleranceRangeHighValue,j);if(i(v1,"Minimize")||i(v1,"Minimizing")){if(z1&&x1){r[0]=h.getText("MINIMIZING_LESS",[k,z1]);r[1]=h.getText("MINIMIZING_MORE",[k,x1]);r[2]=h.getText("MINIMIZING_CRITICAL",[z1,k,x1]);}}else if(i(v1,"Maximize")||i(v1,"Maximizing")){if(y1&&w1){r[0]=h.getText("MAXIMISING_MORE",[k,y1]);r[1]=h.getText("MAXIMISING_LESS",[k,w1]);r[2]=h.getText("MAXIMIZING_CRITICAL",[w1,k,y1]);}}else if(i(v1,"Target")){if(y1&&w1&&z1&&x1){r[0]=h.getText("TARGET_BETWEEN",[y1,k,z1]);r[1]=h.getText("TARGET_AROUND",[k,w1,x1]);r[2]=h.getText("TARGET_CRITICAL",[w1,k,y1,z1,x1]);}}return r;}function b1(m,v,d){if(v&&v.DataPoint&&v.DataPoint.AnnotationPath){var f=d[v.DataPoint.AnnotationPath.substring(1)];var i,j;if(f&&f.ValueFormat){i=f.ValueFormat;}else if(f&&f.NumberFormat){i=f.NumberFormat;}if(i&&i.NumberOfFractionalDigits&&i.NumberOfFractionalDigits.Int){j=i.NumberOfFractionalDigits.Int;if(m<Number(j)){m=Number(j);}}}return m;}function c1(m,v,d){if(v&&v.DataPoint&&v.DataPoint.AnnotationPath){var f=d[v.DataPoint.AnnotationPath.substring(1)];var s,i;if(f&&f.ValueFormat){s=f.ValueFormat;}else if(f&&f.NumberFormat){s=f.NumberFormat;}if(s){if(s.ScaleFactor&&s.ScaleFactor.Decimal){i=Number(s.ScaleFactor.Decimal);}else if(s.ScaleFactor&&s.ScaleFactor.Int){i=Number(s.ScaleFactor.Int);}if(!isNaN(i)){if(m===undefined){m=Number(i);}else if(m>Number(i)){m=Number(i);}}}}return m;}function d1(m,s){if(m&&m[s]&&(m[s]["Org.OData.Measures.V1.ISOCurrency"]||(m[s][n.SEMANTICS_KEY]&&m[s][n.SEMANTICS_KEY]===n.CURRENCY_CODE))){return true;}return false;}function e1(m,v,f){if(m[v[f].PropertyPath][n.EDM_TYPE]===n.EDM_INT32){return true;}return false;}function f1(m,v,f){if(m[v[f].PropertyPath][n.EDM_TYPE]===n.EDM_INT64){return true;}return false;}function g1(d,f,m,r){var s,x,v1,w1;var x1,y1,z1,A1,B1;var C1;var D1,E1,F1;var G1,H1=[],I1=[];var J1;var K1;var L1=r&&r.getView();var M1,N1;x1=d.getVizType();y1=P();for(var O1 in y1){if((K1=y1[O1].reference)&&y1[K1]){var P1=q.extend(true,{},y1[K1]);y1[O1]=P1;}if(y1[O1].default.type===x1||(y1[O1].time&&y1[O1].time.type===x1)){z1=y1[O1];break;}}if(!z1){q.sap.log.error(o.CARD_ERROR+"in "+o.CARD_CONFIG+o.CARD_CONFIG_ERROR+x1+" "+o.CARD_CONFIG_JSON);return;}if(!(s=d.getModel('ovpCardProperties'))){q.sap.log.error(o.CARD_ERROR+"in "+o.CARD_CONFIG+o.NO_CARD_MODEL);return;}var Q1=d.getModel();var R1=s.getProperty("/entitySet");if(!Q1||!R1){return;}x=s.getProperty("/entityType");if(!x){q.sap.log.error(o.CARD_ANNO_ERROR+"in "+o.CARD_ANNO);return;}var S1=j1(Q1,R1);v1=s.getProperty("/chartAnnotationPath");if(!v1||!(w1=x[v1])){q.sap.log.error(o.CARD_ANNO_ERROR+"in "+o.CARD_ANNO);return;}if(!(A1=w1.DimensionAttributes)||!A1.length){q.sap.log.error(o.CHART_ANNO_ERROR+"in "+o.CHART_ANNO+" "+o.DIMENSIONS_MANDATORY);return;}var T1;if(!(B1=w1.MeasureAttributes)||!B1.length){q.sap.log.error(o.CHART_ANNO_ERROR+"in "+o.CHART_ANNO+" "+o.MEASURES_MANDATORY);return;}else{var U1=B1[0].DataPoint?x[B1[0].DataPoint.AnnotationPath.substring(1)]:null;var V1=U1&&U1.ValueFormat&&U1.ValueFormat.NumberOfFractionalDigits&&U1.ValueFormat.NumberOfFractionalDigits.Int;T1=V1?V1:0;}J1=Q(A1,z1,Q1,R1);if(J1){z1=z1.time;}else{z1=z1.default;}var W1=s.getProperty("/ChartProperties")||s.getProperty("/chartProperties");if(s&&s.getProperty("/tabs")&&(W1===undefined)){M1=L1.byId("ovp_card_dropdown");N1=parseInt(M1.getSelectedKey(),10);W1=s.getProperty("/tabs")&&s.getProperty("/tabs")[N1-1]&&(s.getProperty("/tabs")[N1-1]["ChartProperties"]||s.getProperty("/tabs")[N1-1]["chartProperties"]);}var X1=false;var Y1=T1>0?"tooltipNoScaleFormatter/"+T1.toString()+"/":'tooltipNoScaleFormatter/-1/';var Z1=new b({formatString:Y1});Z1.connect(d.getVizUid());Z1.connect(d.getVizUid());d._oOvpVizFrameTooltip=Z1;[z1.dimensions,z1.measures].forEach(function(j,i){var k=i?B1:A1;var v=i?"measure(s)":"dimension(s)";if(j.min&&k.length<j.min){q.sap.log.error(o.CARD_ERROR+"in "+x1+" "+o.CARD_LEAST+j.min+" "+v);X1=true;}if(j.max&&k.length>j.max){q.sap.log.error(o.CARD_ERROR+"in "+x1+o.CARD_MOST+j.max+" "+v);X1=true;}});if(X1){return;}var $1=true;if(z1.properties&&z1.properties.hasOwnProperty("hideLabel")&&!z1.properties["hideLabel"]){$1=false;}var _1=true;var a2=false;if(x1==='donut'){a2=true;}d.removeAllAggregation();C1={legend:{isScrollable:false},title:{visible:false},interaction:{noninteractiveMode:_1?false:true,selectability:{legendSelection:a2?true:false,axisLabelSelection:false,mode:'EXCLUSIVE',plotLassoSelection:false,plotStdSelection:true},zoom:{enablement:'disabled'}},plotArea:{window:{start:'firstDataPoint',end:'lastDataPoint'},dataLabel:{visible:a2?true:false,type:'value'},dataPoint:{invalidity:'ignore'},alignment:{vertical:'top'}},categoryAxis:{label:{truncatedLabelRatio:0.15}},general:{groupData:false,showAsUTC:true}};if(z1.properties&&z1.properties.semanticColor===true&&_(B1,x)){var b2=h.getText("GOOD");var c2=h.getText("BAD");var d2=h.getText("CRITICAL");var e2=h.getText("OTHERS");if(B1.length===1){var f2=a1(B1[0],x,S1,d);var b2=f2[0]||b2,c2=f2[1]||c2,d2=f2[2]||d2,e2=h.getText("OTHERS");}C1.plotArea.dataPointStyle={rules:[{callback:function(i){var j=Z(i,S1,B1);if(!j){return false;}var k=x[j.substring(1)];var v=Y(i,k);if(v===a.criticalityConstants.StateValues.Positive){return true;}else if(v==="Positive"){return true;}},properties:{color:"sapUiChartPaletteSemanticGoodLight1"},"displayName":b2},{callback:function(i){var j=Z(i,S1,B1);if(!j){return false;}var k=x[j.substring(1)];var v=Y(i,k);if(v===a.criticalityConstants.StateValues.Critical){return true;}else if(v==="Critical"){return true;}},properties:{color:"sapUiChartPaletteSemanticCriticalLight1"},"displayName":d2},{callback:function(i){var j=Z(i,S1,B1);if(!j){return false;}var k=x[j.substring(1)];var v=Y(i,k);if(v===a.criticalityConstants.StateValues.Negative){return true;}else if(v==="Negative"){return true;}},properties:{color:"sapUiChartPaletteSemanticBadLight1"},"displayName":c2},{callback:function(i){var j=Z(i,S1,B1);if(!j){return false;}var k=x[j.substring(1)];var v=Y(i,k);if(v===a.criticalityConstants.StateValues.None){return true;}else if(v==="Neutral"){return true;}},properties:{color:"sapUiChartPaletteSemanticNeutralLight1"},"displayName":e2}]};}var g2=s.getProperty("/bEnableStableColors");var h2=s.getProperty("/colorPalette");var i2;if(!g2&&(w1.ChartType.EnumMember===n.COLUMNSTACKED_CHARTTYPE||w1.ChartType.EnumMember===n.DONUT_CHARTTYPE||w1.ChartType.EnumMember===n.COLUMN_CHARTTYPE||w1.ChartType.EnumMember===n.VERTICALBULLET_CHARTTYPE||w1.ChartType.EnumMember===n.LINE_CHARTTYPE||w1.ChartType.EnumMember===n.COMBINATION_CHARTTYPE||w1.ChartType.EnumMember===n.BUBBLE_CHARTTYPE)&&h2&&Object.keys(h2).length>=2&&Object.keys(h2).length<=4){q.each(A1,function(i,j){if(j&&j.Role&&j.Role.EnumMember==="com.sap.vocabularies.UI.v1.ChartDimensionRoleType/Series"){i2=j.Dimension&&j.Dimension.PropertyPath;return;}});var j2;if(i2){if(S1&&S1[i2]){if(S1[i2][n.LABEL_KEY_V4]){j2=i1(S1[i2][n.LABEL_KEY_V4].String?S1[i2][n.LABEL_KEY_V4].String:S1[i2][n.LABEL_KEY_V4].Path,d,S1);}else if(S1[i2][n.LABEL_KEY]){j2=S1[i2][n.LABEL_KEY];}else if(i2){j2=i2;}}if(h2 instanceof Array){var k2=h2.map(function(v){return v.color;});var l2=h2.map(function(v){return v.legendText;});var m2=l2[0]!=undefined?l2[0]:h.getText("OTHERS");var n2=l2[1]!=undefined?l2[1]:h.getText("BAD");var o2=l2[2]!=undefined?l2[2]:h.getText("CRITICAL");var p2=l2[3]!=undefined?l2[3]:h.getText("GOOD");}C1.plotArea.dataPointStyle={rules:[{callback:function(i){if(i&&(i[j2]==="3"||i[j2]===3)){if(h2 instanceof Array){if(h2.length<4){return false;}}else if(h2&&!h2.hasOwnProperty(3)){return false;}return true;}},properties:{color:h2 instanceof Array&&k2.length?k2[3]:h2[3]&&h2[3]["color"]},"displayName":p2||h2[3]&&h2[3]["legendText"]},{callback:function(i){if(i&&(i[j2]==="2"||i[j2]===2)){if(h2 instanceof Array){if(h2.length<3){return false;}}else if(h2&&!h2.hasOwnProperty(2)){return false;}return true;}},properties:{color:h2 instanceof Array&&k2.length?k2[2]:h2[2]&&h2[2]["color"]},"displayName":o2||h2[2]&&h2[2]["legendText"]},{callback:function(i){if(i&&(i[j2]==="1"||i[j2]===1)){return true;}},properties:{color:h2 instanceof Array&&k2.length?k2[1]:h2[1]&&h2[1]["color"]},"displayName":n2||h2[1]&&h2[1]["legendText"]},{callback:function(i){if(i&&(i[j2]==="0"||i[j2]===0)){return true;}},properties:{color:h2 instanceof Array&&k2.length?k2[0]:h2[0]&&h2[0]["color"]},"displayName":m2||h2[0]&&h2[0]["legendText"]}]};}}var q2=false;var r2=false;if(w1.ChartType.EnumMember===n.SCATTER_CHARTTYPE||w1.ChartType.EnumMember===n.BUBBLE_CHARTTYPE||w1.ChartType.EnumMember===n.LINE_CHARTTYPE){if(w1&&w1.AxisScaling&&w1.AxisScaling.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisScalingType"){var s2=w1.AxisScaling;if(s2.AutoScaleBehavior&&s2.AutoScaleBehavior.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisAutoScaleBehaviorType"){var t2=s2.AutoScaleBehavior;if(t2.ZeroAlwaysVisible&&t2.ZeroAlwaysVisible.Bool=="true"){C1.plotArea.adjustScale=false;q2=true;}else if(t2.DataScope){C1.plotArea.adjustScale=true;q2=true;}}else if(s2.RecordType=="com.sap.vocabularies.UI.v1.ChartAxisScalingType"&&s2.ScaleBehavior&&s2.ScaleBehavior.EnumMember){var u2=s2.ScaleBehavior.EnumMember;var v2=u2.substring(u2.lastIndexOf('/')+1,u2.length);if(v2=="FixedScale"){r2=true;}}}else if(w1&&w1.AxisScaling&&w1.AxisScaling.EnumMember){var w2=w1.AxisScaling.EnumMember.substring(w1.AxisScaling.EnumMember.lastIndexOf('/')+1,w1.AxisScaling.EnumMember.length);switch(w2){case"AdjustToDataIncluding0":C1.plotArea.adjustScale=false;q2=true;break;case"AdjustToData":C1.plotArea.adjustScale=true;q2=true;break;case"MinMaxValues":r2=true;break;default:break;}}if(r2){var x2=[];if(w1["MeasureAttributes"][0]&&w1["MeasureAttributes"][0].DataPoint&&w1["MeasureAttributes"][0].DataPoint.AnnotationPath){var y2=w1["MeasureAttributes"][0].DataPoint.AnnotationPath;var z2=y2.substring(y2.lastIndexOf('@')+1,y2.length);if(x&&x[z2]){var A2=x[z2];if(A2&&A2.MaximumValue&&A2.MaximumValue.Decimal&&A2.MinimumValue&&A2.MinimumValue.Decimal){x2.push({feed:"valueAxis",max:A2.MaximumValue.Decimal,min:A2.MinimumValue.Decimal});q2=true;}else{q.sap.log.error(o.ERROR_MISSING_AXISSCALES);}}}if(w1.ChartType.EnumMember!==n.LINE_CHARTTYPE&&w1["MeasureAttributes"][1]&&w1["MeasureAttributes"][1].DataPoint&&w1["MeasureAttributes"][1].DataPoint.AnnotationPath){var y2=w1["MeasureAttributes"][1].DataPoint.AnnotationPath;var z2=y2.substring(y2.lastIndexOf('@')+1,y2.length);if(x&&x[z2]){var A2=x[z2];if(A2&&A2.MaximumValue&&A2.MaximumValue.Decimal&&A2.MinimumValue&&A2.MinimumValue.Decimal){x2.push({feed:"valueAxis2",max:A2.MaximumValue.Decimal,min:A2.MinimumValue.Decimal});q2=true;}else{q.sap.log.error(o.ERROR_MISSING_AXISSCALES);}}}d.setVizScales(x2);}}E1=A1.slice();F1=B1.slice();var B2=0;var C2=0;var D2;var E2;var F2=false;var G2=false;var H2;var I2=[];var J2=[],K2=[];if((x1==="column"||x1==="vertical_bullet")&&z1.feeds&&(z1.feeds.length>0)){var L2;for(L2=0;L2<z1.feeds.length;L2++){if(z1.feeds[L2].uid==="color"){z1.feeds.splice(L2,1);break;}}for(L2=0;L2<z1.feeds.length;L2++){if(z1.feeds[L2].uid==="categoryAxis"){delete z1.feeds[L2].role;break;}}if(s.getProperty("/colorPalette")){for(L2=0;L2<z1.feeds.length;L2++){if(z1.feeds[L2].uid==="categoryAxis"){z1.feeds[L2].role="Category";break;}}z1.feeds.push({"uid":"color","min":1,"type":"dimension","role":"Series"});}}q.each(z1.feeds,function(i,v){var S2=v.uid;var T2=[];if(v.type){var U2,V2,W2;if(v.type==="dimension"){U2=A1.length;V2="Dimension";W2="dimensions";D1=E1;G1=H1;}else{U2=B1.length;V2="Measure";W2="measures";D1=F1;G1=I1;}var X2=0,Y2=U2;if(v.min){X2=X2>v.min?X2:v.min;}if(v.max){Y2=Y2<v.max?Y2:v.max;}if(!v.role){var Z2=D1.length;for(var j=0;j<Z2&&T2.length<Y2;++j){var $2=D1[j];D1.splice(j,1);--Z2;--j;T2.push($2);if(S1[$2[V2].PropertyPath][n.UNIT_KEY_V4_ISOCurrency]){H2=S1[$2[V2].PropertyPath][n.UNIT_KEY_V4_ISOCurrency].Path?S1[$2[V2].PropertyPath][n.UNIT_KEY_V4_ISOCurrency].Path:undefined;}else if(S1[$2[V2].PropertyPath][n.UNIT_KEY_V4_Unit]){H2=S1[$2[V2].PropertyPath][n.UNIT_KEY_V4_Unit].Path?S1[$2[V2].PropertyPath][n.UNIT_KEY_V4_Unit].Path:undefined;}else if(S1[$2[V2].PropertyPath][n.UNIT_KEY]){H2=S1[$2[V2].PropertyPath][n.UNIT_KEY];}if(d1(S1,H2)){F2=true;}else{G2=true;}if(!F2){B2=b1(B2,$2,x);D2=c1(D2,$2,x);}else{C2=b1(C2,$2,x);E2=c1(E2,$2,x);}}}else{var _2=v.role.split("|");q.each(_2,function(j,s3){if(T2.length===Y2){return false;}var Z2=D1.length;for(var k=0;k<Z2&&T2.length<Y2;++k){var $2=D1[k];if($2&&$2.Role&&$2.Role.EnumMember&&$2.Role.EnumMember.split("/")&&$2.Role.EnumMember.split("/")[1]){var t3=$2.Role.EnumMember.split("/")[1];if(t3===s3){D1.splice(k,1);--Z2;--k;T2.push($2);if(S1[$2[V2].PropertyPath][n.UNIT_KEY_V4_ISOCurrency]){H2=S1[$2[V2].PropertyPath][n.UNIT_KEY_V4_ISOCurrency].Path?S1[$2[V2].PropertyPath][n.UNIT_KEY_V4_ISOCurrency].Path:undefined;}else if(S1[$2[V2].PropertyPath][n.UNIT_KEY_V4_Unit]){H2=S1[$2[V2].PropertyPath][n.UNIT_KEY_V4_Unit].Path?S1[$2[V2].PropertyPath][n.UNIT_KEY_V4_Unit].Path:undefined;}else if(S1[$2[V2].PropertyPath][n.UNIT_KEY]){H2=S1[$2[V2].PropertyPath][n.UNIT_KEY];}if(d1(S1,H2)){F2=true;}else{G2=true;}if(!F2){B2=b1(B2,$2,x);D2=c1(D2,$2,x);}else{C2=b1(C2,$2,x);E2=c1(E2,$2,x);}}}else if(q.inArray($2,G1)===-1){G1.push($2);}}});if(T2.length<Y2){q.each(G1,function(k,$2){var s3;var L2;if((s3=z1[W2].defaultRole)&&(q.inArray(s3,_2)!==-1)&&(L2=q.inArray($2,D1))!==-1){D1.splice(L2,1);T2.push($2);if(S1[$2[V2].PropertyPath][n.UNIT_KEY_V4_ISOCurrency]){H2=S1[$2[V2].PropertyPath][n.UNIT_KEY_V4_ISOCurrency].Path?S1[$2[V2].PropertyPath][n.UNIT_KEY_V4_ISOCurrency].Path:undefined;}else if(S1[$2[V2].PropertyPath][n.UNIT_KEY_V4_Unit]){H2=S1[$2[V2].PropertyPath][n.UNIT_KEY_V4_Unit].Path?S1[$2[V2].PropertyPath][n.UNIT_KEY_V4_Unit].Path:undefined;}else if(S1[$2[V2].PropertyPath][n.UNIT_KEY]){H2=S1[$2[V2].PropertyPath][n.UNIT_KEY];}if(d1(S1,H2)){F2=true;}else{G2=true;}if(!F2){B2=b1(B2,$2,x);D2=c1(D2,$2,x);}else{C2=b1(C2,$2,x);E2=c1(E2,$2,x);}if(T2.length===Y2){return false;}}});}if(T2.length<X2){q.sap.log.error(o.CARD_ERROR+o.MIN_FEEDS+x1+" "+o.FEEDS_OBTAINED+T2.length+" "+o.FEEDS_REQUIRED+X2+" "+o.FEEDS);return false;}}if(T2.length){var a3=[];var b3;if(!(b3=d.getDataset())){q.sap.log.error(o.NO_DATASET);return false;}G=x;q.each(T2,function(i,$2){if(!$2||!$2[V2]||!$2[V2].PropertyPath){q.sap.log.error(o.INVALID_CHART_ANNO);return false;}var k=$2[V2].PropertyPath;var j2=k;var s3=k;var t3=null;if(S1&&S1[k]){if(S1[k][n.LABEL_KEY_V4]){if(S1[k][n.LABEL_KEY_V4].String){j2=i1(S1[k][n.LABEL_KEY_V4].String,d,S1);}else if(S1[k][n.LABEL_KEY_V4].Path){j2=S1[k][n.LABEL_KEY_V4].Path;}else{j2=k;}}else if(S1[k][n.LABEL_KEY]){j2=S1[k][n.LABEL_KEY];}else if(k){j2=k;}if(S1[k][n.TEXT_KEY_V4]){s3=S1[k][n.TEXT_KEY_V4].String?S1[k][n.TEXT_KEY_V4].String:S1[k][n.TEXT_KEY_V4].Path;}else if(S1[k][n.TEXT_KEY]){s3=S1[k][n.TEXT_KEY];}else if(k){s3=k;}t3=S1[k][n.TYPE_KEY]||null;}var u3;if((t3==="Edm.DateTime"||t3==="Edm.DateTimeOffset")&&s3===k){u3="{path:'"+k+"', formatter: 'sap.ovp.cards.charts.VizAnnotationManager.returnDateFormat'}";}else{if(S1[k]&&S1[k][n.TEXT_KEY_V4]&&S1[k][n.TEXT_KEY_V4][n.TEXT_ARRANGEMENT_ANNO]){var v3,w3;v3=S1[k][n.TEXT_ARRANGEMENT_ANNO];w3=v3&&v3.EnumMember;if(!w3){v3=S1[k][n.TEXT_KEY_V4][n.TEXT_ARRANGEMENT_ANNO];w3=v3&&v3.EnumMember;}if(!w3){var x3=G;v3=x3&&x3[n.TEXT_ARRANGEMENT_ANNO];w3=v3&&v3.EnumMember;}switch(w3){case"com.sap.vocabularies.UI.v1.TextArrangementType/TextFirst":u3="{"+s3+"}"+" "+"("+"{"+k+"}"+")";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextLast":u3="{"+k+"}"+" "+"("+"{"+s3+"}"+")";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly":u3="{"+s3+"}";break;case"com.sap.vocabularies.UI.v1.TextArrangementType/TextSeperate":u3="{"+k+"}"+" "+"("+"{"+s3+"}"+")";break;default:u3="{"+k+"}";break;}}else{u3="{"+s3+"}";}}a3.push(j2);if(V2==="Dimension"){if(S2==="waterfallType"){var y3=new e({name:j2,value:"{"+k+"}"});}else{var y3=new e({name:j2,value:"{"+k+"}",displayValue:u3});}var z3=S1[k][n.SEMANTICS_KEY];var A3=S1[k]["com.sap.vocabularies.Common.v1.IsCalendarYear"]&&S1[k]["com.sap.vocabularies.Common.v1.IsCalendarYear"].Bool;if(J1&&(t3==="Edm.DateTime"||A3||t3==="Edm.DateTimeOffset"||(z3&&z3.lastIndexOf("year",0)===0))){y3.setDataType("date");}b3.addDimension(y3);if(q.inArray(j2,K2)===-1){K2.push(j2);}}else{b3.addMeasure(new M({name:j2,value:"{"+k+"}"}));if((q.inArray(j2,J2)===-1)&&(S2!="bubbleWidth")){J2.push(j2);}}});d.addFeed(new F({'uid':S2,'type':V2,'values':a3}));if(S2==="categoryAxis"){C1[S2]={title:{visible:$1?false:true,text:a3.join(", ")},label:{formatString:F2?'CURR':'axisFormatter',truncatedLabelRatio:0.15}};}else{C1[S2]={title:{visible:$1?false:true,text:a3.join(", ")},label:{formatString:F2?'CURR':'axisFormatter'}};}I2.push(C1[S2]);if(z1.hasOwnProperty("vizProperties")){var c3=0;var d3=z1.vizProperties.length;var e3;var f3;for(;c3<d3;c3++){if(z1.vizProperties[c3].hasOwnProperty("value")){f3=z1.vizProperties[c3].value;}if(z1.vizProperties[c3].hasOwnProperty("path")){e3=(z1.vizProperties[c3].path).split(".");var g3=e3.length;var h3,i3;var j3;for(var k3=0,j3=e3[0],h3=C1,i3=W1;k3<g3;++k3){if(k3===g3-1){if(i3&&i3.hasOwnProperty(j3)){if(x1==='donut'&&(i3[j3]==="value"||i3[j3]==="percentage")){f3=i3[j3];}else if(x1!='donut'){f3=i3[j3];}}if((q2&&(j3!="adjustScale"))||(!q2&&(j3==="adjustScale"))||(!q2&&(j3!="adjustScale"))){h3[j3]=f3;}break;}h3[j3]=h3[j3]||{};h3=h3[j3];if(i3){i3[j3]=i3[j3]||{};i3=i3[j3];}j3=e3[k3+1];}}}}if(v.hasOwnProperty("vizProperties")){var i=0;var l3=v.vizProperties.length;var m3;var n3;var o3;for(;i<l3;i++){if(v.vizProperties[i].hasOwnProperty("method")){n3=v.vizProperties[i].method;switch(n3){case'count':m3=a3.length;if(v.vizProperties[i].hasOwnProperty("min")&&m3<=v.vizProperties[i].min){m3=v.vizProperties[i].min;}else if(v.vizProperties[i].hasOwnProperty("max")&&m3>=v.vizProperties[i].max){m3=v.vizProperties[i].max;}break;}}else if(v.vizProperties[i].hasOwnProperty("value")){m3=v.vizProperties[i].value;}if(v.vizProperties[i].hasOwnProperty("path")){o3=(v.vizProperties[i].path).split(".");var p3=o3.length;var q3;var r3;for(var j=0,r3=o3[0],q3=C1;j<p3;++j){if(j===p3-1){q3[r3]=m3;break;}q3[r3]=q3[r3]||{};q3=q3[r3];r3=o3[j+1];}}}}}}});var M2=d.getFeeds();if(z1.properties&&z1.properties.semanticPattern===true&&A(M2,x1)){q.each(M2,function(i,v){if(M2[i].getType()==='Measure'&&((M2[i].getUid()==='valueAxis')||(M2[i].getUid()==='actualValues'))){var j;q.each(B1,function(L2,X2){var Y2=z(X2.Measure.PropertyPath,S1);if(Y2===M2[i].getValues()[0]){j=w(X2,x);return false;}});if(j){var k=z(j.Measure.PropertyPath,S1);var S2=(x[j.DataPoint.AnnotationPath.substring(1)].ForecastValue.PropertyPath||x[j.DataPoint.AnnotationPath.substring(1)].ForecastValue.Path);var T2=z(S2,S1);var U2=h.getText("ACTUAL",[k]);var V2=h.getText("FORECAST",[T2]);C1.plotArea.dataPointStyle={rules:[{dataContext:{MeasureNamesDimension:k},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"line",lineColor:"sapUiChartPaletteSequentialHue1Light1"},displayName:U2},{dataContext:{MeasureNamesDimension:T2},properties:{color:"sapUiChartPaletteSequentialHue1Light1",lineType:"dotted",lineColor:"sapUiChartPaletteSequentialHue1Light1",pattern:"diagonalLightStripe"},displayName:V2}]};d.getDataset().addMeasure(new M({name:T2,value:"{"+S2+"}"}));var W2=M2[i].getValues();W2.push(T2);M2[i].setValues(W2);}return false;}});}if(z1.properties&&z1.properties.semanticPattern===true&&A(M2,x1)&&d.getVizType()==="vertical_bullet"){q.each(M2,function(i,v){if(M2[i].getType()==='Measure'&&((M2[i].getUid()==='valueAxis')||(M2[i].getUid()==='actualValues'))){var j;q.each(B1,function(L2,T2){var U2=z(T2.Measure.PropertyPath,S1);if(U2===M2[i].getValues()[0]){j=y(T2,x);return false;}});if(j){var k=(x[j.DataPoint.AnnotationPath.substring(1)].TargetValue.PropertyPath||x[j.DataPoint.AnnotationPath.substring(1)].TargetValue.Path);var S2=z(k,S1);d.getDataset().addMeasure(new M({name:S2,value:"{"+k+"}"}));d.addFeed(new F({'uid':"targetValues",'type':"Measure",'values':[S2]}));}return false;}});}if(F2&&G2){q.sap.log.warning(h.getText("Currency_non_currency_measure"));}q.each(M2,function(i,k){var v=k.getProperty("type");if(v==="Measure"){var S2=k.getProperty("values");var T2=true;var U2=w1.MeasureAttributes.filter(function(j){return S2.indexOf(S1[j[v]["PropertyPath"]][n.LABEL_KEY])>=0||S2.indexOf(S1[j[v]["PropertyPath"]][n.LABEL_KEY_V4])>=0;});q.each(U2,function(j,V2){if(e1(S1,V2,v)||f1(S1,V2,v)){T2=false;}else{T2=true;return false;}});if(!T2){C1[k.getProperty('uid')]['label']['allowDecimals']=false;}}});var N2;if(E2===undefined){E2="";}if(D2===undefined){D2="";}if(F2){N2=l1(E2,F2);}else{N2=l1(D2,F2);}if(f){f.setScale(N2);}k1(J2,K2,m);var O2="";q.each(M2,function(i,j){var k="-1";var v=j.getProperty("type");if(v==="Measure"){var S2=I2.filter(function(V2){var W2=V2["title"]["text"].split(",").filter(function(X2){if(j.getValues().indexOf(X2.trim())>=0){return true;}else{return false;}});if(W2.length>0){return true;}else{return false;}});if(S2&&S2.length){var T2=j.getValues();if(T2&&T2.length){q.each(T2,function(i,V2){var W2=V2.trim();var X2=B1.filter(function(_2){if(_2["Measure"]&&_2["Measure"]["PropertyPath"]){var a3=_2["Measure"]["PropertyPath"];if((S1[a3]&&S1[a3][n.LABEL_KEY]===W2)||(S1[a3]&&S1[a3][n.LABEL_KEY_V4]===W2)){return true;}else{return false;}}});if(X2&&X2.length){var Y2=X2[0];if(!e1(S1,Y2,v)&&!f1(S1,Y2,v)){var Z2="";if(Y2&&Y2["DataPoint"]&&Y2["DataPoint"]["AnnotationPath"]&&Y2["DataPoint"]["AnnotationPath"]){Z2=Y2["DataPoint"]["AnnotationPath"]&&Y2["DataPoint"]["AnnotationPath"].substring(1);if(Z2!=""){var $2;$2=x[Z2]&&x[Z2]["ValueFormat"]&&x[Z2]["ValueFormat"]["NumberOfFractionalDigits"]&&x[Z2]["ValueFormat"]["NumberOfFractionalDigits"]["Int"];k=$2>k?$2:k;}}}else{k=k<"0"?"0":k;}}});}}if(S2&&S2[0]&&S2[0].label&&S2[0].label.formatString){var U2=S2[0].label.formatString;}O2="";if(F2){if(U2==='CURR'){O2='CURR/'+k.toString()+"/";}else{O2='axisFormatter/'+k.toString()+"/";}}else{O2='axisFormatter/'+k.toString()+"/";}if(S2&&S2[0]){S2[0].label.formatString=O2;}}});if(x1==="vertical_bullet"){C1["valueAxis"]={title:{visible:$1?false:true},label:{formatString:O2}};}var P2="";var Q2="";if(F2){P2=C2.toString();Q2='CURR/'+C2.toString()+"/";}else{P2=B2.toString();Q2='axisFormatter/'+B2.toString()+"/";}if(x1==="donut"){C1.plotArea.dataLabel.formatString=Q2;if(C1.plotArea.dataLabel.type==="percentage"){C1.plotArea.dataLabel.formatString="0.0%/"+P2+"/";}}S(E1,z1,"dimension");S(F1,z1,"measure");if(J1){var R2=A1[0].Dimension.PropertyPath;if(S1[R2][n.SEMANTICS_KEY]==='yearmonth'||S1[R2]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){C1.timeAxis.levels=["year","month"];}else if(S1[R2][n.SEMANTICS_KEY]==='yearquarter'||S1[R2]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){C1.timeAxis.levels=["quarter"];}else if(S1[R2][n.SEMANTICS_KEY]==='yearweek'||S1[R2]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){C1.timeAxis.levels=["week"];}}d.setVizProperties(C1);}function h1(v,d,f){if(v&&(v.getVizType()==="bubble"||v.getVizType()==="scatter")){return;}var j,k,r,s;var x;var v1=n.UNIT_KEY;var w1=n.UNIT_KEY_V4_ISOCurrency;var x1=n.UNIT_KEY_V4_Unit;var y1;var z1=[];if(!(j=v.getModel('ovpCardProperties'))){q.sap.log.error(o.CARD_ERROR+"in "+o.CARD_CONFIG+o.NO_CARD_MODEL);return;}var A1=v.getModel();var B1=j.getProperty("/entitySet");if(!A1||!B1){return;}k=j.getProperty("/entityType");if(!k){q.sap.log.error(o.CARD_ANNO_ERROR+"in "+o.CARD_ANNO);return;}var C1=j1(A1,B1);r=j.getProperty("/chartAnnotationPath");if(!r||!(s=k[r])){q.sap.log.error(o.CARD_ANNO_ERROR+"in "+o.CARD_ANNO);return;}if(!(x=s.MeasureAttributes)||!x.length){q.sap.log.error(o.CHART_ANNO_ERROR+"in "+o.CHART_ANNO+" "+o.MEASURES_MANDATORY);return;}q.each(x,function(i,m){y1=m.Measure.PropertyPath;if(m.DataPoint&&m.DataPoint.AnnotationPath){var L1=k[m.DataPoint.AnnotationPath.substring(1)];if(L1.ForecastValue&&(L1.ForecastValue.PropertyPath||L1.ForecastValue.Path)){z1.push((L1.ForecastValue.PropertyPath||L1.ForecastValue.Path));}}z1.push(y1);});var D1=d?d.results:null;var E1="";var F1=true;var G1=[];var H1=v.getFeeds();q.each(H1,function(i,m){if(m.getType()==="Measure"){G1=G1.concat(m.getValues());}});if(D1){q.each(z1,function(i,m){var L1="";if(C1&&C1[m]){if(C1[m][n.LABEL_KEY_V4]){L1=i1(C1[m][n.LABEL_KEY_V4].String?C1[m][n.LABEL_KEY_V4].String:C1[m][n.LABEL_KEY_V4].Path,v,C1);}else if(C1[m][n.LABEL_KEY]){L1=C1[m][n.LABEL_KEY];}else if(m){L1=m;}}if(q.inArray(L1,G1)!=-1){if(C1&&C1[m]){var M1;if(C1[m][w1]){M1=C1[m][w1].Path?C1[m][w1].Path:C1[m][w1].String;}else if(C1[m][x1]){M1=C1[m][x1].Path?C1[m][x1].Path:C1[m][x1].String;}else if(C1[m][v1]){M1=C1[m][v1];}if(!M1){F1=false;return false;}if(M1&&C1[M1]){for(var i=0;i<D1.length;i++){var N1=D1[i];if(F1){if(E1&&N1[M1]&&(N1[M1]!="")&&(E1!="")&&(E1!=N1[M1])){F1=false;break;}}E1=N1[M1];}}}}});}var I1="";if(F1){if(E1!=""){I1=h.getText("IN_NO_SCALE",[E1]);I1=" "+I1;}if(f){f.setText(I1);f.data("aria-label",I1,true);var J1=v.data("aria-label");if(J1&&I1&&J1.indexOf(I1)===-1){var K1=J1+I1;v.data("aria-label",K1,true);}}}}function i1(f,v,m){var r;var s;var d;if(f.indexOf("{")===0){f=f.slice(1,-1);if(f.indexOf(">")!=-1){d=f.split(">");r=d[0];s=d[1];}else if(f.indexOf("&gt;")!=-1){d=f.split("&gt;");r=d[0];s=d[1];}try{f=v.getModel(r).getProperty(s);}catch(i){f=m[f][n.LABEL_KEY_V4].String;q.sap.log.error("Unable to read labels from resource file",i);}}return f;}function j1(m,d){var f=U.cacheODataMetadata(m);if(!f){return undefined;}return f[d];}function k1(m,d,f){var j="",k="",r="";if(f){j=f.getText();}if(m&&(m.length>1)){for(var i=0;i<m.length-1;i++){if(k!=""){k+=", ";}k+=m[i];}k=h.getText("MEAS_DIM_TITLE",[k,m[i]]);}else if(m){k=m[0];}if(d&&(d.length>1)){for(var i=0;i<d.length-1;i++){if(r!=""){r+=", ";}r+=d[i];}r=h.getText("MEAS_DIM_TITLE",[r,d[i]]);}else if(d){r=d[0];}if(f&&(j==="")){j=h.getText("NO_CHART_TITLE",[k,r]);f.setText(j);f.data("aria-label",j,true);}}function l1(m,i){var d=1;var s;if(i){var f=N.getCurrencyInstance({style:'short',currencyCode:false,shortRefNumber:m});s=f.format(Number(d));}else{var j=N.getFloatInstance({style:'short',shortRefNumber:m});s=j.format(Number(d));}var k=s.slice(-1);return k;}function m1(v,d){v.attachSelectData(function(f){var s=l.bCRTLPressed?l.constants.explace:l.constants.inplace;l.bCRTLPressed=false;var m=v.getModel('ovpCardProperties');var v1=v.getModel();var w1=m.getProperty("/entitySet");var x1=j1(v1,w1);var y1=[],z1=[];var A1={},B1={};var C1=v.getDataset().getDimensions();var D1;for(var i=0;i<C1.length;i++){y1.push(C1[i].getName());}var E1=q.map(v.getDataset().getBinding("data").getCurrentContexts(),function(x){return x.getObject();});if(f.getParameter("data")&&f.getParameter("data")[0]&&f.getParameter("data")[0].data){z1=Object.keys(f.getParameter("data")[0].data);D1=f.getParameter("data")[0].data._context_row_number;var F1=v.getDataset().getBinding("data").getContexts()[D1];var G1=d.getEntityNavigationEntries(F1)[0];if(E1[D1].$isOthers&&E1[D1].$isOthers===true){var H1={},I1=[];for(var j=0;j<y1.length;j++){for(var k=0;k<z1.length;k++){if(y1[j]===z1[k]){for(var J1 in x1){if(x1.hasOwnProperty(J1)){var K1=x1[J1][n.LABEL_KEY]||x1[J1][n.NAME_KEY]||x1[J1][n.NAME_CAP_KEY];if(K1===z1[k]){I1.push(J1);}}}}}}for(var i=0;i<I1.length;i++){H1[I1[i]]=[];for(var j=0;j<E1.length-1;j++){if(j!=D1){H1[I1[i]].push(E1[j][I1[i]]);}}}var L1={$isOthers:true};var M1={getObject:function(){return L1;},getOtherNavigationDimensions:function(){return H1;}};if(O.checkIfAPIIsUsed(d)){if(d.checkAPINavigation()){c.onContentClicked(M1);}}else{if(G1){d.doNavigation(M1,G1,s);}}}else{for(var j=0;j<y1.length;j++){for(var k=0;k<z1.length;k++){if(y1[j]===z1[k]){for(var J1 in x1){if(x1.hasOwnProperty(J1)){var K1=x1[J1][n.LABEL_KEY]||x1[J1][n.NAME_KEY]||x1[J1][n.NAME_CAP_KEY];if(K1===z1[k]){A1[J1]=E1[D1][J1];}}}}for(var J1 in E1[D1]){if(x1.hasOwnProperty(J1)){B1[J1]=E1[D1][J1];}}}}if(A1){q.each(Object.keys(A1),function(i,J1){if(x1[J1]["type"]==="Edm.String"){if(x1[J1]["sap:semantics"]==="yearmonth"||x1[J1]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){A1[J1]=(A1[J1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYMM"}).format(A1[J1]):A1[J1]);}else if(x1[J1]["sap:semantics"]==="yearquarter"||x1[J1]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){A1[J1]=(A1[J1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYQ"}).format(A1[J1]):A1[J1]);}else if(x1[J1]["sap:semantics"]==="yearweek"||x1[J1]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){A1[J1]=(A1[J1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYww"}).format(A1[J1]):A1[J1]);}}});}if(B1){q.each(Object.keys(B1),function(i,J1){if(x1[J1]["type"]==="Edm.String"){if(x1[J1]["sap:semantics"]==="yearmonth"||x1[J1]["com.sap.vocabularies.Common.v1.IsCalendarYearMonth"]){B1[J1]=(B1[J1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYMM"}).format(B1[J1]):B1[J1]);}else if(x1[J1]["sap:semantics"]==="yearquarter"||x1[J1]["com.sap.vocabularies.Common.v1.IsCalendarYearQuarter"]){B1[J1]=(B1[J1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYQ"}).format(B1[J1]):B1[J1]);}else if(x1[J1]["sap:semantics"]==="yearweek"||x1[J1]["com.sap.vocabularies.Common.v1.IsCalendarYearWeek"]){B1[J1]=(B1[J1].constructor===Date?D.getDateTimeInstance({pattern:"YYYYww"}).format(B1[J1]):B1[J1]);}}});}var N1=m.getProperty("/entityType"),O1=N1[m.getProperty('/presentationAnnotationPath')];if(N1){var P1=a.getRequestFields(O1);if(P1&&P1.length>0){q.each(P1,function(i,r){if(!A1.hasOwnProperty(r)){A1[r]=E1[D1][r];}});}}var M1={getObject:function(){return A1;},getAllData:function(){return B1;}};if(O.checkIfAPIIsUsed(d)){if(d.checkAPINavigation()){c.onContentClicked(M1);}}else{if(G1){d.doNavigation(M1,G1,s);}}}}});}function n1(d){if(d.EnumMember.endsWith("Bubble")){return true;}else{return false;}}function o1(d){var r=false;if(!d||d.constructor!=Array||d.length<1||d[0].constructor!=Object||!d[0].Dimension||!d[0].Dimension.PropertyPath){q.sap.log.error(o.CHART_ANNO_ERROR+"in "+o.CHART_ANNO+" "+o.DIMENSIONS_MANDATORY);return r;}r=true;return r;}function p1(m){var r=false;if(!m||m.constructor!=Array||m.length<1||m[0].constructor!=Object||!m[0].Measure||!m[0].Measure.PropertyPath){q.sap.log.error(o.CHART_ANNO_ERROR+"in "+o.CHART_ANNO+" "+o.MEASURES_MANDATORY);return r;}r=true;return r;}function q1(d){return d.name;}function r1(d){if(d&&d.indexOf("#")!=-1){var f=d.split("#");if(f.length>1){return f[1];}}return"";}function s1(d,v){var f=v.getModel('ovpCardProperties');var i=t1(v);var m=+i.itemsLength;var j=+f.getProperty("/dataStep");if(m&&j){var k=d.colSpan-1;if(k>=0){m+=j*k;u1(v,m);}}}function t1(v){var d=v.getModel('ovpCardProperties');var f=d.getProperty("/entityType");var i=d.getProperty("/presentationAnnotationPath");var j=f.hasOwnProperty(i)&&f[i];var m=j&&j.MaxItems;if(m){var k=m.Int32?m.Int32:m.Int;return{itemsLength:+k,dataStep:+d.getProperty("/dataStep")};}}function u1(v,d){var f,j={},k=[];var r=v.getVizType();var s=v.getModel('ovpCardProperties');var x=s.getProperty("/entityType");var v1=s.getProperty("/chartAnnotationPath");var w1=x[v1];var x1=v.getParent();var y1=x1.getBinding("data");j.path=y1.getPath();j.parameters={};if(y1.mParameters&&y1.mParameters.select){j.parameters.select=y1.mParameters.select;}j.filters=y1.aApplicationFilters;j.sorter=y1.aSorters;j.length=(r==="donut")?d+1:d;j.template=new g();x1.bindAggregation("data",j);if(r==="donut"){q.each(w1.MeasureAttributes,function(i,m){k.push(m.Measure.PropertyPath);});f={};f.path=y1.getPath();f.parameters={};f.parameters.select=k.join(",");f.filters=y1.aApplicationFilters;f.sorter=y1.aSorters;f.length=1;f.template=new g();x1.bindAggregation("aggregateData",f);}x1.updateBindingContext();}return{constants:n,errorMessages:o,formatItems:p,formatByType:B,returnDateFormat:E,formatChartAxes:H,hideDateTimeAxis:I,checkExists:J,validateCardConfiguration:K,checkNoData:L,getConfig:P,hasTimeSemantics:Q,getChartType:R,getPrimitiveValue:T,formThePathForCriticalityStateCalculation:Y,checkFlag:_,buildVizAttributes:g1,setChartUoMTitle:h1,getMetadata:j1,getSelectedDataPoint:m1,checkBubbleChart:n1,dimensionAttrCheck:o1,measureAttrCheck:p1,getEntitySet:q1,getAnnotationQualifier:r1,reprioritizeContent:s1,getMaxItems:t1,getLabelFromAnnotationPath:i1};},true);
