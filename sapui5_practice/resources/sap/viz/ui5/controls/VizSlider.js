/*!
 * SAPUI5

(c) Copyright 2009-2019 SAP SE. All rights reserved
 */
sap.ui.define(['sap/ui/core/Control','./VizFrame','./VizRangeSlider','./common/utils/Constants','sap/ui/Device',"sap/ui/thirdparty/jquery","./VizSliderRenderer"],function(B,V,a,C,D,q){"use strict";var b={plotArea:{dataLabel:{visible:false}},legend:{visible:false},categoryAxis:{visible:false},valueAxis:{title:{visible:false}},title:{visible:false},interaction:{noninteractiveMode:true},timeAxis:{visible:false}};var c=B.extend("sap.viz.ui5.controls.VizSlider",{metadata:{library:"sap.viz",properties:{vizType:{type:"string",group:"Misc",defaultValue:"column"},uiConfig:{type:"object",group:"Misc",defaultValue:null},width:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:'800px'},height:{type:"sap.ui.core.CSSSize",group:"Misc",defaultValue:'200px'},valueAxisVisible:{type:"boolean",group:"Misc",defaultValue:true},showPercentageLabel:{type:"boolean",group:"Appearance",defaultValue:true},showStartEndLabel:{type:"boolean",group:"Appearance",defaultValue:true},range:{type:"object",group:"Appearance",defaultValue:null}},aggregations:{_vizFrame:{type:"sap.viz.ui5.controls.VizFrame",multiple:false,visibility:"hidden"},_rangeSlider:{type:"sap.viz.ui5.controls.VizRangeSlider",multiple:false,visibility:"hidden"},dataset:{type:"sap.viz.ui5.data.Dataset",multiple:false},feeds:{type:"sap.viz.ui5.controls.common.feeds.FeedItem",multiple:true,singularName:"feed"}},events:{rangeChanged:{}}}});c.prototype.applySettings=function(){B.prototype.applySettings.apply(this,arguments);var v=new V({width:this.getWidth(),height:this.getHeight(),vizType:this.getVizType(),uiConfig:this.getUiConfig()});v.attachRenderComplete(h.bind(this));var r=new a({visible:false,showAdvancedTooltip:false,showHandleTooltip:false});r.setParentFrame(v);this.setAggregation("_vizFrame",v);this.setAggregation("_rangeSlider",r);r.attachChange(p.bind(this));};var S=["info/column","info/line","info/timeseries_line","info/timeseries_column"];c.prototype.setVizType=function(v){if(v.indexOf("info/")!==0){v="info/"+v;}if(S.indexOf(v)===-1){v="info/null";}this.setProperty('vizType',v);return this;};c.prototype.getDataset=function(e){var v=this._getVizFrame();return(v&&v.getDataset())||this.getAggregation("dataset");};c.prototype.addFeed=function(e){var v=this._getVizFrame();if(v){v.addFeed(e);}else{this.addAggregation("feeds",e);}return this;};c.prototype.removeFeed=function(e){var v=this._getVizFrame();if(v){v.removeFeed(e);}else{this.removeAggregation("feeds",e);}return this;};c.prototype.removeAllFeeds=function(){var v=this._getVizFrame();if(v){v.removeAllFeeds();}else{this.removeAllAggregation("feeds");}return this;};c.prototype.getFeeds=function(){var v=this._getVizFrame();return(v&&v.getFeeds())||this.getAggregation("feeds");};c.prototype.exit=function(){var v=this._getVizFrame();v&&v.detachRenderComplete(h.bind(this),this);var r=this.getAggregation("_rangeSlider");r&&r.detachChange(p.bind(this));};c.prototype._getVizFrame=function(){return this.getAggregation("_vizFrame");};c.prototype._getRangeSlider=function(){return this.getAggregation("_rangeSlider");};c.prototype.onAfterRendering=function(){var v=this._getVizFrame();var e={valueAxis:{visible:this.getProperty("valueAxisVisible")}};e=q.extend(true,{},e,b);v.setVizProperties(e);v.setUiConfig(this.getProperty("uiConfig"));v.setVizType(this.getProperty("vizType"));v.setHeight(this.getProperty("height"));v.setWidth(this.getProperty("width"));var j=this.getAggregation("dataset");if(j){this.removeAggregation("dataset");v.setDataset(j);}var k=this.getAggregation("feeds");if(k){this.removeAllAggregation("feeds");v.removeAllFeeds();for(var i=0;i<k.length;++i){v.addFeed(k[i]);}}var r=this._getRangeSlider();r.setShowStartEndLabel(this.getProperty("showStartEndLabel"));r.setShowPercentageLabel(this.getProperty("showPercentageLabel"));};c.prototype.setRange=function(r){this.setProperty("range",r);this.invalidate();if(this._getVizFrame()){if(this._getVizFrame()._vizFrame){u.call(this,r);}}};function d(){var t=this.getVizType();return t==="info/timeseries_column"||t==="info/timeseries_line";}function g(o){return o[Object.keys(o)[0]];}c.prototype.getRange=function(){if(!d.apply(this)){return null;}return this.rangeState;};function u(r){var e=this._getRangeSlider();var v=this._getVizFrame();e.setRange(f.call(this,r));var i=e.getRange();var j=v._getDataRange(i[0],i[1]);this.rangeState={start:g(j.start),end:g(j.end)};}function f(i){if(!d.apply(this)){return null;}if(!i||(!("start"in i)&&!("end"in i))){return[0,100];}var r=new Date(i.start).getTime();var e=new Date(i.end).getTime();var t=this._getVizFrame()._getDataRange(0,100);var j=this.getRange();var k=g(t.start);var l=g(t.end);if(!j){j={};j.start=k;j.end=l;}r=isNaN(r)?j.start:r;e=isNaN(e)?j.end:e;if(r<e&&r<l&&e>k){r=Math.max(r,k);e=Math.min(e,l);var m=l-k;return[(r-k)/m*100,(e-k)/m*100];}return[0,100];}function h(){var s=this._getVizFrame()._states().plot.sizeInfo;var v=this._getVizFrame();this._curRange=[];var r=this._getRangeSlider();if(s){r.setWidth(s.width+"px");r.setHeight(s.height+"px");r.setLeft(s.x+"px");r.setTop(s.y+"px");r.setVisible(true);r.invalidate();if(d.apply(this)){var e=this.rangeState?this.rangeState:this.getProperty("range");u.call(this,e);}}else{r.setVisible(false);}v._setTitleAria("A noninteractive "+v._getMetadata().name+" with Range Slider ");}function p(e,i){var r=e.getParameters().range;if(this._curRange[0]===r[0]&&this._curRange[1]===r[1]){return;}else{var v=this._getVizFrame();var j=v._getDataRange(r[0],r[1]);if(d.apply(this)){this.rangeState={start:g(j.start),end:g(j.end)};}this._curRange[0]=r[0];this._curRange[1]=r[1];delete j.displayValues;this.fireEvent("rangeChanged",{data:j});}}return c;});
