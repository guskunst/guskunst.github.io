sap.ui.define(["sap/suite/ui/generic/template/changeHandler/util/ChangeHandlerUtils","sap/suite/ui/generic/template/changeHandler/util/AnnotationChangeUtilsV2","sap/suite/ui/generic/template/designtime/utils/DesigntimeUtils"],function(U,A,D){"use strict";var G={},a="com.sap.vocabularies.UI.v1.DataFieldForAnnotation",b="com.sap.vocabularies.UI.v1.DataField",c="com.sap.vocabularies.UI.v1.DataFieldWithUrl",I="com.sap.vocabularies.UI.v1.DataFieldWithIntentBasedNavigation",d="com.sap.vocabularies.UI.v1.DataFieldWithNavigationPath",F="com.sap.vocabularies.UI.v1.FieldGroup",C="com.sap.vocabularies.Communication.v1.Contact",e="com.sap.vocabularies.Communication.v1.Address",f="Datafield",g="Contact",h="Address",i="DataFieldWithIntentBasedNavigation",j="DatafieldWithUrl",k="DataFieldWithNavigationPath";G.getGroupElementRecord=function(E){var t=U.getTemplatingInfo(E);if(t&&t.annotationContext){return t.annotationContext;}};G.createNewRecord=function(r,o){var p,l={Criticality:{},CriticalityRepresentation:{},IconUrl:{}},R={};R[b]=jQuery.extend({},l,{Label:{},Value:{}});R[c]=jQuery.extend({},l,{Label:{},Value:{Path:""},Url:{Path:""}});R[a]=jQuery.extend({},l,{Label:{String:""},Target:{AnnotationPath:""}});R[I]=jQuery.extend({},l,{Label:{},SemanticObject:{String:"Semantic_Object"},Action:{},Value:{}});R[d]=jQuery.extend({},l,{Label:{},Value:{Path:""},Target:{NavigationPropertyPath:""}});var n={"com.sap.vocabularies.UI.v1.Importance":{"EnumMember":"com.sap.vocabularies.UI.v1.ImportanceType/High"},"RecordType":r,"EdmType":"Edm.String"};jQuery.extend(true,n,R[r]);for(p in n){if(p!=="RecordType"&&p!=="Target"&&o&&o[p]){jQuery.extend(n[p],o[p]);}if(jQuery.isEmptyObject(n[p])){delete n[p];}}return n;};G.getGroupElementTypeValues=function(){var v={Datafield:{displayName:"Data Field"},DatafieldWithUrl:{displayName:"Data Field with URL"},Contact:{displayName:"Contact"},Address:{displayName:"Address"},DataFieldWithIntentBasedNavigation:{displayName:"Intent Based Navigation"},DataFieldWithNavigationPath:{displayName:"DataField with Navigation Path"}};return v;};G.getGroupElementType=function(E){var r=G.getGroupElementRecord(E);var s;if(r){switch(r.RecordType){case a:var l=r.Target.AnnotationPath;if(l){if(r.Target.AnnotationPath.indexOf(C)>-1){s=g;}else if(r.Target.AnnotationPath.indexOf(e)>-1){s=h;}}break;case I:s=i;break;case b:s=f;break;case c:s=j;break;case d:s=k;break;default:break;}}return s;};G.setGroupElementType=function(o,n){var O=G.getGroupElementType(o);if(O===n){return;}var r="";var m={};var E={};var l=[];var p=[];var s="";var q=[];var t=-1;var u={};var v=[];var T={};var w="";var M=o.getModel();m=M&&M.getMetaModel();T=U.getTemplatingInfo(o);E=m.getODataEntityType(T.target);s=T.annotation;l=E[s];p=JSON.parse(JSON.stringify(l));q=(s.indexOf(F)>=0)?l.Data:l;t=U.getIndexFromInstanceMetadataPath(o);if(t===-1){throw"invalid index for old group element";}switch(n){case f:r=b;break;case j:r=c;break;case i:r=I;break;case g:w=G.fixQualifierForNewGroupElement(o,q,C,undefined);var x=D.createNewContact();u=A.createCustomAnnotationTermChange(T.target,x,{},w);v.push(u);r=a;break;case h:w=G.fixQualifierForNewGroupElement(o,q,e,undefined);var y=D.createNewAddress();u=A.createCustomAnnotationTermChange(T.target,y,{},w);v.push(u);r=a;break;case k:r=d;break;default:break;}if(!r){return;}var z=G.getGroupElementRecord(o);var N=G.createNewRecord(r,z);switch(n){case g:if(!N.Label.String){N.Label.String="New Contact";}N.Target.AnnotationPath="@"+w;break;case h:if(!N.Label.String){N.Label.String="New Address";}N.Target.AnnotationPath="@"+w;break;case i:N.SemanticObject.String=N.SemanticObject.String+"_"+parseInt(t,10);break;default:break;}var B={"annotation":s,"annotationContext":N,"path":T.path,"target":E.namespace+"."+E.name,"value":N.Value&&N.Value.Path||N.Target&&N.Target.AnnotationPath};o.data("sap-ui-custom-settings")["sap.ui.dt"].annotation=B;q.splice(t,1,N);u=A.createCustomAnnotationTermChange(T.target,l,p,s);v.push(u);return v;};G.fixQualifierForNewGroupElement=function(o,l,t,B){var m=U.getIndexFromInstanceMetadataPath(o);var s=D.fixQualifierForAnnotationPath(l,t,B,m);return s;};return G;});
