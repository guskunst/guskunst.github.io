sap.ui.define(["jquery.sap.global","sap/ui/base/Object","sap/ui/Device","sap/ui/model/json/JSONModel","sap/m/MessageToast","sap/m/ActionSheet","sap/m/Dialog","sap/m/Popover","sap/suite/ui/generic/template/lib/deletionHelper","sap/suite/ui/generic/template/lib/routingHelper","sap/suite/ui/generic/template/lib/SaveScenarioHandler","sap/suite/ui/generic/template/lib/ContextBookkeeping","sap/suite/ui/generic/template/lib/CRUDHelper","sap/suite/ui/generic/template/lib/StatePreserver","sap/suite/ui/generic/template/lib/testableHelper","sap/base/Log"],function(q,B,D,J,M,A,a,P,d,r,S,C,b,c,t,L){"use strict";var s=(t.testableStatic(function(T,o){var h="sapUiSizeCozy",i="sapUiSizeCompact";if(o.hasClass(h)||o.hasClass(i)){return"";}else{return T?h:i;}},"Application_determineContentDensityClass")(D.support.touch,q(document.body)));function g(){return s;}function f(o,p){q.sap.syncStyleClass(s,p,o);p.addDependent(o);}var f=t.testableStatic(f,"Application_attachControlToParent");function e(T){var o=new C(T.oAppComponent);var E;var n=Object.create(null);function h(i){var j=T.oNavigationControllerProxy.getActiveComponents();return j.indexOf(i.getId())>=0;}var I=false;function k(i){T.fnAddSideEffectPromise(i);}function p(i,j){if(I){return;}var o1=q.grep(T.aRunningSideEffectExecutions,function(p1){return!!p1;});if(o1.length){I=true;Promise.all(o1).then(function(){I=false;p(i,j);});}else if(!(j&&T.oBusyHelper.isBusy())){i();}}function m(i){var j;if(i instanceof a){j="open";}else if(i instanceof P||i instanceof A){j="openBy";}if(j){var o1=i[j];i[j]=function(){var p1=arguments;p(function(){if(!T.oBusyHelper.isBusy()){T.oBusyHelper.getUnbusy().then(function(){o1.apply(i,p1);});}});};}}var F={};function l(i,j,o1,p1,q1){i=i||T.oNavigationHost;var r1=i.getId();var s1=F[r1]||(F[r1]={});var t1=s1[j];if(!t1){t1=sap.ui.xmlfragment(r1,j,o1);f(t1,i);var u1;if(p1){u1=new J();t1.setModel(u1,p1);}(q1||q.noop)(t1,u1);s1[j]=t1;m(t1);}return t1;}function u(){return new Promise(function(i){T.oNavigationObserver.getProcessFinished(true).then(function(){T.oBusyHelper.getUnbusy().then(i);});});}function v(i){T.oShellServicePromise.then(function(j){j.setBackNavigation(i);});}var w=false;function x(i){if(w&&!i){var j=T.oAppComponent.getModel();j.resetChanges();}w=i;}function y(i,j){return b.createNonDraft("/"+i,T.oAppComponent.getModel(),x,j);}function z(i,j){if(!T.oFlexibleColumnLayoutHandler){return true;}var o1=r.determineNavigationPath(i,j);return T.oFlexibleColumnLayoutHandler.isNewHistoryEntryRequired(o1);}function R(i){T.aStateChangers.push(i);}function G(i,j){j.then(function(){o.adaptAfterObjectDeleted(i);});}function H(i,j,o1){var p1=T.mEntityTree[i];var q1;if(p1.navigationProperty&&p1.parent){q1=j?p1.entitySet:p1.navigationProperty;}else{q1=i;}if(o1.indexOf(q1)<0){o1.unshift(q1);if(p1.navigationProperty&&p1.parent){H(p1.parent,j,o1);}}}function K(i,j){var o1=[];H(i,j,o1);return o1;}function N(j){var o1=K(j);o1.pop();var p1="";var q1="";var r1=[];for(var i=0;i<o1.length;i++){p1=p1+q1+o1[i];r1.push(p1);q1="/";}return r1;}function O(){var i=T.oNavigationControllerProxy.oHashChanger.getHash();var j=i.split("?")[0];var o1=j.split("/");if(o1[0]===""||o1[0]==="#"){o1.splice(0,1);}return o1;}function Q(j,o1,p1){var q1=[];var r1=T.oNavigationControllerProxy.getCurrentIdentity();var s1=r1.treeNode;var t1=O();var u1=s1.level-(o1?0:1);var v1="";var w1="";for(var i=0;i<=u1;i++){var x1={link:v1};if(i>0){x1.section=t1[i-1];}q1.push(x1);if(i<u1){v1=v1+w1+t1[i];w1="/";}}var y1=[];var z1=function(B1){var x1=q1[B1.level];x1.entitySet=B1.entitySet;x1.mAppStates=Object.create(null);var C1=T.oNavigationControllerProxy.getApplicableStateForComponentAddedPromise(B1.componentId,x1.link,x1.mAppStates);y1[B1.level]=C1.then(function(){if(T.oFlexibleColumnLayoutHandler){T.oFlexibleColumnLayoutHandler.adaptBreadCrumbUrlParameters(x1.mAppStates,B1);}x1.fullLink=T.oNavigationControllerProxy.concatPathAndAppStates(x1.link,x1.mAppStates);return x1;});};if(o1){z1(s1);}for(var A1=j?0:1;s1.level>A1;){s1=T.mRoutingTree[s1.parentRoute];z1(s1);}return{aInfoObjects:q1,aInfoObjectPromises:y1};}function U(){var j=T.oNavigationControllerProxy.getActiveComponents();var o1=0;var p1;for(var i=0;i<j.length;i++){var q1=T.componentRegistry[j[i]];if(q1.viewLevel>0&&(o1===0||q1.viewLevel<o1)){o1=q1.viewLevel;p1=q1.oComponent;}}var r1=p1?Promise.resolve(p1):T.oNavigationControllerProxy.getRootComponentPromise();return r1.then(function(s1){return s1.getModel("i18n").getResourceBundle();});}function V(){return T.oNavigationControllerProxy.getAppTitle();}function W(i,j){T.oNavigationControllerProxy.subTitleForViewLevelChanged(i,j);}function X(i){return T.oNavigationControllerProxy.getCurrentKeys(i);}function Y(){for(var i in T.componentRegistry){var j=T.componentRegistry[i];if(j.viewLevel===1){if(h(j.oComponent)){var o1=j.oComponent.getComponentContainer().getElementBinding();return o1&&o1.getPath();}else{return null;}}}return null;}function Z(i){if(i.viewLevel){var j=i.oComponent.getEntitySet();return T.mEntityTree[j];}return T.mRoutingTree.root;}function $(o1,p1,q1,r1,s1){var t1=Z(q1);var u1=false;var v1;var w1=true;for(var i=0;i<t1.children.length&&!v1;i++){var x1=t1.children[i];var y1=T.mEntityTree[x1];if(y1[q1.viewLevel?"navigationProperty":"sRouteName"]===o1){v1=y1.sRouteName;w1=!y1.noKey;}}if(r1&&!v1){var z1=t1.embeddedComponents[r1];if(z1){for(var j=0;j<z1.pages.length&&!u1;j++){var A1=z1.pages[j];if(A1.navigationProperty===o1){u1=true;v1=q1.route+"/"+r1+"/"+o1;w1=!(A1.routingSpec&&A1.routingSpec.noKey);}}}}if(v1){var B1=u1?r1+r.getPatternDelimiter():"";var C1=w1?"("+p1+")":"";var D1=B1+o1+C1;T.oNavigationControllerProxy.navigateToSuffix(D1,q1.viewLevel+1,v1,s1);}}var _;function a1(j,o1){var i=o1||0;if(i>0){return null;}var p1=j.getEntitySet();var q1=T.mEntityTree[p1];var r1=q1&&q1.communicationObject;for(;i<0&&r1;){q1=T.mEntityTree[q1.parent];if(q1.communicationObject!==r1){i++;r1=q1.communicationObject;}}if(i<0||r1){return r1;}_=_||{};return _;}function b1(i){for(var j in T.mEntityTree){if(T.mEntityTree[j].navigationProperty&&(T.mEntityTree[j].level===i+1)){return T.mEntityTree[j].navigationProperty;}}}function c1(){return T.oFlexibleColumnLayoutHandler?T.oFlexibleColumnLayoutHandler.getMaxColumnCountInFCL():false;}function d1(){var j=T.oNavigationControllerProxy.getActiveComponents();for(var i=0;i<j.length;i++){var o1=j[i];var p1=T.componentRegistry[o1];var q1=p1.methods.currentDraftModified&&p1.methods.currentDraftModified();if(q1){o.markDraftAsModified(q1);}}}function e1(){if(E!==undefined){return E;}var i,j,o1,p1,q1,r1,s1=true;var t1=T.oAppComponent.getModel();var u1=t1.getMetaModel();var v1=t1.mContexts;for(o1 in v1){s1=false;q1=v1[o1].sPath;p1=q1&&q1.substring(1,q1.indexOf('('));r1=p1&&u1.getODataEntitySet(p1);if(r1){i=t1.getProperty(q1);j=i&&t1.getETag(undefined,undefined,i)||null;if(j){E=true;return E;}}}if(s1){return true;}E=false;return E;}function f1(j){var i,o1,p1;var q1=T.oNavigationControllerProxy.getAllComponents();for(i=0;i<q1.length;i++){o1=q1[i];if(!j||!j[o1]){p1=T.componentRegistry[o1];p1.utils.refreshBinding(true);}}}function g1(i){if(T.oFlexibleColumnLayoutHandler){T.oFlexibleColumnLayoutHandler.setStoredTargetLayoutToFullscreen(i);}}function h1(){T.oPaginatorInfo={};}function i1(i){return new c(T,i);}function j1(i,j){return new S(T,i,j);}function k1(j,o1){var p1=n[j];if(!p1){p1=Object.create(null);n[j]=p1;var q1=T.oAppComponent.getModel();var r1=q1.getMetaModel();var s1=r1.getODataEntitySet(j);var t1=s1&&r1.getODataEntityType(s1.entityType);var u1=(t1&&t1.navigationProperty)||[];for(var i=0;i<u1.length;i++){var v1=u1[i];p1[v1.name]=v1;}}return p1[o1];}function l1(i){var j=T.oNavigationControllerProxy.getSwitchToSiblingPromise(i);T.oBusyHelper.setBusy(j.then(function(o1){o1();}));}function m1(i){var j=i&&i.getObject();var o1=j&&j.IsActiveEntity;if(!o1){return Promise.resolve(d.getNavigateAfterDeletionOfCreateDraft(T));}return T.oNavigationControllerProxy.getSwitchToSiblingPromise(i).then(function(p1){return function(){var q1=i.getModel();q1.invalidateEntry(i);p1();};});}function n1(i){T.oNavigationControllerProxy.navigateAfterActivation(i);}T.oApplicationProxy={getDraftSiblingPromise:o.getDraftSiblingPromise,getSiblingPromise:o.getSiblingPromise,getAlternativeContextPromise:o.getAlternativeContextPromise,getPathOfLastShownDraftRoot:o.getPathOfLastShownDraftRoot,areTwoKnownPathesIdentical:o.areTwoKnownPathesIdentical,getResourceBundleForEditPromise:U,getHierarchySectionsFromCurrentHash:O,getLinkToUpperLayersInfo:Q,getContentDensityClass:g,setEditableNDC:x,getDialogFragment:l.bind(null,null),destroyView:function(i){delete F[i];},markCurrentDraftAsModified:d1,prepareDeletion:G,performAfterSideEffectExecution:p};return{setEditableNDC:x,getEditableNDC:function(){return w;},createNonDraft:y,getContentDensityClass:g,attachControlToParent:f,getDialogFragmentForView:l,getBusyHelper:function(){return T.oBusyHelper;},addSideEffectPromise:k,performAfterSideEffectExecution:p,isComponentActive:h,showMessageToast:function(){var i=arguments;var j=function(){L.info("Show message toast");M.show.apply(M,i);};Promise.all([u(true),T.oBusyHelper.getUnbusy()]).then(j);},setBackNavigation:v,isNewHistoryEntryRequired:z,registerStateChanger:R,getDraftSiblingPromise:o.getDraftSiblingPromise,registerContext:o.registerContext,activationStarted:o.activationStarted,cancellationStarted:o.cancellationStarted,editingStarted:o.editingStarted,getBreadCrumbInfo:N,getSections:K,getHierarchySectionsFromCurrentHash:O,getLinkToUpperLayersInfo:Q,getAppTitle:V,subTitleForViewLevelChanged:W,getCurrentKeys:X,getPathForViewLevelOneIfVisible:Y,getCommunicationObject:a1,navigateRoute:$,getForwardNavigationProperty:b1,getMaxColumnCountInFCL:c1,markCurrentDraftAsModified:d1,checkEtags:e1,refreshAllComponents:f1,getIsDraftModified:o.getIsDraftModified,prepareDeletion:d.prepareDeletion.bind(null,T),setStoredTargetLayoutToFullscreen:g1,invalidatePaginatorInfo:h1,getStatePreserver:i1,getSaveScenarioHandler:j1,getNavigationProperty:k1,switchToDraft:l1,getNavigateAfterCancelPromise:m1,navigateAfterActivation:n1};}return B.extend("sap.suite.ui.generic.template.lib.Application",{constructor:function(T){q.extend(this,e(T));}});});
