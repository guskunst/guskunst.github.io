/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["jquery.sap.global","sap/suite/ui/generic/template/changeHandler/util/ChangeHandlerUtils","sap/suite/ui/generic/template/changeHandler/util/AnnotationChangeUtilsV2"],function(q,U,A){"use strict";var a={};var I="com.sap.vocabularies.UI.v1.Identification";var D="com.sap.vocabularies.UI.v1.DataFieldForAction";a.applyChange=function(c,C,p){var d=c.getDefinition();if(!d.transferred){var P=c.getContent().customChanges[0].parentElementId;var o=c.getContent().customChanges[0].oParentSelector;var b=p.modifier.bySelector(o);var n=c.getContent().newFunctionImport;var N="action::"+n.replace("/","::");var s=P.substring(0,P.lastIndexOf("--"));N=s+N;var e=new sap.m.Button(N,{text:'New Action'});e.addCustomData(new sap.ui.core.CustomData({"key":"Action","value":n}));if(P.indexOf("--template::ObjectPage::FooterToolbar")>-1){b.insertContent(e,c.getContent().customChanges[0].targetIndex);}else{b.getFooter().insertContent(e,c.getContent().customChanges[0].targetIndex);}}};a.revertChange=function(c,C,p){};a.completeChangeContent=function(c,s,p){var S=p.modifier.bySelector(s.selector.id,p.appComponent);var P=S.getParent();var o=p.modifier.getSelector(P.getId(),p.appComponent);var C=U.getComponent(S);var e=U.getODataEntityType(C);var E=e.entityType;var b=e[I];var d=b.slice();var B;if(S.getId().indexOf("::Determining")>-1){B=S.getParent().getContent();}else{B=S.getContent();}var f=-1;B.some(function(j,i){if(j.getId&&j.getId()===s.selector.id){f=i;return true;}});var g=-1;g=U.getIndexFromInstanceMetadataPath(B[f]);g++;var n={Label:{String:"My new Action"},Action:{String:s.content.newFunctionImport},RecordType:D,Determining:{Bool:"true"}};b.splice(g,0,n);var m=A.createCustomAnnotationTermChange(E,b,d,I);m.targetIndex=f+1;m.parentElementId=P.getId();m.oParentSelector=o;var h=A.createCustomChanges(m);q.extend(true,c.getContent(),h);};return a;},true);
