/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['./LabelEnablement','sap/ui/base/Object','sap/ui/dom/patch','sap/ui/performance/trace/Interaction','sap/base/util/uid',"sap/ui/util/ActivityDetection","sap/ui/thirdparty/jquery","sap/base/security/encodeXML","sap/base/security/encodeCSS","sap/base/assert","sap/ui/performance/Measurement","sap/base/Log","./InvisibleRenderer"],function(L,B,d,I,u,A,q,a,b,c,M,f,g){"use strict";var C=["renderControl","cleanupControlWithoutRendering"];var s=["write","writeEscaped","writeAcceleratorKey","writeControlData","writeElementData","writeAttribute","writeAttributeEscaped","addClass","writeClasses","addStyle","writeStyles","writeAccessibilityState","writeIcon","translate","getConfiguration","getHTML"];var D=["openStart","openEnd","close","voidStart","voidEnd","text","attr","class","style","accessibilityState","icon","unsafeHtml"];var n=["render","flush","destroy"];var h=((window["sap-ui-config"]&&window["sap-ui-config"]["xx-debugRendering"])||/sap-ui-xx-debug(R|-r)endering=(true|x|X)/.test(document.location.search));function R(){var l=this,p,v,x,S,G,H;this._setFocusHandler=function(e){c(e&&B.isA(e,'sap.ui.core.FocusHandler'),"oFocusHandler must be an sap.ui.core.FocusHandler");p=e;};function J(){v=l.aBuffer=[];x=l.aRenderedControls=[];S=l.aStyleStack=[{}];}this.write=function(e){c((typeof e==="string")||(typeof e==="number"),"sText must be a string or number");v.push.apply(v,arguments);return this;};this.writeEscaped=function(e,i){if(e!=null){e=a(String(e));if(i){e=e.replace(/&#xa;/g,"<br>");}v.push(e);}return this;};this.writeAttribute=function(e,i){c(typeof e==="string","sName must be a string");c(typeof i==="string"||typeof i==="number"||typeof i==="boolean","value must be a string, number or boolean");v.push(" ",e,"=\"",i,"\"");return this;};this.writeAttributeEscaped=function(e,i){c(typeof e==="string","sName must be a string");v.push(" ",e,"=\"",a(String(i)),"\"");return this;};this.addStyle=function(e,i){c(typeof e==="string","sName must be a string");if(i!=null&&i!=""){c((typeof i==="string"||typeof i==="number"),"value must be a string or number");var j=S[S.length-1];if(!j.aStyle){j.aStyle=[];}j.aStyle.push(e+": "+i+";");}return this;};this.writeStyles=function(){var e=S[S.length-1];if(e.aStyle&&e.aStyle.length){this.writeAttribute("style",e.aStyle.join(" "));}e.aStyle=null;return this;};this.addClass=function(e){if(e){c(typeof e==="string","sName must be a string");var i=S[S.length-1];if(!i.aClasses){i.aClasses=[];}i.aClasses.push(e);}return this;};this.writeClasses=function(e){c(!e||typeof e==="boolean"||B.isA(e,'sap.ui.core.Element'),"oElement must be empty, a boolean, or an sap.ui.core.Element");var i=S[S.length-1];var j;if(e){j=e.aCustomStyleClasses;}else if(e===false){j=[];}else{j=i.aCustomStyleClasses;}if(i.aClasses||j){var Y=[].concat(i.aClasses||[],j||[]);if(Y.length){this.writeAttribute("class",Y.join(" "));}}if(!e){i.aCustomStyleClasses=null;}i.aClasses=null;return this;};var O="";var V=false;function K(e){c(e,"There is an open tag; '"+O+"' tag not yet closed with '"+(V?"voidEnd":"openEnd")+"'");}this.openStart=function(e,i){c(typeof e=="string"&&/^[a-z_][a-z0-9_\-]*$/.test(e),"The tag name provided ('"+e+"') is not a valid name to open tag");K(!O);O=e;this.write("<"+e);if(i){if(typeof i=="string"){this.attr("id",i);}else{this.writeElementData(i);}}return this;};this.openEnd=function(){c(O,"Ending a tag via 'openEnd' must be preceded by 'openStart'");K(!V);O="";this.writeClasses();this.writeStyles();this.write(">");return this;};this.close=function(e){c(typeof e=="string"&&/^[a-z][a-z0-9_\-]*$/.test(e),"The tag name provided ('"+e+"') is not a valid name to close tag");K(!O);this.write("</"+e+">");return this;};this.voidStart=function(e,i){this.openStart(e,i);V=true;return this;};this.voidEnd=function(){c(O,"Ending a tag via 'voidEnd' must be preceded by 'voidStart'");K(V||!O);V=false;O="";this.writeClasses();this.writeStyles();this.write(">");return this;};this.unsafeHtml=function(e){K(!O);this.write(e);return this;};this.text=function(e){K(!O);this.writeEscaped(e);return this;};this.attr=function(e,i){c(e!=="class"&&e!=="style","Attributes 'class' and 'style' must not be written, instead use dedicated 'class' or 'style' methods");this.writeAttributeEscaped(e,i);return this;};this.class=function(e){if(e){c(typeof e==="string"&&!/\s/.test(e)&&arguments.length===1,"Method 'class' must be called with exactly one class name");this.addClass(e);}return this;};this.style=function(e,i){c(typeof e==="string"&&e&&!/\s/.test(e),"Method 'style' must be called with a non-empty string name");this.addStyle(e,i);return this;};this.accessibilityState=this.writeAccessibilityState;this.icon=this.writeIcon;function N(e){H=true;try{var i=q.Event("BeforeRendering");i.srcControl=e;e._handleEvent(i);}finally{H=false;}}this.cleanupControlWithoutRendering=function(e){c(!e||B.isA(e,'sap.ui.core.Control'),"oControl must be an sap.ui.core.Control or empty");if(!e||!e.getDomRef()){return;}N(e);e.bOutput=false;};this.renderControl=function(e){c(!e||B.isA(e,'sap.ui.core.Control'),"oControl must be an sap.ui.core.Control or empty");if(!e){return this;}if(!G){G=[];}if(G&&G.length>0){M.pause(G[0]+"---renderControl");}else if(e.getParent()&&e.getParent().getMetadata().getName()=="sap.ui.core.UIArea"){M.pause(e.getParent().getId()+"---rerender");}G.unshift(e.getId());M.start(e.getId()+"---renderControl","Rendering of "+e.getMetadata().getName(),["rendering","control"]);var j=v.length;M.pause(e.getId()+"---renderControl");var Y;var Z=e.getMetadata();var $=e.getVisible();if($){Y=Z.getRenderer();}else{var _=Z.getProperty("visible");var a1=_&&_._oParent&&_._oParent.getName()=="sap.ui.core.Control";Y=a1?g:Z.getRenderer();}M.resume(e.getId()+"---renderControl");N(e);var b1=e.aBindParameters;if(b1&&b1.length>0){var c1=q(e.getDomRef());if(c1&&c1[0]){for(var i=0;i<b1.length;i++){var d1=b1[i];c1.unbind(d1.sEventType,d1.fnProxy);}}}if(Y&&typeof Y.render==="function"){var e1={};if(e.aCustomStyleClasses&&e.aCustomStyleClasses.length>0){e1.aCustomStyleClasses=e.aCustomStyleClasses;}S.push(e1);Y.render(W,e);S.pop();}else{f.error("The renderer for class "+Z.getName()+" is not defined or does not define a render function! Rendering of "+e.getId()+" will be skipped!");}x.push(e);if(e.getUIArea&&e.getUIArea()){e.getUIArea()._onControlRendered(e);}e.bOutput=v.length!=j;if(Y===g){e.bOutput="invisible";}M.end(e.getId()+"---renderControl");G.shift();if(G&&G.length>0){M.resume(G[0]+"---renderControl");}else if(e.getParent()&&e.getParent().getMetadata().getName()=="sap.ui.core.UIArea"){M.resume(e.getParent().getId()+"---rerender");}return this;};this.getHTML=function(e){c(e&&B.isA(e,'sap.ui.core.Control'),"oControl must be an sap.ui.core.Control");var i=v;var j=v=this.aBuffer=[];this.renderControl(e);v=this.aBuffer=i;return j.join("");};function Q(Y){var i,Z=x.length;for(i=0;i<Z;i++){x[i]._sapui_bInAfterRenderingPhase=true;}H=true;try{for(i=0;i<Z;i++){var $=x[i];if($.bOutput&&$.bOutput!=="invisible"){var _=q.Event("AfterRendering");_.srcControl=$;M.start($.getId()+"---AfterRendering","AfterRendering of "+$.getMetadata().getName(),["rendering","after"]);$._handleEvent(_);M.end($.getId()+"---AfterRendering");}}}finally{for(i=0;i<Z;i++){delete x[i]._sapui_bInAfterRenderingPhase;}H=false;}try{p.restoreFocus(Y);}catch(e){f.warning("Problems while restoring the focus after rendering: "+e,null);}for(i=0;i<Z;i++){var $=x[i],a1=$.aBindParameters;if(a1&&a1.length>0){var b1=q($.getDomRef());if(b1&&b1[0]){for(var j=0;j<a1.length;j++){var c1=a1[j];b1.bind(c1.sEventType,c1.fnProxy);}}}}}function T(e){var i=p?p.getControlFocusInfo():null;var j=v.join("");e(j);Q(i);J();A.refresh();I.notifyStepEnd();}this.flush=function(e,j,Y){c((typeof e==="object")&&(e.ownerDocument==document),"oTargetDomNode must be a DOM element");if(!j&&(typeof Y!=="number")&&!Y){R.preserveContent(e);}T(function(Z){for(var i=0;i<x.length;i++){var $=x[i].getDomRef();if($&&!R.isPreservedContent($)){if(R.isInlineTemplate($)){q($).empty();}else{q($).remove();}}}if(typeof Y==="number"){if(Y<=0){q(e).prepend(Z);}else{var _=q(e).children().eq(Y-1);if(_.length===1){_.after(Z);}else{q(e).append(Z);}}}else if(!Y){q(e).html(Z);}else{q(e).append(Z);}});};this.render=function(e,i){c(e&&B.isA(e,'sap.ui.core.Control'),"oControl must be a control");c(typeof i==="object"&&i.ownerDocument==document,"oTargetDomNode must be a DOM element");if(H){f.error("Render must not be called within Before or After Rendering Phase. Call ignored.",null,this);return;}J();this.renderControl(e);T(function(j){if(e&&i){var Y=e.getDomRef();if(!Y||R.isPreservedContent(Y)){Y=document.getElementById(g.createInvisiblePlaceholderId(e))||document.getElementById(k.Dummy+e.getId());}var Z=Y&&Y.parentNode!=i;var $=function(){var a1=q(i);if(i.innerHTML==""){a1.html(j);}else{a1.append(j);}};if(Z){if(!R.isPreservedContent(Y)){if(R.isInlineTemplate(Y)){q(Y).empty();}else{q(Y).remove();}}if(j){$();}}else{if(j){if(Y){if(R.isInlineTemplate(Y)){q(Y).html(j);}else if(F()){var _=q.parseHTML(j)[0];q.cleanData([Y]);q.cleanData(Y.getElementsByTagName("*"));d(Y,_);}else{q(Y).replaceWith(j);}}else{$();}}else{if(R.isInlineTemplate(Y)){q(Y).empty();}else{if(!e.getParent()||!e.getParent()._onChildRerenderedEmpty||!e.getParent()._onChildRerenderedEmpty(e,Y)){q(Y).remove();}}}}}});};this.destroy=function(){J();};var U={};var W={};var X={};C.forEach(function(e){U[e]=W[e]=X[e]=l[e];});D.forEach(function(e){W[e]=X[e]=l[e];});s.forEach(function(e){U[e]=X[e]=l[e];if(h){W[e]=function(){f.error("**** calling legacy render method "+e);return l[e].apply(this,arguments);};}else{W[e]=l[e];}});n.forEach(function(e){X[e]=l[e];});this.getRendererInterface=function(){return W;};this.getInterface=function(){return X;};J();}R.prototype.getConfiguration=function(){return sap.ui.getCore().getConfiguration();};R.prototype.translate=function(K){};R.prototype.writeAcceleratorKey=function(){return this;};R.prototype.writeControlData=function(e){c(e&&B.isA(e,'sap.ui.core.Control'),"oControl must be an sap.ui.core.Control");this.writeElementData(e);return this;};R.prototype.writeElementData=function(e){c(e&&B.isA(e,'sap.ui.core.Element'),"oElement must be an sap.ui.core.Element");var j=e.getId();if(j){this.attr("id",j);this.attr("data-sap-ui",j);}var p=e.getCustomData();var l=p.length;for(var i=0;i<l;i++){var v=p[i]._checkWriteToDom(e);if(v){this.attr(v.key,v.value);}}var x=e.getDragDropConfig().some(function(H){return H.isDraggable(e);});if(!x){var G=e.getParent();if(G&&G.getDragDropConfig){x=G.getDragDropConfig().some(function(H){return H.isDraggable(e);});}}if(x){this.attr("draggable","true");this.attr("data-sap-ui-draggable","true");}return this;};R.prototype.writeAccessibilityState=function(e,j){if(!sap.ui.getCore().getConfiguration().getAccessibility()){return this;}if(arguments.length==1&&!(B.isA(e,'sap.ui.core.Element'))){j=e;e=null;}var l={};if(e!=null){var G=e.getMetadata();var H=function(i,v,V){var S=G.getProperty(i);if(S&&e[S._sGetter]()===V){l[v]="true";}};var J=function(v,S){var T=G.getAssociation(v);if(T&&T.multiple){var U=e[T._sGetter]();if(v=="ariaLabelledBy"){var V=L.getReferencingLabels(e);var W=V.length;if(W){var X=[];for(var i=0;i<W;i++){if(U.indexOf(V[i])<0){X.push(V[i]);}}U=X.concat(U);}}if(U.length>0){l[S]=U.join(" ");}}};H("editable","readonly",false);H("enabled","disabled",false);H("visible","hidden",false);if(L.isRequired(e)){l["required"]="true";}H("selected","selected",true);H("checked","checked",true);J("ariaDescribedBy","describedby");J("ariaLabelledBy","labelledby");}if(j){var K=function(v){var i=typeof(v);return v===null||v===""||i==="number"||i==="string"||i==="boolean";};var N={};var x,O,Q;for(x in j){O=j[x];if(K(O)){N[x]=O;}else if(typeof(O)==="object"&&K(O.value)){Q="";if(O.append&&(x==="describedby"||x==="labelledby")){Q=l[x]?l[x]+" ":"";}N[x]=Q+O.value;}}q.extend(l,N);}if(B.isA(e,'sap.ui.core.Element')&&e.getParent()&&e.getParent().enhanceAccessibilityState){e.getParent().enhanceAccessibilityState(e,l);}for(var p in l){if(l[p]!=null&&l[p]!==""){this.attr(p==="role"?p:"aria-"+p,l[p]);}}return this;};R.prototype.writeIcon=function(U,e,i){var j=sap.ui.requireSync("sap/ui/core/IconPool"),l=j.isIconURI(U),p=false,v,x,G,H,J;if(typeof e==="string"){e=[e];}if(l){x=j.getIconInfo(U);if(!x){f.error("An unregistered icon: "+U+" is used in sap.ui.core.RenderManager's writeIcon method.");return this;}if(!e){e=[];}e.push("sapUiIcon");if(!x.suppressMirroring){e.push("sapUiIconMirrorInRTL");}}if(l){this.openStart("span");}else{this.voidStart("img");}if(Array.isArray(e)){e.forEach(function(K){this.class(K);},this);}if(l){G={"data-sap-ui-icon-content":x.content,"role":"presentation","title":x.text||null};this.style("font-family","'"+b(x.fontFamily)+"'");}else{G={role:"presentation",alt:"",src:U};}i=q.extend(G,i);if(!i.id){i.id=u();}if(l){H=i.alt||i.title||x.text||x.name;J=i.id+"-label";if(i["aria-labelledby"]){p=true;i["aria-labelledby"]+=(" "+J);}else if(!i.hasOwnProperty("aria-label")){i["aria-label"]=H;}}if(typeof i==="object"){for(v in i){if(i.hasOwnProperty(v)&&i[v]!==null){this.attr(v,i[v]);}}}if(l){this.openEnd();if(p){this.openStart("span");this.style("display","none");this.attr("id",J);this.openEnd("span");this.text(H);this.close("span");}this.close("span");}else{this.voidEnd();}return this;};R.prototype.getRenderer=function(e){c(e&&B.isA(e,'sap.ui.core.Control'),"oControl must be an sap.ui.core.Control");return R.getRenderer(e);};var k=R.RenderPrefixes={Invisible:g.PlaceholderPrefix,Dummy:"sap-ui-dummy-",Temporary:"sap-ui-tmp-"};R.getRenderer=function(e){c(e&&B.isA(e,'sap.ui.core.Control'),"oControl must be an sap.ui.core.Control");return e.getMetadata().getRenderer();};R.forceRepaint=function(v){var e=v?window.document.getElementById(v):null;var i=typeof v=="string"?e:v;if(i){f.debug("forcing a repaint for "+(i.id||String(i)));var O=i.style.display;var j=document.activeElement;i.style.display="none";i.offsetHeight;i.style.display=O;if(document.activeElement!==j&&j){j.focus();}}};R.createInvisiblePlaceholderId=function(e){return g.createInvisiblePlaceholderId(e);};var m="sap-ui-preserve",o="sap-ui-static",r="data-sap-ui-preserve",t="data-sap-ui-area";function w(){var $=q(document.getElementById(m));if($.length===0){$=q("<DIV/>",{"aria-hidden":"true",id:m}).addClass("sapUiHidden").addClass("sapUiForcedHidden").css("width","0").css("height","0").css("overflow","hidden").appendTo(document.body);}return $;}function y(e){q("<DIV/>",{id:k.Dummy+e.id}).addClass("sapUiHidden").insertBefore(e);}var P=[];R.attachPreserveContent=function(l,e){R.detachPreserveContent(l);P.push({fn:l,context:e});};R.detachPreserveContent=function(l){P=P.filter(function(e){return e.fn!==l;});};R.preserveContent=function(e,p,j){c(typeof e==="object"&&e.ownerDocument==document,"oRootNode must be a DOM element");P.forEach(function(i){i.fn.call(i.context||R,{domNode:e});});var $=w();function l(i){while(i&&i!=e&&i.parentNode){i=i.parentNode;if(i.hasAttribute(r)){return true;}if(i.hasAttribute("data-sap-ui")){break;}}}function v(i){if(i.id===m||i.id===o){return;}if(i.hasAttribute(r)){if(i===e||l(i)){y(i);}$.append(i);}else if(j&&i.id){R.markPreservableContent(q(i),i.id);$.append(i);return;}if(!i.hasAttribute(t)){var x=i.firstChild;while(x){i=x;x=x.nextSibling;if(i.nodeType===1){v(i);}}}}M.start(e.id+"---preserveContent","preserveContent for "+e.id,["rendering","preserve"]);if(p){v(e);}else{q(e).children().each(function(i,N){v(N);});}M.end(e.id+"---preserveContent");};R.findPreservedContent=function(i){c(typeof i==="string","sId must be a string");var $=w(),e=$.children("["+r+"='"+i.replace(/(:|\.)/g,'\\$1')+"']");return e;};R.markPreservableContent=function($,i){$.attr(r,i);};R.isPreservedContent=function(e){return(e&&e.getAttribute(r)&&e.parentNode&&e.parentNode.id==m);};R.getPreserveAreaRef=function(){return w()[0];};var z="data-sap-ui-template";R.markInlineTemplate=function($){$.attr(z,"");};R.isInlineTemplate=function(e){return(e&&e.hasAttribute(z));};var E;function F(){if(E===undefined){E=sap.ui.getCore().getConfiguration().getDomPatching();if(E){f.warning("DOM Patching is enabled: This feature should be used only for testing purposes!");}}return E;}return R;},true);
