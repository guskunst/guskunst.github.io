/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","sap/m/Slider","./AnimationTimeSliderRenderer"],function(q,S,A){"use strict";var a=S.extend("sap.ui.vk.AnimationTimeSlider",{metadata:{library:"sap.ui.vk",associations:{viewport:{type:"sap.ui.vk.threejs.Viewport"}}}});a.prototype.init=function(){if(S.prototype.init){S.prototype.init.call(this);}this._playbackDurations=[];this._startTime=0;this._currentPlaybackIndex=-1;this._totalDuration=0;this._liveValueChange=false;this._liveValueChangeDone=false;this._currentLiveValue=-1;this._currentRestartPlaybackIndex=-1;this._previousValue=0;this._currentValue=0;this._pause=false;this._pauseDone=false;this.attachChange(function(e){this._currentLiveValue=e.getParameter("value");this._liveValueChangeDone=true;this._liveValueChange=false;this._setCurrentRestartPlaybackIndex();if(this.getViewport()){var v=sap.ui.getCore().byId(this.getViewport());v.setShouldRenderFrame();}});this.attachLiveChange(function(e){this._currentLiveValue=e.getParameter("value");this._liveValueChange=true;this._liveValueChangeDone=false;this._setCurrentRestartPlaybackIndex();if(this.getViewport()){var v=sap.ui.getCore().byId(this.getViewport());v.setShouldRenderFrame();}});};a.prototype._setCurrentRestartPlaybackIndex=function(){var b=0;var t=this._totalDuration*this._currentLiveValue/100;var p;for(p=0;p<this._playbackDurations.length;p++){b+=this._playbackDurations[p];if(t<b){this._currentRestartPlaybackIndex=p;break;}}};a.prototype.setPlaybackTimeIntervals=function(t){if(!t||!t.length){return;}this._playbackDurations=[];this._totalDuration=0;for(var b=0;b<t.length;b++){var c=t[b];this._playbackDurations.push(c);this._totalDuration+=c;}this._liveValueChange=false;this._liveValueChangeDone=false;this._currentLiveValue=-1;this._currentRestartPlaybackIndex=-1;this._previousValue=0;this._currentValue=0;this._pause=false;this._pauseDone=false;this.setValue(0);this.setStep(0.1);};a.prototype.startPlayback=function(p){this._startTime=Date.now();this._currentPlaybackIndex=p;var b=0;for(var c=0;c<this._currentPlaybackIndex;c++){b+=this._playbackDurations[c];}this._previousValue=100*b/this._totalDuration;this.setProgress(true);};a.prototype.getCurrentStatus=function(){var r={};var c=Date.now();var p,b;var d;var m=100;if(!this._liveValueChange&&!this._liveValueChangeDone&&!this._pause&&!this._pauseDone){b=0;for(p=0;p<this._currentPlaybackIndex;p++){b+=this._playbackDurations[p];}d=100*(b+(c-this._startTime)/1000)/this._totalDuration;m=100*(b+this._playbackDurations[this._currentPlaybackIndex])/this._totalDuration;if(m<d){this.setValue(m);}else{this.setValue(d);}}else if(this._liveValueChange||this._liveValueChangeDone){if(this._currentRestartPlaybackIndex!==this._currentPlaybackIndex||this._currentLiveValue<this._previousValue){r.delta=0;r.restartPlaybackIndex=this._currentRestartPlaybackIndex;return r;}d=this._currentLiveValue;if(this._liveValueChangeDone){this._liveValueChangeDone=false;b=0;for(p=0;p<this._currentPlaybackIndex;p++){b+=this._playbackDurations[p];}this._startTime=c-(d*this._totalDuration/100-b)*1000;}}else{d=this._previousValue;if(this._pauseDone){this._pauseDone=false;b=0;for(p=0;p<this._currentPlaybackIndex;p++){b+=this._playbackDurations[p];}this._startTime=c-(d*this._totalDuration/100-b)*1000;}}if(d>m&&m){r.delta=this._playbackDurations[this._currentPlaybackIndex]*2;d=m;}else{r.delta=this._totalDuration*(d-this._previousValue)/100;}r.restartPlaybackIndex=-1;this._previousValue=d;return r;};a.prototype.pause=function(){this._pause=true;};a.prototype.resume=function(){this._pause=false;this._pauseDone=true;if(this.getViewport()){var v=sap.ui.getCore().byId(this.getViewport());v.setShouldRenderFrame();}};a.prototype.togglePauseStatus=function(){if(this._pause){this._pause=false;this._pauseDone=true;if(this.getViewport()){var v=sap.ui.getCore().byId(this.getViewport());v.setShouldRenderFrame();}}else{this._pause=true;}};return a;},true);
