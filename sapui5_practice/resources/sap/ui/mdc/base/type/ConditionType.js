/*!
 * SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/model/SimpleType','sap/ui/model/FormatException','sap/ui/model/ParseException','sap/ui/model/ValidateException','sap/ui/model/type/String','sap/ui/mdc/library','sap/ui/mdc/base/FilterOperatorConfig','sap/ui/mdc/base/Condition','sap/base/util/merge'],function(S,F,P,V,a,l,b,C,m){"use strict";var c=l.FieldDisplay;var d=S.extend("sap.ui.mdc.base.type.ConditionType",{constructor:function(){S.apply(this,arguments);this.sName="Condition";}});d.prototype.destroy=function(){S.prototype.destroy.apply(this,arguments);if(this._oDefaultType){this._oDefaultType.destroy();delete this._oDefaultType;}if(this._oFilterOperatorConfig){this._oFilterOperatorConfig.destroy();delete this._oFilterOperatorConfig;}};d.prototype.formatValue=function(o,I){if(o==undefined||o==null){return null;}if(typeof o!=="object"||!o.operator||!o.values||!Array.isArray(o.values)){throw new F("No valid condition provided");}if(!I){I="string";}var D=_.call(this);var t=e.call(this);var k=h.call(this);var n=g.call(this);j.call(this,o,t);switch(this.getPrimitiveType(I)){case"string":case"any":if(this.oFormatOptions.onlyEEQ&&o.operator==="EQ"){o=m({},o);o.operator="EEQ";}if(o.operator==="EEQ"&&D!==c.Value&&o.values.length===1&&k){var s=k.getTextForKey(o.values[0],o.inParameters,o.outParameters);if(s){o=m({},o);o.values.push(s);}}if(this.oFormatOptions.hideOperator&&o.values.length>=1){return t.formatValue(o.values[0],"string");}var O=n.getOperator(o.operator);return O.format(o.values,o,t,D);default:if(t&&o.values.length>=1){return t.formatValue(o.values[0],I);}throw new F("Don't know how to format Condition to "+I);}};d.prototype.parseValue=function(v,I){if(!I){I="string";}else if(I==="any"&&typeof v==="string"){I="string";}var D=_.call(this);var o=h.call(this);var t=e.call(this);var T=t.getMetadata().getName();var O=f.call(this);var k=g.call(this);var s;if(!v){if(!i.call(this,t)){return null;}}switch(this.getPrimitiveType(I)){case"string":var n=v;var p;var q=false;if(this.oFormatOptions.onlyEEQ){p=k.getOperator("EEQ");if(!p.test(v,t)){n="=="+v;}}else{var r=k.getMatchingOperators(T,n);if(r.length===0){if(o&&!i.call(this,t)){p=k.getOperator("EEQ");if(!p.test(v,t)){n="=="+v;}q=true;}else{s=k.getDefaultOperator(T);p=k.getOperator(s);n=p?p.format([v]):v;}}else{p=r[0];}}if(p){var u;try{u=p.getCondition(n,t,D);}catch(E){if(E instanceof P&&O){O.parseValue(v,"string");}throw E;}if(p.name==="EEQ"&&u&&o&&!i.call(this,t)){var K;var w;var x=false;if(u.values[0]!==null&&u.values[0]!==undefined){w=o.getTextForKey(u.values[0]);if(w){u.values[1]=w;}else{u.values[1]=u.values[0];u.values[0]=null;x=true;}}if((u.values[0]===null||u.values[0]===undefined)&&u.values[1]){K=o.getKeyForText(u.values[1]);if(K!==undefined&&K!==null){u.values[0]=K;}else{u.values[0]=u.values[1];w=null;if(!x){w=o.getTextForKey(u.values[1]);}if(w){u.values[1]=w;}else{u.values[1]=null;if(q){s=k.getDefaultOperator(T);p=k.getOperator(s);n=p?p.format([v]):v;u=p.getCondition(n,t,D);}}}}}if(u){j.call(this,u,t);return u;}}throw new P("Cannot parse value "+v);default:if(t){if(this.oFormatOptions.onlyEEQ){s="EEQ";}else{s=k.getDefaultOperator(T);}return C.createCondition(s,[t.parseValue(v,I)]);}throw new P("Don't know how to parse Condition from "+I);}};d.prototype.validateValue=function(o){if(o==undefined||o==null){return null;}if(typeof o!=="object"||!o.operator||!o.values||!Array.isArray(o.values)){throw new V("No valid condition provided");}var t=e.call(this);var k=g.call(this);var O=k.getOperator(o.operator);O.validate(o.values,t);};function _(){var D=this.oFormatOptions.display;if(!D){D=c.Value;}return D;}function e(){var t=this.oFormatOptions.valueType;if(!t){if(!this._oDefaultType){this._oDefaultType=new a();}t=this._oDefaultType;}return t;}function f(){return this.oFormatOptions.originalDateType;}function g(){var o=this.oFormatOptions.filterOperatorConfig;if(!o){if(!this._oFilterOperatorConfig){this._oFilterOperatorConfig=new b();}o=this._oFilterOperatorConfig;}return o;}function h(){var I=this.oFormatOptions.fieldHelpID;if(I){return sap.ui.getCore().byId(I);}return null;}function i(t){return t&&t.isA("sap.ui.model.CompositeType");}function j(o,t){if(i.call(this,t)&&o&&o.values[0]){t._aCurrentValue=o.values[0];}}return d;});
