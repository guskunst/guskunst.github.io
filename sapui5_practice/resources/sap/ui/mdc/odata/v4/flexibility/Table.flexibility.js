/*
 * ! SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(['sap/ui/core/XMLTemplateProcessor','sap/ui/core/util/XMLPreprocessor','sap/ui/core/Fragment','sap/ui/model/json/JSONModel'],function(X,a,F,J){'use strict';var N='http://schemas.sap.com/sapui5/extension/sap.ui.core.CustomData/1',b='sap.ui.mdc',C={NAME:'CreationRow',FRAGMENTNAME:'sap.ui.mdc.odata.v4.table.CreationRow'},T='ResponsiveTableType',c='GridTableType';var t=function(o,d,p){var i=d.getId&&d.getId()||d.getAttribute('id'),e=new J({id:i.substr(i.indexOf(p.viewId)+p.viewId.length+2),showCreate:p.visible,onCreate:p.onCreate,createAtEnd:p.createAtEnd});return Promise.resolve(a.process(o,{},{bindingContexts:{'this':e.createBindingContext('/')},models:{'this':e}})).then(function(o){var g=o.getElementsByTagNameNS('sap.ui.mdc','CreationRow')[0];g.setAttribute('visible',p.visible);return d.getId&&F.load({definition:o})||g;});};var f=function(s,o,p){var d=X.loadTemplate(s,'fragment');return t(d,o,p);};return{'changeCreationMode':{'changeHandler':{applyChange:function(o,d,p){var m=o.getContent(),M=p.modifier,s=o.getSelector(),e=M.bySelector(s,p.appComponent,p.view),v=p.viewId||p.view.getId(),g,h,S,O,i;if(M.targets==='xmlTree'){g=e.getAttributeNS(N,'creationMode');h=e.getAttributeNS(N,'createAtEnd');S=e.getAttributeNS(N,'showCreate');O=e.getAttributeNS(N,'onCreate');}else{g=e.data('creationMode');h=e.data('createAtEnd');S=e.data('showCreate');O=e.data('onCreate');}if(g!==m.creationMode){o.setRevertData({creationMode:g,createAtEnd:h});if(M.targets==='xmlTree'){e.setAttributeNS(N,'creationMode',m.creationMode);e.setAttributeNS(N,'createAtEnd',m.createAtEnd);}else{e.data('creationMode',m.creationMode);e.data('createAtEnd',m.createAtEnd);}if(m.creationMode===C.NAME){f(C.FRAGMENTNAME,e,{visible:S,onCreate:O,createAtEnd:m.createAtEnd,metaModel:p.appComponent.getModel().getMetaModel(),modifier:M,viewId:v}).then(function(j){i=M.getAggregation(e,'actions').filter(function(k){return M.getId(k)&&M.getId(k).indexOf("::Create")>-1;})[0];M.setVisible(i,false);M.insertAggregation(e,'creationRow',j,0,p.view);});}else if(g===C.NAME){i=M.getAggregation(e,'actions').filter(function(j){return M.getId(j)&&M.getId(j).indexOf("::Create")>-1;})[0];M.setPropertyBinding(i,'visible',S);M.getAggregation(e,'creationRow').destroy();}}},revertChange:function(o,d,p){var m=p.modifier,e=o.getRevertData(),s=o.getSelector(),g=m.bySelector(s,p.appComponent,p.view),v=p.viewId||p.view.getId(),S,O,h;if(m.targets==='xmlTree'){g.setAttributeNS(N,'creationMode',e.creationMode);g.setAttributeNS(N,'createAtEnd',e.createAtEnd);S=g.getAttributeNS(N,'showCreate');O=g.getAttributeNS(N,'onCreate');}else{g.data('creationMode',e.creationMode);S=g.data('showCreate');O=g.data('onCreate');}if(e.creationMode==='CreationRow'){h=m.getAggregation(g,'actions').filter(function(i){return m.getId(i)&&m.getId(i).indexOf("::Create")>-1;})[0];m.setVisible(h,false);f(C.FRAGMENTNAME,g,{visible:S,onCreate:O,createAtEnd:e.createAtEnd,metaModel:p.appComponent.getModel().getMetaModel(),modifier:m,viewId:v}).then(function(i){m.insertAggregation(g,'creationRow',i,0,p.view);});}},completeChangeContent:function(o,m,p){}},'layers':{'CUSTOMER_BASE':false,'CUSTOMER':false}},'changeTableType':{'changeHandler':{applyChange:function(o,d,p){var m=o.getContent();var M=p.modifier;var s=o.getSelector();var S=M.bySelector(s,p.appComponent,p.view);if(M.targets==='xmlTree'){if(m.previousTableType!==m.tableType){o.setRevertData({tableType:m.previousTableType});var e=S.getElementsByTagNameNS(b,'type')[0];var g=e.getElementsByTagNameNS(b,m.tableType===T?c:T)[0];e.removeChild(g);var n=document.createElementNS(b,m.tableType);if(m.tableType===c){n.setAttribute('rowCountMode','Fixed');n.setAttribute('rowCount',10);}e.appendChild(n);}}},revertChange:function(o,d,p){var m=p.modifier;var r=o.getRevertData();var s=o.getSelector();var S=m.bySelector(s,p.appComponent,p.view);if(m.targets==='xmlTree'){var e=S.getElementsByTagNameNS(b,'type')[0];var P=e.getElementsByTagNameNS(b,r.tableType===T?c:T)[0];e.removeChild(P);var g=document.createElementNS(b,r.tableType);if(r.tableType===c){g.setAttribute('rowCountMode','Fixed');g.setAttribute('rowCount',10);}e.appendChild(g);}},completeChangeContent:function(o,m,p){}},'layers':{'CUSTOMER_BASE':false,'CUSTOMER':false}}};});
