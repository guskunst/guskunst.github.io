/*
 * ! SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/mdc/odata/v4/CommonHelper","sap/ui/mdc/base/FieldBase","sap/ui/mdc/ResourceModel","sap/ui/model/odata/v4/AnnotationHelper","sap/ui/base/ManagedObject","sap/base/Log"],function(C,F,R,A,M,L){"use strict";var I="@Org.OData.Measures.V1.ISOCurrency",U="@Org.OData.Measures.V1.Unit",a={},b=', ';a[I]={ui5Type:"sap.ui.model.type.Currency",formatOptions:'parseAsString : true'};function _(i){var m=i.getModel(),f=i.getSetting("sap.ui.mdc.odata.v4.Field"),s=f.sideEffects;if(s){return Promise.resolve(s);}s={};return m.requestObject('/$').then(function(e){var d=function(k){return e[k]['$kind']==='EntityType';},g=function(E,S,o){var q=S.indexOf('#')>-1&&S.substr(S.indexOf('#'))||'',j=o.SourceProperties||[],k=o.SourceEntities||[],p=[];j.forEach(function(l){var P=l['$PropertyPath'],n=P.indexOf('/')>0?'/'+E+'/'+P.substr(0,P.lastIndexOf('/')+1)+'@sapui.name':false,r=!n?Promise.resolve(E):m.requestObject(n);P=n?P.substr(P.lastIndexOf('/')+1):P;p.push(r.then(function(O){s[O]=s[O]||[[],{}];s[O][1][P]=s[O][1][P]||[];s[O][1][P].push(E+q+(j.length===1&&'$$ImmediateRequest'||''));}));});k.forEach(function(l){var n=l['$NavigationPropertyPath'],r;if(n===''){r=Promise.resolve(E);}else{r=m.requestObject('/'+E+'/'+n+'/@sapui.name');}p.push(r.then(function(O){s[O]=s[O]||[[],{}];s[O][0].push(E+q+'$$ImmediateRequest');}));});return Promise.all(p);},h=function(E){return m.requestObject('/'+E+'@').then(function(o){var S=Object.keys(o).filter(function(j){return j.indexOf('@com.sap.vocabularies.Common.v1.SideEffects')>-1;}).map(function(j){return g(E,j,o[j]);});return Promise.all(S);});};return Promise.all(Object.keys(e).filter(d).map(h)).then(function(){f.sideEffects=s;return s;});});}var c={displayMode:function(o,i){var t=o['@com.sap.vocabularies.Common.v1.Text@com.sap.vocabularies.UI.v1.TextArrangement'];if(!o['@com.sap.vocabularies.Common.v1.Text']){return'Value';}else if(t){if(t.$EnumMember==='com.sap.vocabularies.UI.v1.TextArrangementType/TextOnly'){return'Description';}else if(t.$EnumMember==='com.sap.vocabularies.UI.v1.TextArrangementType/TextFirst'){return'DescriptionValue';}}return'ValueDescription';},isRequiredInFilter:function(p,d){var e,P,i=false,f,m=d.context.getModel(),s=d.context.getPath();e=C._getEntitySetPath(m,s);if(typeof p==="string"){P=p;}else{P=m.getObject(s+"@sapui.name");}f=m.getObject(e+"@Org.OData.Capabilities.V1.FilterRestrictions");if(f&&f.RequiredProperties){i=f.RequiredProperties.some(function(g){return g.$PropertyPath===P;});}return i;},buildExpressionForCriticalityIcon:function(s){if(s){var e="{= (${"+s+"} === 'com.sap.vocabularies.UI.v1.CriticalityType/Negative') || (${"+s+"} === '1') || (${"+s+"} === 1) ? 'sap-icon://status-negative' : "+"(${"+s+"} === 'com.sap.vocabularies.UI.v1.CriticalityType/Critical') || (${"+s+"} === '2') || (${"+s+"} === 2) ? 'sap-icon://status-critical' : "+"(${"+s+"} === 'com.sap.vocabularies.UI.v1.CriticalityType/Positive') || (${"+s+"} === '3') || (${"+s+"} === 3) ? 'sap-icon://status-positive' : "+"'sap-icon://status-inactive' }";return e;}return undefined;},buildExpressionForCriticalityColor:function(s){if(s){var e="{= (${"+s+"} === 'com.sap.vocabularies.UI.v1.CriticalityType/Negative') || (${"+s+"} === '1') || (${"+s+"} === 1) ? 'Error' : "+"(${"+s+"} === 'com.sap.vocabularies.UI.v1.CriticalityType/Critical') || (${"+s+"} === '2') || (${"+s+"} === 2) ? 'Warning' : "+"(${"+s+"} === 'com.sap.vocabularies.UI.v1.CriticalityType/Positive') || (${"+s+"} === '3') || (${"+s+"} === 3) ? 'Success' : "+"'None' }";return e;}return undefined;},buildExpressionForTextValue:function(p,d){var m=d.context.getModel(),P=d.context.getPath(),t=m.getObject(P+"@com.sap.vocabularies.Common.v1.Text"),T=t?A.value(t,d):undefined,e="";p=A.getNavigationPath(p);if(p.indexOf('/')>-1&&T){e="{"+p.substr(0,p.indexOf('/')+1)+T.substr(1,T.length-2)+"}";}else{e=T;}if(e){e="{ path : '"+e.substr(1,e.length-2)+"', mode : 'OneWay'}";}return e;},getStableIdPartFromDataField:function(d,p){var P="",s="";if(d.$Type&&d.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAction"){return C.replaceSpecialCharsInId(d.Action);}else if(d.$Type&&(d.$Type==="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation")){if(typeof d.SemanticObject=="string"){s=C.replaceSpecialCharsInId(d.SemanticObject);}else if(d.SemanticObject.$Path){s=C.replaceSpecialCharsInId(d.SemanticObject.$Path);}if(typeof d.Action=="string"){s=s+"::"+C.replaceSpecialCharsInId(d.Action);}else if(d.Action&&d.Action.$Path){s=s+"::"+C.replaceSpecialCharsInId(d.Action.$Path);}return s;}else if(d.$Type&&d.$Type==="com.sap.vocabularies.UI.v1.DataFieldForAnnotation"){return C.replaceSpecialCharsInId(d.Target.$AnnotationPath);}else if(d.Value&&d.Value.$Path){return C.replaceSpecialCharsInId(d.Value.$Path);}else if(d.Value&&d.Value.$Apply&&d.Value.$Function==="odata.concat"){for(var i=0;i<d.Value.$Apply.length;i++){if(d.Value.$Apply[i].$Path){if(P){P=P+"::";}P=P+C.replaceSpecialCharsInId(d.Value.$Apply[i].$Path);}}return P;}else if(p&&p.context&&p.context.getObject("@sapui.name")){return C.replaceSpecialCharsInId(p.context.getObject("@sapui.name"));}else{L.error("Annotation Helper: Unable to create a stable ID. Please check the annotations.");}return undefined;},isNotAlwaysHidden:function(d,D){var o=D.context,i=false;if(d.Value&&d.Value.$Path){i=o.getObject("Value/$Path@com.sap.vocabularies.UI.v1.Hidden");}if(!i||i.$Path){i=o.getObject("@com.sap.vocabularies.UI.v1.Hidden");if(!i||i.$Path){i=false;}}return!i;},isSemanticKey:function(s,v){return v&&s&&!(s.every(function(k){return k['$PropertyPath']!==v['$Path'];}))||false;},getEditMode:function(o,d,f,D,e,p){if(e==='Display'||e==='ReadOnly'||e==='Disabled'){return e;}var g,i,r,s,E,h,j,k;if(d==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){return'Display';}if(o["@Org.OData.Core.V1.Computed"]){g=o["@Org.OData.Core.V1.Computed"].Bool?o["@Org.OData.Core.V1.Computed"].Bool=="true":true;}if(o["@Org.OData.Core.V1.Immutable"]){i=o["@Org.OData.Core.V1.Immutable"].Bool?o["@Org.OData.Core.V1.Immutable"].Bool=="true":true;}r=g||i;j=typeof g==="undefined"?typeof i==="undefined"||i:!g;if(f){if(M.bindingParser(f)){k="$"+f+" === '1'";}else{r=(r||f=="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly");}}var l;var m;if(p==='Form'){m=e==='Editable'?'\'ReadOnly\'':'$'+e+' === \'Editable\' ? \'ReadOnly\' : \'Display\'';}else{m='\'Display\'';}h=M.bindingParser(e)?"$"+e:"'"+e+"'";if(r){if(!j||!D){if(e.indexOf('{')===0&&p==='Form'){return'{= '+m+'}';}m=m.split("'")&&m.split("'")[1];return m;}else{if(k){return"{= !%{IsActiveEntity} && !%{HasActiveEntity} ? ("+k+"? : 'ReadOnly' : "+h+") : "+m+"}";}else if(f=="com.sap.vocabularies.Common.v1.FieldControlType/ReadOnly"){h="'ReadOnly'";}return"{= !%{IsActiveEntity} && !%{HasActiveEntity} ?"+h+" : "+m+"}";}}if(k){s=k+" ? "+m+" :"+h;l="{= "+s+"}";}else{s=h;l=e;}E=j||!D?l:"{= !%{IsActiveEntity} && !%{HasActiveEntity} ? "+m+" : "+s+"}";return E;},isLineItem:function(p,i){if(i.context.getPath().indexOf("@com.sap.vocabularies.UI.v1.LineItem")>-1){return true;}return false;},getRequiredForDataField:function(f,e){if(e==='Display'||e==='ReadOnly'||e==='Disabled'){return false;}if(f&&e){if(e.indexOf("{")>-1){var E="%"+e+" === 'Editable'";}if(f.indexOf("{")>-1){var s="%"+f+" === 7";return(e==='Editable')?"{="+s+"}":"{= "+s+" && "+E+"}";}else{return(e==='Editable')?(f=="com.sap.vocabularies.Common.v1.FieldControlType/Mandatory"):(f=="com.sap.vocabularies.Common.v1.FieldControlType/Mandatory"&&"{= "+E+"}");}}return false;},isRequired:function(f,e){if(e==='Display'||e==='ReadOnly'||e==='Disabled'){return false;}if(f){if(M.bindingParser(f)){var E="{= %"+f+" === 7}";return E;}else{return(f=="com.sap.vocabularies.Common.v1.FieldControlType/Mandatory");}}return false;},_createBindingForDraftAdminBlock:function(m,e,f){var p="/"+e+"/DraftAdministrativeData/";return m.requestObject(p).then(function(d){var B="{parts: [{path: 'HasDraftEntity', targetType: 'any'}, "+"{path: 'DraftAdministrativeData/InProcessByUser'}, "+"{path: 'DraftAdministrativeData/LastChangedByUser'} ";if(d.InProcessByUserDescription){B+=" ,{path: 'DraftAdministrativeData/InProcessByUserDescription'}";}if(d.LastChangedByUserDescription){B+=", {path: 'DraftAdministrativeData/LastChangedByUserDescription'}";}B+="], formatter: 'sap.ui.mdc.odata.v4.field.FieldRuntime."+f+"'}";return B;});},getBindingForDraftAdminBlockInline:function(i,e){return c._createBindingForDraftAdminBlock(i.getModel(),e,'formatDraftOwnerTextInline');},getBindingForDraftAdminBlockInPopover:function(i,e){return c._createBindingForDraftAdminBlock(i.getModel(),e,'formatDraftOwnerTextInPopover');},propertyName:function(p,i){return typeof p==='string'?p:i.context.getObject("@sapui.name");},typeConstraints:function(p,P){var s="",m,t=p.$Type;s+=(p.$Nullable!==undefined&&!p.$Nullable?'nullable: '+p.$Nullable:'');if(["Edm.Decimal","Edm.DateTimeOffset"].indexOf(t)>-1){s+=(s?b:'');s+=(p.$Precision?'precision: '+p.$Precision:'');s+=(p.$Scale?(s?b:'')+'scale: '+(p.$Scale==="variable"?"'"+p.$Scale+"'":p.$Scale):'');}else if(t==="Edm.String"){m=p.$MaxLength;if(m){s+=(s?b:'');s+="maxLength: "+m;}if(P["@com.sap.vocabularies.Common.v1.IsUpperCase"]){}}return s;},value:function(p,i){var o=i.context,r=o.getObject("./$"),m=typeof p==='string'?p:(p.$Name||o.getObject("./$@sapui.name")),P=o.getObject("@");return Promise.resolve().then(function(v){var s='',d='',f='',e,g,u;if(m&&P){g=P.hasOwnProperty(I)&&I;if(g){e=P[g];u=a[g];s='{'+'parts: ['+'\''+m+'\',\''+e.$Path+'\''+'], type: \''+u.ui5Type+'\'';f+=u.formatOptions;}else{s='{path: \''+m+'\'';s+=',type: \''+F.mapEdmTypes[r.$Type]+'\'';}d+=(d?b:'')+c.typeConstraints(r,P);s+=d?',constraints: {'+d+'}':'';f+=['Edm.Date','Edm.DateTimeOffset'].indexOf(r.$Type)>-1?(f?b:'')+'style : \'medium\'':'';s+=f?',formatOptions : {'+f+'}':'';s+='}';}else{s=A.value(p,{context:o});}return s;});},_format:function(p,i){var o=i.context,d=p.$kind==="Property"?{$PropertyPath:o.getObject("./$@sapui.name")}:p;return A.format(d,{context:o});},constraints:function(p,i){return c.value(p,i).then(function(v){var m=v.match(/constraints:.*?({.*?})/);return m&&m[1]||undefined;});},formatOptions:function(p,i){return c.value(p,i).then(function(v){var m=v.match(/formatOptions:.*?({.*?})/);return m&&m[1]||undefined;});},getFieldGroupIds:function(o,p,e){var i=o.getInterface(0);return _(i).then(function(s){var m=i.getModel(),P=p,n=P.indexOf('/')>0?'/'+e+'/'+P.substr(0,P.lastIndexOf('/')+1)+'@sapui.name':false,d=!n?Promise.resolve(e):m.requestObject(n),f,g;P=n?P.substr(P.lastIndexOf('/')+1):P;return d.then(function(O){f=(s[O]&&s[O][0].concat(s[O][1][P]||[]))||[];if(f.length){g=f.reduce(function(r,h){return(r&&r+','+h)||h;});}return g;});});},fieldControl:function(p,i){var m=i&&i.context.getModel();var P=i&&i.context.getPath();var f=m&&m.getObject(P+"@com.sap.vocabularies.Common.v1.FieldControl");if(f){if(f.hasOwnProperty("$EnumMember")){return f.$EnumMember;}else if(f.hasOwnProperty("$Path")){return A.value(f,{context:i.context});}}else{return undefined;}},getNavigationEntity:function(p,o){var d=o&&o.context||p,P=A.getNavigationPath(d.getPath())+'/',e=d.getObject(P),f=Object.keys(e),l=f.length,i=0;for(;i<l;i++){if(e[f[i]].$kind==='NavigationProperty'&&e[f[i]].$ReferentialConstraint&&e[f[i]].$ReferentialConstraint.hasOwnProperty(d.getObject().$Path)){return o?A.getNavigationBinding(f[i]):P+f[i];}}},valueHelpProperty:function(p){var s=p.getPath(),P=(s.indexOf("com.sap.vocabularies.UI.v1.SelectionFields")===-1)?(s+'/$Path'):s,d=P+"@",o=p.getObject(d),e;if(o){e=o.hasOwnProperty(I)&&I||o.hasOwnProperty(U)&&U;if(e){P=P+e+'/$Path';}}return P;}};c.buildExpressionForTextValue.requiresIContext=true;c.getEditMode.requiresIContext=true;c.getRequiredForDataField.requiresIContext=true;c.getBindingForDraftAdminBlockInline.requiresIContext=true;c.getBindingForDraftAdminBlockInPopover.requiresIContext=true;c.value.requiresIContext=true;c.getFieldGroupIds.requiresIContext=true;c.fieldControl.requiresIContext=true;return c;},true);
