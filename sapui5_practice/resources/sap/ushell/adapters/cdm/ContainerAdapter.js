// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/utils","sap/ushell/User","sap/ushell/System","sap/ui/thirdparty/URI","sap/base/Log"],function(u,U,S,a,L){"use strict";var l=L.getLogger("sap/ushell/adapters/cdm/ContainerAdapter",L.Level.INFO);var C=function(i,p,P){var b="/sap/public/bc/icf/logoff",s=g(P.config,b),o=e(P.config),c=f(i,P.config),d=k(P.config);function g(m,D){if(m.systemProperties&&m.systemProperties.logoutUrl){return m.systemProperties.logoutUrl;}return D;}function e(m){var n,q=m.userProfile;if(q){n=h(q.defaults,m.userProfilePersonalization,q.metadata);}return new U(n||j());}function f(O,m){var n=m.systemProperties,A=O.getAlias(),q=O.getPlatform(),B=O.getBaseUrl(),r,t;if(n){A=n.alias||A;q=n.platform||q;r=n.SID;t=n.client;}return new S({alias:A,platform:q,baseUrl:B,system:r,client:t});}function h(D,m,n){var q=jQuery.extend(j(),D,m);q.bootTheme=q.bootTheme||{theme:q.theme,root:""};delete q.theme;if(n){if(n.editablePropterties){q.setThemePermitted=n.editablePropterties.indexOf("theme")>-1;q.setAccessibilityPermitted=n.editablePropterties.indexOf("accessibility")>-1;q.setContentDensityPermitted=n.editablePropterties.indexOf("contentDensity")>-1;}if(n.ranges){q.ranges=n.ranges;}}return q;}function j(){return{setThemePermitted:false,setAccessibilityPermitted:false,setContentDensityPermitted:false};}function k(A){var m=A&&A.systemProperties&&A.systemProperties.sessionKeepAlive;if(!m){return null;}if(!m.url){l.error("Mandatory parameter 'url' missing in 'sessionKeepAlive' configuration.");return null;}if(m.method!=="HEAD"&&m.method!=="GET"){m.method="HEAD";}return m;}this._getLogoutUrl=function(){return s;};this._setDocumentLocation=function(m){document.location=m;};this.getSystem=function(){return c;};this.getUser=function(){return o;};this.load=function(){return jQuery.when();};this.getCurrentUrl=function(){return window.location.href;};this.logout=function(m){var F;if(!m){throw new Error("Not implemented");}if(u.hasNativeLogoutCapability()){F=(new a(this._getLogoutUrl())).absoluteTo(this.getCurrentUrl()).search("").toString();u.getPrivateEpcm().doLogOff(F);}else{this.logoutRedirect();}return jQuery.when();};this.logoutRedirect=function(){var m=c.adjustUrl(this._getLogoutUrl());this._setDocumentLocation(m);};this.sessionKeepAlive=function(){if(!d){return;}var x=new XMLHttpRequest();x.open(d.method,d.url,true);x.onreadystatechange=function(){if(this.readyState===4){l.debug("Server session was extended");}};x.send();};this._getSessionKeepAliveConfig=function(){return d;};};return C;},true);
