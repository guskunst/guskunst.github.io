// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(['jquery.sap.global','sap/ui/core/Control','sap/ui/core/theming/Parameters','sap/ui/Device','sap/ui/dom/units/Rem','sap/ui/core/IconPool','sap/ushell/ui/shell/ShellTitle','sap/ushell/Config','sap/ushell/ui/shell/ShellAppTitle','./ShellHeaderRenderer'],function(q,C,T,D,R,I,S,a){"use strict";var s="sapUshellShellShowSearchOverlay";var _=0;var b=C.extend("sap.ushell.ui.fiori3.ShellHeader",{metadata:{properties:{logo:{type:"sap.ui.core.URI",defaultValue:""},showLogo:{type:"boolean",defaultValue:true},homeUri:{type:"sap.ui.core.URI",defaultValue:"#"},searchState:{type:"string",defaultValue:"COL"},ariaLabel:{type:"string",defaultValue:undefined},centralAreaElement:{type:"string",defaultValue:null}},aggregations:{headItems:{type:"sap.ushell.ui.shell.ShellHeadItem",multiple:true},headEndItems:{type:"sap.ushell.ui.shell.ShellHeadItem",multiple:true},search:{type:"sap.ui.core.Control",multiple:false},title:{type:"sap.ushell.ui.shell.ShellTitle",multiple:false},appTitle:{type:"sap.ushell.ui.shell.ShellAppTitle",multiple:false}},associations:{shellLayout:{type:"sap.ui.base.ManagedObject",multiple:false}},events:{searchSizeChanged:{}}}});b.prototype.setVisible=function(v){v=v===undefined?true:!!v;q(".sapUshellShellHead, .sapUshellShellHead > .sapUshellShellCntnt").css("display",v?"":"none");C.prototype.setVisible.call(this,v);};b.prototype.getShellLayoutControl=function(){return sap.ui.getCore().byId(this.getShellLayout());};b.prototype.createUIArea=function(i){var h=document.getElementById('shell-hdrcntnt');var c=i||'canvas';var d=document.getElementById(c);if(d&&!h){d.insertAdjacentHTML('beforebegin','<header id="shell-hdr" class="sapContrastPlus sapUshellShellHead">'+'</header>');if(!this.getVisible()){this.setVisible(false);}this.placeAt('shell-hdr');}};b.prototype.SearchState={COL:"COL",EXP:"EXP",EXP_S:"EXP_S"};b.prototype.init=function(){D.media.attachHandler(this._refreshLayout,this,D.media.RANGESETS.SAP_STANDARD);D.resize.attachHandler(this._refreshLayout,this);this.data("sap-ui-fastnavgroup","true",true);};b.prototype.exit=function(){D.media.detachHandler(this._refreshLayout,this,D.media.RANGESETS.SAP_STANDARD);D.resize.detachHandler(this._refreshLayout,this);var c=document.getElementById('shell-hdr');if(c){c.parentElement.removeChild(c);}};b.prototype.setAccessKeyHandler=function(A){this._accessKeyHandler=A;};b.prototype._handleFocus=function(){if(this._accessKeyHandler){if(this._accessKeyHandler.fromOutside||this._accessKeyHandler.bForwardNavigation){if(this._accessKeyHandler.bForwardNavigation){var h=this.getHeadItems();if(h.length>0){h[0].focus();}else{this.getAppTitle().focus();}}else{var H=this.getHeadEndItems();if(H.length>0){H[H.length-1].focus();}else{this.getAppTitle().focus();}}this._accessKeyHandler.fromOutside=false;}else{this._accessKeyHandler.bFocusOnShell=false;this._accessKeyHandler.fromOutside=true;}}};b.prototype.onsapspace=function(e){var t=e.target;if(t&&t.id===this.getId()+"-logo"){window.location.href=t.href;}};b.prototype.onAfterRendering=function(){this.$("icon").one('load',this._refreshLayout.bind(this));this._refreshLayout();if(a.last("/core/extension/enableHelp")){var B=["actionsBtn","configBtn","homeBtn"];for(var i=0;i<B.length;i++){var o=window.document.getElementById(B[i]);if(o){o.classList.add("help-id-"+B[i]);}}}var A=window.document.getElementById("sapUshellHeaderAccessibilityHelper");if(A){A.addEventListener("focus",this._handleFocus.bind(this));}};b.prototype.onThemeChanged=function(){this.invalidate();};b.prototype._getLogo=function(){return this.getLogo()||T._getThemeImage(null,true);};b.prototype._refreshLayout=function(){if(!this.getDomRef()){return;}this._setAppTitleFontSize();if(this.getSearchVisible()){var $=this.$("hdr-search");$[0].style.display="none";this._hideElementsForSearch();$[0].style.display="";$.css("max-width",_+"rem");this.fireSearchSizeChanged({remSize:R.fromPx($.width()),isFullWidth:this.isPhoneState()});}};b.prototype._setMaxWidthForTitle=q.noop;b.prototype._setAppTitleFontSize=function(){if(this.isLSize()){return;}var A=document.getElementById("shellAppTitle");var c='sapUshellHeadTitleWithSmallerFontSize';if(A&&A.style.display!="none"){A.classList.remove(c);if(A.scrollWidth>A.clientWidth){A.classList.add(c);}}};b.prototype.setAppTitle=function(A){A.attachTextChanged(this._refreshLayout,this);this.setAggregation("appTitle",A,true);};b.prototype.removeAppTitle=function(A){A.detachedTextChanged(this._refreshLayout);this.removeAggregation("appTitle");};b.prototype.setTitleControl=function(t){var o=this.getTitle();if(!o){o=new S({text:t});this.setTitle(o);}else{o.setText(t);}};b.prototype.removeHeadItem=function(i){if(typeof i==='number'){i=this.getHeadItems()[i];}this.removeAggregation('headItems',i);};b.prototype.addHeadItem=function(i){this.addAggregation('headItems',i);};b.prototype.isPhoneState=function(){var d=D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD).name;var e=this.$().width()>_;return(D.system.phone||d==="Phone"||!e);};b.prototype.isLSize=function(){return D.media.getCurrentRange(D.media.RANGESETS.SAP_STANDARD).name==="Desktop";};b.prototype.setSearchState=function(c,m,w){if(this.SearchState[c]&&this.getSearchState()!==c){if(typeof m==="boolean"){w=m;m=undefined;}this.setProperty('searchState',c,false);var d=(c!=="COL");var e=this.getShellLayoutControl();if(e){e.toggleStyleClass(s,d&&w);}_=d?m||35:0;}};b.prototype._hideElementsForSearch=function(){var n,$=q(".sapUshellShellHeadSearchContainer"),B=this.$("hdr-begin");if(this.getSearchState()==="EXP"||this.isPhoneState()){n=R.toPx(_+3);}else{n=R.toPx(9+0.5);}var e=[this.$("hdr-center")[0]];B.children().each(function(d,f){e.splice(1,0,f);});e.push(B[0]);e.push(this.$("hdr-end")[0]);for(var i=0;i<e.length-1;i++){var c=e[i];if(c){if(n>$.width()){c.style.display="none";B[0].style.flexBasis="auto";continue;}return;}}if(R.toPx(_)>$.width()){this.$("hdr-end")[0].style.display="none";}};b.prototype.getSearchWidth=function(){return _;};b.prototype.isHomepage=function(){if(!window.hasher){return false;}return"#"+window.hasher.getHash()===this.getHomeUri();};b.prototype.getSearchVisible=function(){return this.getSearchState()!==this.SearchState.COL;};b.prototype.getCentralControl=function(){if(this.getCentralAreaElement()){return sap.ui.getCore().byId(this.getCentralAreaElement());}return null;};return b;},true);
