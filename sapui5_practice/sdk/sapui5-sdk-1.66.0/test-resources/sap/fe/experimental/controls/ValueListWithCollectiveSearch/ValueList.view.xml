<core:View xmlns:template="http://schemas.sap.com/sapui5/extension/sap.ui.core.template/1"
		   xmlns="sap.m"
		   xmlns:core="sap.ui.core"
		   xmlns:l="sap.ui.layout"
		   template:require="sap.fe.controls._ValueList.ValueListAnnotationHelper sap.ui.model.odata.v4.AnnotationHelper"
		   controllerName="sap.fe.controls._ValueList.ValueList">

	<template:alias name=".MODEL" value="sap.ui.model.odata.v4.AnnotationHelper">

		<Text text="PLEASE NOTE: This value help dialog is still under constuction"></Text>

		<Select forceSelection="true"
				autoAdjustWidth="true"
				visible="{ui>/collectiveSearch}"
				change="handleCollectiveSearchChange">
			<template:repeat list="{valueListInfo>}" var="valueList">
				<core:Item key="{valueList>name}" text="{valueList>name}"/>
			</template:repeat>
		</Select>
		<Label text="Test Only: Collective Search" visible="{ui>/collectiveSearch}"></Label>

		<template:repeat list="{valueListInfo>}" var="valueList">
			<template:with path="valueList>"
						   helper="sap.fe.controls._ValueList.ValueListAnnotationHelper.getCollectionEntitySet"
						   var="entitySet">

				<l:AlignedFlowLayout visible="{= '{ui>/visible/' + ${valueList>name} + '}' }">

					<l:content>
						<l:VerticalLayout width="100%">
							<Label text="Search"></Label>
							<SearchField value="{filter>/$search}" search="handleSearch" liveChange="handleSearchChange"></SearchField>
						</l:VerticalLayout>

						<template:repeat list="{entitySet>$Type}" var="filterItem">
							<!-- TODO: check if filterable and not hidden -->
							<core:Fragment fragmentName="sap.fe.controls._FilterBar.FilterItem" type="XML"/>
						</template:repeat>
					</l:content>
				</l:AlignedFlowLayout>

				<Table items="{= '{ path : \'/' + ${valueList>CollectionPath} + '\', parameters : { $$groupId : \'' + ${valueList>name} +  '\'} }' }"
					   growing="false"
					   selectionChange="handleSelectionChange"
					   visible="{= '{ui>/visible/' + ${valueList>name} + '}' }"
				>

					<columns>
						<template:repeat list="{valueList>Parameters}" var="parameter">
							<Column>
								<template:with path="parameter>ValueListProperty" var="parameter"
											   helper="sap.fe.controls._ValueList.ValueListAnnotationHelper.getValueListProperty">
									<template:if test="{parameter>Label}">
										<!-- TODO: to be checked which label checks needed, copied from table -->
										<template:then>
											<Label text="{parameter>Label@@.MODEL.value}"/>
										</template:then>

										<template:elseif
												test="{parameter>@com.sap.vocabularies.Common.v1.Label}">
											<Label text="{parameter>@com.sap.vocabularies.Common.v1.Label@@.MODEL.value}"/>
										</template:elseif>

										<template:else>
											<!-- no label found, property path as fallback, to highlight it put it into [] -->
											<Label text="[{parameter>@sapui.name@@.MODEL.value}]"/>
										</template:else>
									</template:if>
								</template:with>
							</Column>

						</template:repeat>
					</columns>
					<items>
						<ColumnListItem>
							<cells>
								<template:repeat list="{valueList>Parameters}" var="parameter">
									<template:with path="parameter>ValueListProperty" var="dataField"
												   helper="sap.fe.controls._ValueList.ValueListAnnotationHelper.getValueListProperty">
										<core:Fragment fragmentName="sap.fe.controls._Field.Fragments.FieldContent"
													   type="XML"/>
									</template:with>
								</template:repeat>
							</cells>
						</ColumnListItem>
					</items>
				</Table>
			</template:with>
		</template:repeat>
	</template:alias>

</core:View>
