/*!
 * SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/thirdparty/jquery",'sap/ui/core/XMLTemplateProcessor',"sap/ui/model/json/JSONModel",'sap/ui/core/util/XMLPreprocessor','sap/ui/core/Fragment',"sap/m/MessageToast","sap/ui/mdc/base/InParameter","sap/ui/mdc/base/OutParameter"],function(q,X,J,a,F,M,I,O){"use strict";var w={};var V={getValueListCollectionEntitySet:function(v){var m=v.getObject();return m.$model.getMetaModel().createBindingContext("/"+m.CollectionPath);},getValueListProperty:function(p){var v=p.getModel();var m=v.getObject("/");return m.$model.getMetaModel().createBindingContext('/'+m.CollectionPath+'/'+p.getObject());},showValueListInfo:function(p,f,s,c){var m=f.getModel(),o=m.getMetaModel(),b=f.getMetadata().getName(),W=f.getContent&&f.getContent(),d=W.getId(),t=W&&W.getTable&&W.getTable(),e=f&&f.getFilterBar&&f.getFilterBar(),P=o.getObject(p+"@sapui.name"),E=t&&e,k,g="",D;if(w[d]||E){return;}else{if(!t){w[d]=true;}o.requestValueListInfo(p).then(function(v){var h=f.getInParameters().length+f.getOutParameters().length===0;v=v[v[""]?"":Object.keys(v)[0]];W.setModel(v.$model);v.Parameters.forEach(function(j){var l='/'+v.CollectionPath+'/'+j.ValueListProperty,n=v.$model.getMetaModel().getObject(l),r=v.$model.getMetaModel().getObject(l+'@');if(!k&&j.$Type.indexOf('Out')>48&&j.LocalDataProperty.$PropertyPath===P){k=j.ValueListProperty;D=r["@com.sap.vocabularies.Common.v1.Text"]&&r["@com.sap.vocabularies.Common.v1.Text"].$Path;}if(r["@com.sap.vocabularies.UI.v1.Hidden"]){return;}if(!g&&n.$Type==="Edm.String"&&!r["@com.sap.vocabularies.UI.v1.HiddenFilter"]){g=g.length>0?g+','+j.ValueListProperty:j.ValueListProperty;}if(h&&j.$Type!=="com.sap.vocabularies.Common.v1.ValueListParameterDisplayOnly"&&j.LocalDataProperty.$PropertyPath!==P){var u="";if(c&&c.length>0){u=c+">/conditions/";}u='{'+u+j.LocalDataProperty.$PropertyPath+'}';if(j.$Type.indexOf('Out')>48){f.addOutParameter(new O({value:u,helpPath:j.ValueListProperty}));}if(j.$Type.indexOf('In')>48){f.addInParameter(new I({value:u,helpPath:j.ValueListProperty}));}}});if(!t){if(b.indexOf("FieldValueHelp")>-1){f.setTitle(v.Label);f.setKeyPath(k);f.setDescriptionPath(D);f.setFilterFields("$search");}}function i(j){var l=X.loadTemplate(j,'fragment'),n=new J(v),r=v.$model.getMetaModel(),S=new J({id:f.getId()});return a.process(l,{},{bindingContexts:{valueList:n.createBindingContext("/"),entitySet:r.createBindingContext("/"+v.CollectionPath),source:S.createBindingContext("/")},models:{valueList:n,entitySet:r,source:S}}).then(function(l){var L={path:p,fragmentName:j,fragment:l};if(q.sap.log.getLevel()===q.sap.log.Level.DEBUG){V.ALLFRAGMENTS=V.ALLFRAGMENTS||[];V.ALLFRAGMENTS.push(L);}if(V.logFragment){setTimeout(function(){V.logFragment(L);},0);}return F.load({definition:l});});}t=t||i('sap.ui.mdc.odata.v4.ValueListTable');if(g.length){e=e||!s&&i('sap.ui.mdc.odata.v4.ValueListFilterBar');}else{e=Promise.resolve();}return Promise.all([t,e]).then(function(C){var t=C[0],e=C[1];if(t){q.sap.log.info('Value List XML content created ['+p+']',t.getMetadata().getName(),"MDC Templating");}if(e){q.sap.log.info('Value List XML content created ['+p+']',e.getMetadata().getName(),"MDC Templating");}if(t!==W.getTable()){W.setTable(t);delete w[d];}if(e&&e!==f.getFilterBar()){f.setFilterBar(e);}});}).catch(function(h){var i=h.status&&h.status===404?"Metadata not found ("+h.status+") for value help of property "+p:h.message;q.sap.log.error(i);M.show(i);});}}};return V;},true);
