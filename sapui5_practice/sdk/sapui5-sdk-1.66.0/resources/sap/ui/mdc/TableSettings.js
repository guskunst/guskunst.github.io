/*
 * ! SAPUI5

		(c) Copyright 2009-2019 SAP SE. All rights reserved
	
 */
sap.ui.define(["sap/ui/mdc/p13n/Util","sap/m/OverflowToolbarButton"],function(U,O){"use strict";var r;var T={createSortButton:function(i,e){if(!r){this._loadResourceBundle();}return this._createButton(i+"-sort",{icon:"sap-icon://sort",text:r.getText("table.SETTINGS_SORT","Sort"),press:e,tooltip:r.getText("table.SETTINGS_SORT","Sort")});},createColumnsButton:function(i,e){if(!r){this._loadResourceBundle();}return this._createButton(i+"-settings",{icon:"sap-icon://action-settings",text:r.getText("table.SETTINGS_COLUMN2","Add/Remove Columns"),press:e,tooltip:r.getText("table.SETTINGS_COLUMN2","Add/Remove Columns")});},_createButton:function(i,s){return new O(i,s);},_loadResourceBundle:function(){r=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");},showPanel:function(c,p,s,i){return new Promise(function(a,b){T["_getP13nStateOf"+p](c).then(function(P){U["showP13n"+p](s,P.baseData,P.runtimeData,c,a);});});},_getP13nStateOfSort:function(c){return new Promise(function(a){sap.ui.require([this.getMetadataDelegate()],function(M){if(!M||!M.fetchProperties||!M.createColumn){return a([]);}var p=M.fetchProperties(this);var g=function(k){var m=p.filter(function(P){return P.name===k;});return m.length?m[0].label:undefined;};a({baseData:{items:p.map(function(P){return{name:P.name,label:P.label||P.name,tooltip:P.label||P.name,sortOrder:undefined,selected:false};})},runtimeData:{items:M.getCurrentState(this).sorters.map(function(s){return{name:s.name,label:g(s.name)||s.name,tooltip:g(s.name)||s.name,sortOrder:s.sortOrder?"Descending":"Ascending",selected:true};})}});}.bind(this));}.bind(c));},_getP13nStateOfColumns:function(c){return new Promise(function(a){sap.ui.require([this.getMetadataDelegate()],function(M){var e=M.getCurrentState(this).visibleFields;e.forEach(function(P){P.visible=true;});var p=M.fetchProperties(c);p.forEach(function(P){P.label=P.label||P.name;P.visible=false;});a({baseData:{items:p},runtimeData:{items:e}});}.bind(this));}.bind(c));},createSort:function(c,p,R){sap.ui.require([c.getMetadataDelegate()],function(M){if(!M||!M.getCurrentState){return;}var C=[],d=false;M.getCurrentState(c).sorters.forEach(function(P){if(p===P.name){d=P.sortOrder==="Ascending";}if(R){C.push({selectorControl:c,changeSpecificData:{changeType:"removeSort",content:P}});}});C.push({selectorControl:c,changeSpecificData:{changeType:"addSort",content:{name:p,sortOrder:d?"Descending":"Ascending"}}});U.handleUserChanges(C);});},moveColumn:function(c,d,n){this._moveItem(c,d,n,"removeColumn","addColumn");},_moveItem:function(c,d,n,R,a){sap.ui.require([c.getMetadataDelegate()],function(M){if(!M||!M.getCurrentState){return;}var C=[];var v=M.getCurrentState(c).visibleFields||[];var m=v[d];m.index=d;m.preventRebind=true;C.push({selectorControl:c,changeSpecificData:{changeType:R,content:m}});var A=Object.assign({},m);A.index=n;C.push({selectorControl:c,changeSpecificData:{changeType:a,content:A}});U.handleUserChanges(C);});}};return T;},false);
