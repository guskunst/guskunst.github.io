/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","./thirdparty/three","sap/ui/vk/View"],function(q,t,V,B){"use strict";var A=function(){};A.prototype._getChildNodesWithMaterial=function(p,c){for(var a=0;p.children&&a<p.children.length;a++){var b=p.children[a];if(b&&b.material&&b.material.color){c.push(b);}this._getChildNodesWithMaterial(b,c);}};A.prototype._cloneKeyFrameTrack=function(a){var b=THREE.AnimationUtils.arraySlice(a.times,0);var v=THREE.AnimationUtils.arraySlice(a.values,0);var T=a.constructor;var c=new T(a.name,b,v);c.createInterpolant=a.createInterpolant;return c;};A.prototype._cloneAnimationClip=function(c){var a=[];for(var i=0;c.tracks&&i<c.tracks.length;i++){a.push(this._cloneKeyFrameTrack(c.tracks[i]));}return new THREE.AnimationClip(c.name,c.duration,a);};A.prototype.addAnimationTracksToHighlight=function(h){var d=h.duration;if(!h.cycles){h.cycles=0;}else{d/=2;}var n=false;var o;for(o=0;h.opacities&&o<h.opacities.length;o++){if(h.opacities[o]!==1){n=true;break;}}var a;var k,b,e;if(n){a={};a.keys=[];e=h.duration/h.opacities.length;for(b=0;b<h.cycles+1;b++){for(o=0;o<h.opacities.length;o++){k={};k.values=[h.opacity1];k.time=e*(b*h.opacities.length+o);a.keys.push(k);if(h.type==="STATIC"){break;}}if(h.type==="STATIC"){break;}}a.data={};a.data.type="OPACITY";a.data.highlight=h;h.duration=a.keys[a.keys.length-1].time;}var f=false;var g;for(g=0;h.colours&&g<h.colours.length;g++){var c=h.colours[g];if(c[0]!==0||c[1]!==0||c[2]!==0){f=true;break;}}var i;if(f){if(h.type==="INFINITE"&&h.colours.length===1){var j=[0,0,0,1];h.colours.push(j);}i={};i.keys=[];e=h.duration/h.colours.length;for(b=0;b<h.cycles+1;b++){for(g=0;g<h.colours.length;g++){k={};var l=h.colours[g];k.values=[l[0],l[1],l[2]];k.time=e*(b*h.opacities.length+g);i.keys.push(k);if(h.type==="STATIC"){break;}}if(h.type==="STATIC"){break;}}i.data={};i.data.type="COLOR";i.data.highlight=h;h.duration=i.keys[i.keys.length-1].time;}if(i){h.colorTrack=i;}if(a){h.opacityTrack=a;}};A.prototype.processHighlights=function(v,a,s){if(!v.highlights||!v.highlights.length){return;}var p=v.playbacks;if(!p&&v.getPlaybacks){p=v.getPlaybacks();}var b;var n=false;if(!p||!p.length){n=true;}var m=0;var h;var c;var d=false;for(h=0;h<v.highlights.length;h++){c=v.highlights[h];if(m<c.duration){m=c.duration;}if(c.type==="INFINITE"){if(p&&p.length>0){b=p[p.length-1];}if(!b||!b.isInfinite){n=true;}d=true;}}for(var e=0;p&&e<p.length;e++){b=p[e];var f=s.get(b.sequenceId);if(f){if(!f.userData){f.userData={};}f.userData.maxDuration=m;}}if(n){var g=s.get(a);if(!g){var i=[];g=new THREE.AnimationClip("Highlights",-1,i);if(!g.userData){g.userData={};}g.userData.startTime=0;g.userData.endTime=m;g.userData.frameRate=0;g.userData.active=true;g.userData.currentTime=0;g.userData.name="";g.userData.animations=[];g.userData.nodesEndData=new Map();g.userData.nodesStartData=new Map();g.userData.nodesStartDataByViewGroupId=new Map();s.set(a,g);if(!p){p=[];}b={sequenceId:a,playbackSpeed:0,playbackPreDelay:0,playbackPostDelay:0,playbackRepeat:0,playbackReversed:false,duration:m};if(d){b.isInfinite=true;}p.push(b);if(v.setPlaybacks){v.setPlaybacks(p);}else{v.playbacks=p;}}}for(h=0;h<v.highlights.length;h++){c=v.highlights[h];this.processHighlight(c,v,a,s);}};A.prototype.processHighlight=function(h,v,a,s){if(!h||(!h.opacityTrack&&!h.colorTrack)){return;}var p=v.playbacks;if(!p&&v.getPlaybacks){p=v.getPlaybacks();}var b=0;var e=1;if(p[0].isContinuity&&p.length>1){b=1;e=2;}if(h.type!=="FINITE"){e=p.length;}for(var c=b;c<e;c++){var d=p[c];var f=s.get(d.sequenceId);if(!f){continue;}if(d.sequenceId!==a){d.sequenceId=d.sequenceId+"-"+a+"-withHighlight";var g=this._cloneAnimationClip(f);g.userData={};if(f.userData){if(f.userData.maxDuration!==undefined){g.userData.maxDuration=f.userData.maxDuration;}if(f.userData.cyclic!==undefined){g.userData.cyclic=f.userData.cyclic;}if(f.userData.endTime!==undefined){g.userData.endTime=f.userData.endTime;}if(f.userData.frameRate!==undefined){g.userData.frameRate=f.userData.frameRate;}var i,n,m,j;g.userData.nodesEndData=new Map();if(f.userData.nodesEndData){i=f.userData.nodesEndData.entries();n=i.next();while(!n.done){m=n.value[0];j=n.value[1];g.userData.nodesEndData.set(m,j);n=i.next();}}g.userData.nodesStartData=new Map();if(f.userData.nodesStartData){i=f.userData.nodesStartData.entries();n=i.next();while(!n.done){m=n.value[0];j=n.value[1];g.userData.nodesStartData.set(m,j);n=i.next();}}}s.set(d.sequenceId,g);f=g;}if(f){if(!f.userData){f.userData={};}if(!f.userData.highlights){f.userData.highlights=new Map();}}else{continue;}f.resetDuration();var k=f.duration;if(d.duration&&d.duration>k){k=d.duration;}else if(f.userData&&f.userData.maxDuration&&k<f.userData.maxDuration){k=f.userData.maxDuration;}var l,o;for(var r=0;h.highlightNodes&&r<h.highlightNodes.length;r++){var u=h.highlightNodes[r];var w=f.userData.highlights.get(u);if(w){continue;}else{f.userData.highlights.set(u,h);}if(h.opacityTrack){this.insertSingleTrack(f,h.opacityTrack,u);}if(h.colorTrack){var x=false;if(h.colorTrack.keys.length>1&&h.type!=="INFINITE"){x=true;}var y=[];if(u.material&&u.material.color){y.push(u);}else{this._getChildNodesWithMaterial(u,y);}for(var z=0;z<y.length;z++){var N=y[z];var C,D;var E={};E.keys=[];E.data=h.colorTrack.data;var F=0.0;if(x){var G={};F=0.05;G.time=0.0;G.values=[N.material.color.r,N.material.color.g,N.material.color.b];E.keys.push(G);}for(C=0;C<h.colorTrack.keys.length;C++){D={};D.values=h.colorTrack.keys[C].values;D.time=h.colorTrack.keys[C].time+F;E.keys.push(D);}if(x){l=E.keys[E.keys.length-1];o={};o.time=l.time+0.05;o.values=[N.material.color.r,N.material.color.g,N.material.color.b];E.keys.push(o);}if(h.type==="INFINITE"){var H=0.05;if(E.keys.length>1){H=E.keys[E.keys.length-1].time-E.keys[E.keys.length-2].time;}F=E.keys[E.keys.length-1].time+H;var I=F;while(I<k){for(C=0;C<h.colorTrack.keys.length;C++){D={};D.values=h.colorTrack.keys[C].values;D.time=h.colorTrack.keys[C].time+F;E.keys.push(D);I=D.time;if(I>=k){break;}}F=I+H;}}if(h.type==="STATIC"){l=E.keys[E.keys.length-1];o={};o.time=k;o.values=[l.values[0],l.values[1],l.values[2]];E.keys.push(o);}this.insertSingleTrack(f,E,N);}}}f.resetDuration();f.userData.hasHighlight=true;}};A.prototype._getMatrixFromEulerRotationAngles=function(x,y,z,o){var g=function(a,e){var c=Math.cos(a);var s=Math.sin(a);var f=1;var h=0;var i=0;var j=0;var k=0;var l=1;var n=0;var p=0;var u=0;var v=0;var w=1;var C=0;if(e==="X"){l=c;n=-s;v=s;w=c;}else if(e==="Y"){f=c;i=s;u=-s;w=c;}else{f=c;h=-s;k=s;l=c;}var m=new THREE.Matrix4();m.set(f,h,i,j,k,l,n,p,u,v,w,C,0,0,0,1);return m;};o=Math.round(o);var a;var r=new THREE.Matrix4();var b;for(var d=0;d<3;d++){if(d===0){a=x;}else if(d===1){a=y;}else{a=z;}if((o>>(d*2)&3)===0){b=g(a,"X");r.multiply(b);}else if((o>>(d*2)&3)===1){b=g(a,"Y");r.multiply(b);}else if((o>>(d*2)&3)===2){b=g(a,"Z");r.multiply(b);}}return r;};A.prototype._getRotationMatrix=function(i,a,r,b){var x,y,z;var c,d;if(r.type==="euler"){if(i===a){c=r.keys[i];return this._getMatrixFromEulerRotationAngles(c.values[0],c.values[1],c.values[2],c.values[3]);}c=r.keys[i];d=r.keys[a];var o=c.values[3];x=c.values[0]*(1-b)+c.values[0]*b;y=c.values[1]*(1-b)+c.values[1]*b;z=c.values[2]*(1-b)+c.values[2]*b;return this._getMatrixFromEulerRotationAngles(x,y,z,o);}else if(r.type==="angleAxis"){var e=new THREE.Matrix4();var f,g,h;for(var j=0;j<=i;j++){x=r.keys[j].values[0];y=r.keys[j].values[1];z=r.keys[j].values[2];f=r.keys[j].values[3];g=new THREE.Vector3(x,y,z);h=new THREE.Matrix4();h.makeRotationAxis(g,f);e.premultiply(h);}if(i===a){return e;}d=r.keys[a];x=d.values[0];y=d.values[1];z=d.values[2];f=d.values[3]*b;g=new THREE.Vector3(x,y,z);var k=new THREE.Matrix4();k.makeRotationAxis(g,f);k.multiply(e);return k;}else{var l;if(i===a){c=r.keys[i];l=new THREE.Quaternion(c.values[0],c.values[1],c.values[2],c.values[3]);}var m=new THREE.Matrix4();if(l){m.makeRotationFromQuaternion(l);return m;}c=r.keys[i];d=r.keys[a];var E=0.001;var n;var p;var s;var F;var u=c.values[0];var v=c.values[1];var C=c.values[2];var D=c.values[3];var G=d.values[0];var H=d.values[1];var I=d.values[2];var J=d.values[3];var K;var L;K=u*G+v*H+C*I+D*J;if(K<0.0){K=-K;F=true;}else{F=false;}if(K>1.0){K=1.0;}if((1.0-K)<E){n=1.0-b;}else{p=Math.acos(K);s=p;L=Math.sin(p);n=Math.sin(p-b*s)/L;b=Math.sin(b*s)/L;}if(F){b=-b;}x=n*u+b*G;y=n*v+b*H;z=n*C+b*I;var w=n*D+b*J;l=new THREE.Quaternion(x,y,z,w);m.makeRotationFromQuaternion(l);return m;}};A.prototype._getScaleMatrix=function(s,a,b){var x=1,y=1,z=1;if(s&&!a){x=s.values[0];y=s.values[1];z=s.values[2];}else if(!s&&a){x=a.values[0];y=a.values[1];z=a.values[2];}else if(s&&a){x=s.values[0]*(1-b)+a.values[0]*b;y=s.values[1]*(1-b)+a.values[1]*b;z=s.values[2]*(1-b)+a.values[2]*b;}var c=new THREE.Matrix4();c.makeScale(x,y,z);return c;};A.prototype._getTranslateMatrix=function(p,a,b){var x=0,y=0,z=0;if(p&&!a){x=p.values[0];y=p.values[1];z=p.values[2];}else if(!p&&a){x=a.values[0];y=a.values[1];z=a.values[2];}else if(p&&a){x=p.values[0]*(1-b)+a.values[0]*b;y=p.values[1]*(1-b)+a.values[1]*b;z=p.values[2]*(1-b)+a.values[2]*b;}var c=new THREE.Matrix4();c.makeTranslation(x,y,z);return c;};A.prototype.insertTracksWithPivot=function(a,p,s,r,b,n){if(n.children&&n.children.length){var c=true;var o=n.name+" offset geometry";for(var d=0;d<n.children.length;d++){var e=n.children[d];if((e.name===o&&e.type==="Group")||e.isMesh){var f=new THREE.Vector3(b[0],b[1],b[2]);f.applyMatrix4(e.matrix);b[0]=f.x;b[1]=f.y;b[2]=f.z;c=false;break;}}if(c){b[0]=0.0;b[1]=0.0;b[2]=0.0;}}var g=1;var h=0;var l=0;if(r){if(l<r.keys[r.keys.length-1].time){l=r.keys[r.keys.length-1].time;}if(h>r.keys[0].time){h=r.keys[0].time;}if(g<r.keys.length){g=r.keys.length;}}if(p){if(l<p.keys[p.keys.length-1].time){l=p.keys[p.keys.length-1].time;}if(h>p.keys[0].time){h=p.keys[0].time;}if(g<p.keys.length){g=p.keys.length;}}if(s){if(l<s.keys[s.keys.length-1].time){l=s.keys[s.keys.length-1].time;}if(h>s.keys[0].time){h=s.keys[0].time;}if(g<s.keys.length){g=s.keys.length;}}var i=l-h;var k;if(r&&r.keys.length>1){if(r.type==="angleAxis"){var j=0.0;for(k=1;k<r.keys.length;k++){if(j<r.keys[k].values[3]){j=r.keys[k].values[3];}}var u=3.1416/12;var v=Math.ceil((r.keys.length-1)*j/u);if(v>g){g=v;}}else{g=4*r.keys.length;}}var w=i/g;var x=n.uuid;var y=[];var z=[];var C=[];var D=[];var E=new THREE.Matrix4();var F=new THREE.Matrix4();E.makeTranslation(b[0],b[1],b[2]);F.makeTranslation(-b[0],-b[1],-b[2]);var G=new THREE.Matrix4();var H=new THREE.Matrix4();var I=new THREE.Matrix4();var J,K,L;for(L=0;L<=g;L++){var M=h+L*w;var N=0;var O=0;var P=0;if(r){if(M<=r.keys[0].time){N=0;O=0;}else if(M>=r.keys[r.keys.length-1].time){if(r.keys.length>1){P=1;}N=r.keys.length-1;O=r.keys.length-1;}else{for(k=0;k<r.keys.length-1;k++){J=r.keys[k].time;K=r.keys[k+1].time;if(M>=J&&M<=K){P=(M-J)/(K-J);N=k;O=k+1;break;}}}G=this._getRotationMatrix(N,O,r,P);}var Q=null;var R=null;P=0;if(s){if(M<=s.keys[0].time){Q=s.keys[0];}else if(M>=s.keys[s.keys.length-1].time){R=s.keys[s.keys.length-1];}else{for(k=0;k<s.keys.length-1;k++){J=s.keys[k].time;K=s.keys[k+1].time;if(M>=J&&M<=K){Q=s.keys[k];R=s.keys[k+1];P=(M-J)/(K-J);break;}}}H=this._getScaleMatrix(Q,R,P);}var S=null;var T=null;P=0;if(p){if(M<=p.keys[0].time){S=p.keys[0];}else if(M>=p.keys[p.keys.length-1].time){T=p.keys[p.keys.length-1];}else{for(k=0;k<p.keys.length-1;k++){J=p.keys[k].time;K=p.keys[k+1].time;if(M>=J&&M<=K){S=p.keys[k];T=p.keys[k+1];P=(M-J)/(K-J);break;}}}I=this._getTranslateMatrix(S,T,P);}var m=new THREE.Matrix4();m.multiply(I);m.multiply(H);m.multiply(G);m.multiply(F);var U=new THREE.Quaternion();var W=new THREE.Vector3();var X=new THREE.Vector3();m.decompose(W,U,X);C.push(U.x);C.push(U.y);C.push(U.z);C.push(U.w);z.push(W.x);z.push(W.y);z.push(W.z);D.push(X.x);D.push(X.y);D.push(X.z);y.push(M);}var Y={};var Z={};var $=new THREE.Vector3(D[D.length-3],D[D.length-2],D[D.length-1]);Y.scale=$;var _=new THREE.Vector3(D[0],D[1],D[2]);Z.scale=_;var a1=new THREE.Quaternion(C[C.length-4],C[C.length-3],C[C.length-2],C[C.length-1]);Y.quaternion=a1;var b1=new THREE.Quaternion(C[0],C[1],C[2],C[3]);Z.quaternion=b1;var c1=new THREE.Vector3(z[z.length-3],z[z.length-2],z[z.length-1]);Y.position=c1;var d1=new THREE.Vector3(z[0],z[1],z[2]);Z.position=d1;a.userData.nodesEndData.set(n,Y);a.userData.nodesStartData.set(n,Z);var e1=x+".scale";var f1=new THREE.VectorKeyframeTrack(e1,y,D);f1.userData={};f1.userData.originalValue=n.scale.clone();if(s){f1.userData.info=s;f1.userData.type=s.data.type;}if(s&&s.interpolationType===1){f1.setInterpolation(THREE.InterpolateSmooth);}else{f1.setInterpolation(THREE.InterpolateLinear);}f1.userData.targetNode=n;a.tracks.push(f1);var g1=x+".quaternion";var h1=new THREE.QuaternionKeyframeTrack(g1,y,C);h1.userData={};h1.userData.originalValue=n.quaternion.clone();if(r){h1.userData.info=r;h1.userData.type=r.data.type;}if(r&&r.interpolationType===1){h1.setInterpolation(THREE.InterpolateSmooth);}else{h1.setInterpolation(THREE.InterpolateLinear);}h1.userData.targetNode=n;a.tracks.push(h1);var i1=x+".position";var j1=new THREE.VectorKeyframeTrack(i1,y,z);j1.userData={};j1.userData.originalValue=n.position.clone();if(p){j1.userData.info=p;j1.userData.type=p.data.type;}if(p&&p.interpolationType===1){j1.setInterpolation(THREE.InterpolateSmooth);}else{j1.setInterpolation(THREE.InterpolateLinear);}j1.userData.targetNode=n;a.tracks.push(j1);};A.prototype.insertSingleTrack=function(a,b,c){var d=c.uuid;var o;var e=[];var v=[];var k,f;var g;var h;var m,i;var j;var l,p;if(b.data.type==="TRANSLATE"){d+=".position";o=c.position.clone();for(k=0;k<b.keys.length;k++){h=b.keys[k];e.push(h.time);if(h.values.length===3){for(f=0;f<3;f++){v.push(h.values[f]);}}}if(e.length*3!==v.length){return;}l=a.userData.nodesEndData.get(c);if(!l){l={};a.userData.nodesEndData.set(c,l);}p=a.userData.nodesStartData.get(c);if(!p){p={};a.userData.nodesStartData.set(c,p);}var r=new THREE.Vector3(v[v.length-3],v[v.length-2],v[v.length-1]);l.position=r;var s=new THREE.Vector3(v[0],v[1],v[2]);p.position=s;g=new THREE.VectorKeyframeTrack(d,e,v);}else if(b.data.type==="SCALE"){d+=".scale";o=c.scale.clone();for(k=0;k<b.keys.length;k++){h=b.keys[k];e.push(h.time);if(h.values.length===1){v.push(h.values[0]);v.push(h.values[0]);v.push(h.values[0]);}else if(h.values.length===3){for(f=0;f<3;f++){v.push(h.values[f]);}}}if(e.length*3!==v.length){return;}l=a.userData.nodesEndData.get(c);if(!l){l={};a.userData.nodesEndData.set(c,l);}p=a.userData.nodesStartData.get(c);if(!p){p={};a.userData.nodesStartData.set(c,p);}var u=new THREE.Vector3(v[v.length-3],v[v.length-2],v[v.length-1]);l.scale=u;var w=new THREE.Vector3(v[0],v[1],v[2]);p.scale=w;g=new THREE.VectorKeyframeTrack(d,e,v);}else if(b.data.type==="ROTATE"){d+=".quaternion";o=c.quaternion.clone();if(b.type==="euler"){for(k=0;k<b.keys.length;k++){h=b.keys[k];e.push(h.time);m=this._getMatrixFromEulerRotationAngles(h.values[0],h.values[1],h.values[2],h.values[3]);j=new THREE.Quaternion();j.setFromRotationMatrix(m);v.push(j.x);v.push(j.y);v.push(j.z);v.push(j.w);}}else if(b.type==="angleAxis"){var C=b.keys[0];e.push(C.time);var D=C.time;var x=C.values[0];var y=C.values[1];var z=C.values[2];var E=C.values[3];var F=new THREE.Vector3(x,y,z);m=new THREE.Matrix4();m.makeRotationAxis(F,E);j=new THREE.Quaternion();j.setFromRotationMatrix(m);v.push(j.x);v.push(j.y);v.push(j.z);v.push(j.w);for(k=1;k<b.keys.length;k++){h=b.keys[k];var G=D;D=h.time;x=h.values[0];y=h.values[1];z=h.values[2];E=h.values[3];var H=3.1416/12;var I=E/H;if(I<4){I=4;}var J=E/I;var K=(D-G)/I;for(var L=1;L<=I;L++){var M=L*J;var N=G+K*L;e.push(N);F=new THREE.Vector3(x,y,z);i=new THREE.Matrix4();i.makeRotationAxis(F,M);i.multiply(m);j=new THREE.Quaternion();j.setFromRotationMatrix(i);v.push(j.x);v.push(j.y);v.push(j.z);v.push(j.w);}m=i;}}else{for(k=0;k<b.keys.length;k++){h=b.keys[k];e.push(h.time);if(h.values.length===4){for(f=0;f<4;f++){v.push(h.values[f]);}}}}if(e.length*4!==v.length){return;}l=a.userData.nodesEndData.get(c);if(!l){l={};a.userData.nodesEndData.set(c,l);}p=a.userData.nodesStartData.get(c);if(!p){p={};a.userData.nodesStartData.set(c,p);}var O=new THREE.Quaternion(v[v.length-4],v[v.length-3],v[v.length-2],v[v.length-1]);l.quaternion=O;var P=new THREE.Quaternion(v[0],v[1],v[2],v[3]);p.quaternion=P;g=new THREE.QuaternionKeyframeTrack(d,e,v);}else if(b.data.type==="OPACITY"||b.data.type==="COLOR"){var Q=[];if(c.material&&c.material.color){Q.push(c);}this._getChildNodesWithMaterial(c,Q);for(var R=0;R<Q.length;R++){var n=Q[R];if(n.material&&n.material.opacity){if(!n.userData){n.userData={};}n.userData.originalMaterial=n.material;n.material=n.material.clone();if(b.data.type==="OPACITY"){d=n.uuid+".material.opacity";o=n.material.opacity;n.material.transparent=true;}else{d=n.uuid+".material.color";o=n.userData.originalMaterial.color;}}else{continue;}for(k=0;k<b.keys.length;k++){h=b.keys[k];e.push(h.time);if(b.data.type==="OPACITY"){v.push(h.values[0]);}else{v.push(h.values[0]);v.push(h.values[1]);v.push(h.values[2]);}}var S=a.userData.nodesEndData.get(n);if(!S){S={};}var T=a.userData.nodesStartData.get(n);if(!T){T={};}if(b.data.type==="OPACITY"){if(b.data.highlight){S.opacity=n.material.opacity;}else{S.opacity=v[v.length-1];}}else if(b.data.type==="COLOR"){if(b.data.highlight){S.color=n.userData.originalMaterial.color.clone();}else{S.color=new THREE.Color(v[v.length-3],v[v.length-2],v[v.length-1]);}}a.userData.nodesEndData.set(n,S);if(b.data.type==="OPACITY"){if(b.data.highlight){T.opacity=n.material.opacity;}else{T.opacity=v[0];}}else if(b.data.type==="COLOR"){if(b.data.highlight){T.color=n.userData.originalMaterial.color.clone();}else{T.color=new THREE.Color(v[0],v[1],v[2]);}}a.userData.nodesStartData.set(n,T);if(b.data.type==="OPACITY"){g=new THREE.NumberKeyframeTrack(d,e,v);}else{g=new THREE.ColorKeyframeTrack(d,e,v);}g.userData={};g.userData.originalValue=o;g.userData.info=b;g.userData.type=b.data.type;g.userData.targetNode=n;if(b.interpolationType===1){g.setInterpolation(THREE.InterpolateSmooth);}else{g.setInterpolation(THREE.InterpolateLinear);}a.tracks.push(g);}return;}else{return;}g.userData={};g.userData.originalValue=o;g.userData.info=b;g.userData.type=b.data.type;g.userData.targetNode=c;if(b.interpolationType===1){g.setInterpolation(THREE.InterpolateSmooth);}else{g.setInterpolation(THREE.InterpolateLinear);}a.tracks.push(g);};A.prototype.insertTracks=function(a,b,n,s){var c=new Map();var d,e,f;var g,h;for(g=0;g<a.length;g++){d=a[g];var i=b.get(d.id);if(!i||!i.length){continue;}for(h=0;h<i.length;h++){e=n.get(i[h].targetId);if(!e){continue;}var N=c.get(i[h].sequenceId);if(!N){N=new Map();}f=N.get(e);if(!f){f=[];}d.data=i[h];f.push(d);N.set(e,f);c.set(i[h].sequenceId,N);}b.delete(d.id);}var j=c.entries();var k=j.next();while(!k.done){var l=k.value[0];var m=k.value[1];k=j.next();var o=s.get(l);if(!o){continue;}var p=m.entries();var r=p.next();while(!r.done){e=r.value[0];f=r.value[1];r=p.next();var u=null;for(g=0;g<f.length;g++){d=f[g];if(d.data.pivot){u=d.data.pivot;break;}}if(!u){for(g=0;g<f.length;g++){d=f[g];this.insertSingleTrack(o,d,e);}}else{var v;var w;var x;for(g=0;g<f.length;g++){d=f[g];if(d.data.type==="TRANSLATE"){v=d;}else if(d.data.type==="ROTATE"){x=d;}else if(d.data.type==="SCALE"){w=d;}else{this.insertSingleTrack(o,d,e);}}this.insertTracksWithPivot(o,v,w,x,u,e);}}}return this;};A.prototype.setInitialNodePositionsFromSubsequentViews=function(v,a,b,s,o){var c=[];if(v.views){c=v.views;}else if(v.modelViews){c=v.modelViews;}if(!v||!c.length){return;}var d,n,e;var f=new Map();for(var g=c.length-1;g>0;g--){var h;if(c[g].id){h=b.get(c[g].id);}else{h=c[g];}var i;if(h){i=h.playbacks;if(!i&&h.getPlaybacks){i=h.getPlaybacks();}}if(!i){continue;}var j;if(c[g-1].id){j=b.get(c[g-1].id);}else{j=c[g-1];}if(!j){continue;}for(var p=i.length-1;p>=0;p--){var k=i[p];if(k){if(k.isContinuity){continue;}d=s.get(k.sequenceId);if(d){if(o&&!(d.userData&&d.userData.hasHighlight)){continue;}if(!k.playbackReversed){n=d.userData.nodesStartData.entries();}else{n=d.userData.nodesEndData.entries();}e=n.next();while(!e.done){f.set(e.value[0],e.value[1]);e=n.next();}}}}if(!j.userData){j.userData={};}if(!j.userData.nodeStartDataByAnimation){j.userData.nodeStartDataByAnimation=new Map();}n=f.entries();e=n.next();while(!e.done){j.userData.nodeStartDataByAnimation.set(e.value[0],e.value[1]);e=n.next();}}};A.prototype.setInitialNodePositionsFromPreviousViews=function(v,a,b,s,o){var c=[];if(v.views){c=v.views;}else if(v.modelViews){c=v.modelViews;}if(!v||!c.length){return;}var d,n,e;var f=new Map();for(var g=0;g<c.length-1;g++){var p;if(c[g].id){p=b.get(c[g].id);}else{p=c[g];}var h;if(p){h=p.playbacks;if(!h&&p.getPlaybacks){h=p.getPlaybacks();}}if(!h){continue;}var i;if(c[g+1].id){i=b.get(c[g+1].id);}else{i=c[g+1];}if(!i){continue;}for(var j=0;j<h.length;j++){var k=h[j];if(k){if(k.isContinuity){continue;}d=s.get(k.sequenceId);if(d){if(o&&!(d.userData&&d.userData.hasHighlight)){continue;}if(!k.playbackReversed){n=d.userData.nodesEndData.entries();}else{n=d.userData.nodesStartData.entries();}e=n.next();while(!e.done){f.set(e.value[0],e.value[1]);e=n.next();}}}}if(!i.userData){i.userData={};}if(!i.userData.nodeStartDataByAnimation){i.userData.nodeStartDataByAnimation=new Map();}n=f.entries();e=n.next();while(!e.done){i.userData.nodeStartDataByAnimation.set(e.value[0],e.value[1]);e=n.next();}}};A.prototype.setInitialNodePositionsFromCurrenetView=function(v,a,b,s,o){var c=[];if(v.views){c=v.views;}else if(v.modelViews){c=v.modelViews;}if(!v||!c.length){return;}var n,d;for(var e=0;e<c.length;e++){var f;if(c[e].id){f=b.get(c[e].id);}else{f=c[e];}if(!f){continue;}var g=0;var h=null;if(f){h=f.playbacks;if(!h&&f.getPlaybacks){h=f.getPlaybacks();}if(h&&h.length){if(h[0].isContinuity){g=1;}}}if(!h||!h.length){continue;}if(!f.userData){f.userData={};}if(!f.userData.nodeStartDataByAnimation){f.userData.nodeStartDataByAnimation=new Map();}for(var i=h.length-1;i>=g;i--){var p=h[i];var j=s.get(p.sequenceId);if(j){if(o&&!(j.userData&&j.userData.hasHighlight)){continue;}if(p.playbackReversed){n=j.userData.nodesEndData.entries();}else{n=j.userData.nodesStartData.entries();}d=n.next();while(!d.done){f.userData.nodeStartDataByAnimation.set(d.value[0],d.value[1]);d=n.next();}}}}};return A;});
