/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["jquery.sap.global","./library","./DrawerToolbarRenderer","sap/ui/core/Control","sap/m/VBox","sap/m/FlexItemData","sap/m/OverflowToolbar","sap/ui/core/Icon","sap/m/Button","sap/m/ToolbarSeparator","sap/m/ToggleButton","sap/m/MenuButton","sap/ui/vk/tools/Tool","sap/ui/vk/tools/RotateTurntableTool","sap/ui/vk/tools/RotateOrbitTool","sap/ui/vk/tools/RectSelectTool","sap/ui/vk/tools/CrossSectionTool","sap/m/Menu","sap/m/MenuItem"],function(Q,l,D,C,V,F,O,I,B,T,a,M,b,R,c,d,e,f,g){"use strict";var h=C.extend("sap.ui.vk.DrawerToolbar",{metadata:{properties:{expanded:{type:"boolean",defaultValue:true}},aggregations:{content:{type:"sap.ui.core.Control",multiple:true,forwarding:{getter:"_getToolbar",aggregation:"content",forwardBinding:true}}},associations:{viewport:{type:"sap.ui.vk.Viewport",multiple:false}},events:{expanded:{parameters:{expand:{type:"boolean"}}}}},constructor:function(s,S){C.apply(this,arguments);}});var i=[{name:"show",unicode:"e000"},{name:"hide",unicode:"e001"},{name:"turntable",unicode:"e002"},{name:"orbit",unicode:"e003"},{name:"pan",unicode:"e004"},{name:"zoom",unicode:"e005"},{name:"fit-to-view",unicode:"e006"},{name:"rectangular-selection",unicode:"e007"},{name:"structure-browser",unicode:"e008"},{name:"configuration",unicode:"e009"},{name:"setting",unicode:"e00a"},{name:"full-screen",unicode:"e00b"},{name:"predefined-views",unicode:"e00c"},{name:"authoring-app",unicode:"e00d"},{name:"dot",unicode:"e00e"},{name:"empty",unicode:"e00f"},{name:"right-panel-menu",unicode:"e010"},{name:"viewer-app",unicode:"e011"},{name:"hide-association",unicode:"e012"},{name:"cross-section",unicode:"e013"},{name:"cross-section-x",unicode:"e014"},{name:"cross-section-z",unicode:"e015"},{name:"cross-section-y",unicode:"e016"},{name:"reverse-direction",unicode:"e017"},{name:"create-editable-visualisation",unicode:"e018"},{name:"cross-section-z-",unicode:"e019"}],j="vk-icons",k="vk-icons";i.forEach(function(p){sap.ui.core.IconPool.addIcon(p.name,j,k,p.unicode);});var v="sap-icon://vk-icons/";h.prototype.init=function(){if(C.prototype.init){C.prototype.init.apply(this);}this._toolbar=new O({width:"auto",design:sap.m.ToolbarDesign.Solid,layoutData:new F({growFactor:0,shrinkFactor:0}),content:this.createButtons()});this._toolbar.ontouchstart=function(p){p.setMarked();};this._container=new V({renderType:sap.m.FlexRendertype.Bare,alignContent:sap.m.FlexAlignContent.Center,alignItems:sap.m.FlexAlignItems.Center,items:[this._toolbar,new I({src:"sap-icon://navigation-up-arrow",noTabStop:true,press:function(p){this._toggleExpanded();}.bind(this),layoutData:new F({growFactor:0,shrinkFactor:0})}).addStyleClass("drawerToolbarIcon")]});};h.prototype._getViewport=function(){var p=sap.ui.getCore().byId(this.getViewport());if(p instanceof sap.ui.vk.threejs.Viewport){return p;}if(p instanceof sap.ui.vk.Viewport&&p._implementation instanceof sap.ui.vk.threejs.Viewport){return p._implementation;}return null;};var m=[null,new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),0),new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI),new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),-Math.PI/2),new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI/2),new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1,0,0),-Math.PI/2),new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(1,0,0),Math.PI/2)];h.prototype.createButtons=function(){var t=this;var p,q;function r(u,w,x){if(!t._crossSectionTool){t._crossSectionTool=new e();u.addTool(t._crossSectionTool);}p.setPressed(true);t._crossSectionTool.setActive(true,u);if(w!==undefined){t._crossSectionTool.setAxis(w);q.setIcon(v+"cross-section-"+["x","y","z"][w]);}}p=new a({icon:v+"cross-section",type:sap.m.ButtonType.Transparent,tooltip:"Cross Section",press:function(u){var w=t._getViewport();if(w){if(this.getPressed()){r(w);}else if(t._crossSectionTool){t._crossSectionTool.setActive(false,w);}}}});q=new M({type:sap.m.ButtonType.Transparent,tooltip:"Cross Section Axis",icon:v+"cross-section-x",menu:new f({items:[new g({icon:v+"cross-section-x",text:"X",press:function(u){var w=t._getViewport();if(w){r(w,0,false);}}}),new g({icon:v+"cross-section-y",text:"Y",press:function(u){var w=t._getViewport();if(w){r(w,1,false);}}}),new g({icon:v+"cross-section-z",text:"Z",press:function(u){var w=t._getViewport();if(w){r(w,2,false);}}}),new g({icon:v+"reverse-direction",text:"Flip",startsSection:true,press:function(u){var w=t._getViewport();if(w&&t._crossSectionTool&&t._crossSectionTool.getActive()){t._crossSectionTool.setFlip(!t._crossSectionTool.getFlip());}}})]})});this._gestureButtons=[new a({icon:v+"turntable",type:sap.m.ButtonType.Transparent,tooltip:"Turntable",press:function(u){var w=t._getViewport();if(w){t._activateGesture(w,0);}}}),new a({icon:v+"orbit",type:sap.m.ButtonType.Transparent,tooltip:"Orbit",pressed:false,press:function(u){var w=t._getViewport();if(w){t._activateGesture(w,1);}}}),new a({icon:v+"pan",type:sap.m.ButtonType.Transparent,tooltip:"Pan",press:function(u){var w=t._getViewport();if(w){t._activateGesture(w,2);}}}),new a({icon:v+"zoom",type:sap.m.ButtonType.Transparent,tooltip:"Zoom",press:function(){var u=t._getViewport();if(u){t._activateGesture(u,3);}}})];var s=[new B({icon:v+"show",type:sap.m.ButtonType.Transparent,tooltip:"Show",press:function(){var u=t._getViewport();if(u){var w=u._viewStateManager;var x=[];w.enumerateSelection(function(y){x.push(y);});w.setVisibilityState(x,true,false);}}}),new B({icon:v+"hide",type:sap.m.ButtonType.Transparent,tooltip:"Hide",press:function(){var u=t._getViewport();if(u){var w=u._viewStateManager;var x=[];w.enumerateSelection(function(y){x.push(y);});w.setVisibilityState(x,false,false);}}}),new T(),this._gestureButtons[0],this._gestureButtons[1],this._gestureButtons[2],this._gestureButtons[3],new T(),new B({icon:v+"fit-to-view",type:sap.m.ButtonType.Transparent,tooltip:"Fit to View",press:function(){var u=t._getViewport();if(u){u.zoomTo(sap.ui.vk.ZoomTo.All,null,0.5,0);}}}),new T(),new a({icon:v+"rectangular-selection",type:sap.m.ButtonType.Transparent,tooltip:"Rectangular Selection",press:function(u){var w=t._getViewport();if(w){if(!t._rectSelectTool){t._rectSelectTool=new d();}t._rectSelectTool.setActive(this.getPressed(),w);}}}),new T(),p,q,new T(),new M({icon:v+"predefined-views",activeIcon:v+"predefined-views",type:sap.m.ButtonType.Transparent,tooltip:sap.ui.vk.getResourceBundle().getText("PREDEFINED_VIEW_MENUBUTTONTOOLTIP"),menu:new f({items:[new g({text:sap.ui.vk.getResourceBundle().getText("PREDEFINED_VIEW_INITIAL")}),new g({text:sap.ui.vk.getResourceBundle().getText("PREDEFINED_VIEW_FRONT"),startsSection:true}),new g({text:sap.ui.vk.getResourceBundle().getText("PREDEFINED_VIEW_BACK")}),new g({text:sap.ui.vk.getResourceBundle().getText("PREDEFINED_VIEW_LEFT")}),new g({text:sap.ui.vk.getResourceBundle().getText("PREDEFINED_VIEW_RIGHT")}),new g({text:sap.ui.vk.getResourceBundle().getText("PREDEFINED_VIEW_TOP")}),new g({text:sap.ui.vk.getResourceBundle().getText("PREDEFINED_VIEW_BOTTOM")})]}).attachItemSelected(function(u){var w=t._getViewport();if(w){var x=u.getParameters("item").item;var y=this.indexOfItem(x);w._viewportGestureHandler.setView(m[y],1000);}})}),new T(),new a({icon:v+"full-screen",type:sap.m.ButtonType.Transparent,tooltip:sap.ui.vk.getResourceBundle().getText("VIEWER_FULLSCREENBUTTONTOOLTIP"),press:function(u){var w=t._getViewport();var x=function(z){return!!(z.fullScreen||z.webkitIsFullScreen||z.mozFullScreen||z.msFullscreenElement);};if(this.getPressed()){if(!x(document)){if(!t._fullScreenHandler){t._fullScreenHandler=function(u){var z=x(document);if(!z){document.removeEventListener("fullscreenchange",t._fullScreenHandler);document.removeEventListener("mozfullscreenchange",t._fullScreenHandler);document.removeEventListener("webkitfullscreenchange",t._fullScreenHandler);document.removeEventListener("MSFullscreenChange",t._fullScreenHandler);this.setPressed(false);w.removeStyleClass("sapVizKitViewerFullScreen");}}.bind(this);}var y=document.getElementsByTagName("body")[0];if(y.requestFullscreen){document.addEventListener("fullscreenchange",t._fullScreenHandler);y.requestFullscreen();}else if(y.webkitRequestFullScreen){document.addEventListener("webkitfullscreenchange",t._fullScreenHandler);y.webkitRequestFullscreen();}else if(y.mozRequestFullScreen){document.addEventListener("mozfullscreenchange",t._fullScreenHandler);y.mozRequestFullScreen();}else if(y.msRequestFullscreen){document.addEventListener("MSFullscreenChange",t._fullScreenHandler);y.msRequestFullscreen();}}w.addStyleClass("sapVizKitViewerFullScreen");}else{if(x(document)){if(document.cancelFullScreen){document.cancelFullScreen();}else if(document.msExitFullscreen){document.msExitFullscreen();}else if(document.mozCancelFullScreen){document.mozCancelFullScreen();}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen();}}w.removeStyleClass("sapVizKitViewerFullScreen");}}})];return s;};var n=["drawerToolbarIconTurntable","drawerToolbarIconOrbit","drawerToolbarIconPan","drawerToolbarIconZoom"];var o=function(p){this.viewport=p;this._mode=1;this._gesture=false;this._x=0;this._y=0;};o.prototype.beginGesture=function(p){this._gesture=true;if(this._mode<3){this._x=p.points[0].x;this._y=p.points[0].y;}else{this._x=p.x;this._y=p.y;}};o.prototype.endGesture=function(){this._gesture=false;this.viewport.removeStyleClass(n[this._mode]);};o.prototype.move=function(q){if(this._gesture&&q.n==1){this.viewport.addStyleClass(n[this._mode]);var p=q.points[0];var r=p.x-this._x;var s=p.y-this._y;var t=this.viewport._viewportGestureHandler._cameraController;switch(this._mode){case 0:t.rotate(r,s,true);break;case 1:t.rotate(r,s,false);break;case 2:t.pan(r,s);break;case 3:t.zoom(1+s*0.005);break;default:break;}this._x=p.x;this._y=p.y;q.handled=true;}};o.prototype.hover=function(){};o.prototype.getViewport=function(){return this.viewport;};h.prototype._activateGesture=function(p,q){this._gestureButtons.forEach(function(r,s){r.setPressed(s===q);});if(!this._cameraHandler){this._cameraHandler=new o(p);p._loco.addHandler(this._cameraHandler,0);}this._cameraHandler._mode=q;};h.prototype._getToolbar=function(){return this._toolbar;};h.prototype._toggleExpanded=function(){var p=!this.getExpanded();this.setExpanded(p);this.fireExpanded({expand:p});};h.prototype.setExpanded=function(E){this.setProperty("expanded",E,true);var p=this.getDomRef();if(p){if(!E){p.classList.add("drawerToolbarCollapsed");p.classList.remove("drawerToolbarExpanded");}else{p.classList.add("drawerToolbarExpanded");p.classList.remove("drawerToolbarCollapsed");}}return this;};h.prototype.onAfterRendering=function(){var p=this._getViewport();if(p){this._activateGesture(p,1);}};return h;});
