/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

        (c) Copyright 2009-2015 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/core/Control","./ContentConnector","./AnimationTimeSlider","./ViewGalleryRenderer"],function(C,a,A,V){"use strict";var b=C.extend("sap.ui.vk.ViewGallery",{metadata:{library:"sap.ui.vk",properties:{showAnimationTimeSlider:{type:"boolean",defaultValue:true}},associations:{viewport:{type:"sap.ui.vk.threejs.Viewport"},contentConnector:{type:"sap.ui.vk.ContentConnector"}},aggregations:{items:{type:"sap.ui.core.Control",forwarding:{getter:"_getHBox",aggregation:"items",forwardBinding:true}},stepInfoPopup:{type:"sap.ui.core.Control",multiple:false},toolbar:{type:"sap.m.Toolbar",multiple:false},container:{type:"sap.m.ScrollContainer",multiple:false},animationTimeSlider:{type:"sap.ui.vk.AnimationTimeSlider",multiple:false}},events:{selectionChange:{parameters:{item:"sap.ui.core.Control"}}}}});b.prototype.setShowAnimationTimeSlider=function(v){this.setProperty("showAnimationTimeSlider",v);var c=null;if(this.getViewport()){c=sap.ui.getCore().byId(this.getViewport());}if(v){this.setAnimationTimeSlider(new A());if(c){c.setAnimationTimeSlider(this.getAnimationTimeSlider());this.getAnimationTimeSlider().setViewport(c);}}else{this.destroyAnimationTimeSlider();if(c){c.setAnimationTimeSlider(null);}}};b.prototype.init=function(){if(C.prototype.init){C.prototype.init.call(this);}var t=this;this._scene=null;this._items=new Map();this._cdsLoader=null;this._previousOrientationVertical=false;this._userActivated=false;sap.ui.core.IconPool.addIcon("landscape-text","vk-icons","vk-icons","e019");sap.ui.core.IconPool.addIcon("portrait-text","vk-icons","vk-icons","e01a");this.oModel=new sap.ui.model.json.JSONModel();this._toolbar=new sap.m.Toolbar({design:sap.m.ToolbarDesign.Solid});this.setAggregation("toolbar",this._toolbar);this._hbox=new sap.m.HBox();this._scrollContainer=new sap.m.ScrollContainer(this.getId()+"-scroller",{width:"100%",horizontal:true,vertical:false,focusable:true,content:[this._hbox]});this.setAggregation("container",this._scrollContainer);this._previousItemButton=new sap.m.Button(this.getId()+"-previousItemButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://close-command-field",tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PREVIOUSSTEPBUTTON"),press:function(c){var i=t.getSelectedIndex();if(i>0){t.setSelectedItem(t.getItems()[i-1],true);}}});this._nextItemButton=new sap.m.Button(this.getId()+"-nextItemButton",{type:sap.m.ButtonType.Transparent,icon:"sap-icon://open-command-field",tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_NEXTSTEPBUTTON"),press:function(c){var i=t.getSelectedIndex(),d=t.getItems();if(i>=0&&i+1<d.length){t.setSelectedItem(d[i+1],true);}}});this._viewGroupSelector=new sap.m.Popover({showHeader:false,contentWidth:"20%",placement:sap.m.PlacementType.Top,horizontalScrolling:false,verticalScrolling:false,content:[new sap.m.ScrollContainer({horizontal:false,vertical:true,content:[this._procedureList=new sap.m.SelectList({width:"100%",itemPress:function(c){var i=this.indexOfItem(c.getParameter("item"));if(t._viewportGroups){t._modelViews=t._viewportGroups[i].modelViews;t._currentGroupTitle.setText(t._viewportGroups[i].name).setTooltip(t._viewportGroups[i].name);t._separatorTitle.setVisible(true);if((!t._modelViews||t._modelViews.length===0)&&t._cdsLoader){var d=t._viewportGroups[i].originalId;var s=t._viewportGroups[i].sceneId;var r=t._cdsLoader.loadViewGroup(s,d);r.then(function(v){t._viewportGroups[i].modelViews=v;t._modelViews=v;t._refreshItems();});}else{t._refreshItems();}}}})]})]});this._playButton=new sap.m.ToggleButton(this.getId()+"-playButton",{type:sap.m.ButtonType.Transparent,pressed:false,icon:"sap-icon://media-play",visible:true,tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PLAY"),press:function(E){var c=E.getSource();if(c.getPressed()){this._playProcedure();c.setIcon("sap-icon://media-pause");c.setTooltip(sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PAUSE"));}else{this._pauseAnimation();c.setIcon("sap-icon://media-play");c.setTooltip(sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PLAY"));}}.bind(this)});this._stepCount=new sap.m.Title({text:(function(){var i=t.getSelectedIndex(),c=t.getItems();return sap.ui.vk.getResourceBundle().getText("VIEWS_TITLE_WITH_COUNT",[i+1,c.length]);})(),level:"H5",titleStyle:"H5"});this._currentGroupTitle=new sap.m.Title({text:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PROCEDURES"),tooltip:sap.ui.vk.getResourceBundle().getText("STEP_NAV_PROCEDURES"),level:"H5",titleStyle:"H5"}).addStyleClass("sapVizKitStepNavigationCurrentGroupTitle");this._separatorTitle=new sap.m.Title({width:"5px",level:"H5",titleStyle:"H5"});this._currentStepTitle=new sap.m.Title({level:"H5",titleStyle:"H5"}).addStyleClass("sapVizKitStepNavigationCurrentStepTitle");this._currentGroupTitle.addEventDelegate({ontap:function(){this._selectViewGroup();}.bind(this)});this._toolbar.addContent(this._currentGroupTitle).addContent(this._separatorTitle).addContent(this._currentStepTitle).addContent(new sap.m.ToolbarSpacer()).addContent(this._stepCount).addContent(new sap.m.ToolbarSpacer()).addContent(this._previousItemButton).addContent(this._playButton).addContent(this._nextItemButton);if(this.getShowAnimationTimeSlider()){this.setAnimationTimeSlider(new A());}};b.prototype._createStepDescriptionBoxes=function(){this._stepDescription=new sap.m.VBox({renderType:sap.m.FlexRendertype.Bare,fitContainer:false,alignContent:sap.m.FlexAlignContent.Start,alignItems:sap.m.FlexAlignItems.Start,justifyContent:sap.m.FlexJustifyContent.End,items:[this._stepDescriptionToolbar=new sap.m.Toolbar({design:sap.m.ToolbarDesign.Solid,content:[this._stepDescriptionIcon=new sap.ui.core.Icon({src:"sap-icon://navigation-up-arrow",press:function(c){this._toggleViewDescription();}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionIcon"),new sap.m.ToolbarSpacer(),this._stepDescriptionOrientationIcon=new sap.ui.core.Icon({src:"sap-icon://vk-icons/landscape-text",press:function(c){this._toggleOrientation();}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionOrientationIcon")],layoutData:new sap.m.FlexItemData({shrinkFactor:0})}).addStyleClass("sapVizKitViewGalleryStepDescriptionToolbar"),this._stepDescriptionScroll=new sap.m.ScrollContainer({horizontal:false,vertical:true,content:[this._stepDescriptionText=new sap.m.FormattedText({visible:false}).addStyleClass("sapVizKitViewGalleryStepDescriptionText")]})]}).addStyleClass("sapVizKitViewGalleryStepDescription");this._stepDescriptionVertical=new sap.m.HBox({renderType:sap.m.FlexRendertype.Bare,fitContainer:false,alignContent:sap.m.FlexAlignContent.Start,alignItems:sap.m.FlexAlignItems.Start,justifyContent:sap.m.FlexJustifyContent.End,items:[this._stepDescriptionVerticalScroll=new sap.m.ScrollContainer({horizontal:false,vertical:true,content:[this._stepDescriptionVerticalText=new sap.m.FormattedText({visible:false}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalText")]}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalScroll"),this._stepDescriptionVerticalToolbar=new sap.m.Toolbar({design:sap.m.ToolbarDesign.Solid,content:[this._stepDescriptionVerticalIcon=new sap.ui.core.Icon({src:"sap-icon://navigation-right-arrow",press:function(c){this._toggleViewDescriptionVertical();}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalIcon"),this._stepDescriptionVerticalOrientationIcon=new sap.ui.core.Icon({src:"sap-icon://vk-icons/portrait-text",press:function(c){this._toggleOrientation();}.bind(this)}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalOrientationIcon")],layoutData:new sap.m.FlexItemData({shrinkFactor:0})}).addStyleClass("sapVizKitViewGalleryStepDescriptionVerticalToolbar")]}).addStyleClass("sapVizKitViewGalleryStepDescriptionVertical");};b.prototype._selectViewGroup=function(){var f=this._currentGroupTitle;this._viewGroupSelector.openBy(f);};b.prototype._toggleOrientation=function(){if(this._stepDescriptionToolbar.getVisible()){this._stepDescriptionToolbar.setVisible(false);this._stepDescriptionVerticalToolbar.setVisible(true);this._previousOrientationVertical=true;if(this._stepDescriptionText.getVisible()){this._stepDescriptionVerticalText.setVisible(true);}this._stepDescriptionText.setVisible(false);}else{this._stepDescriptionToolbar.setVisible(true);this._previousOrientationVertical=false;if(this._stepDescriptionVerticalText.getVisible()){this._stepDescriptionText.setVisible(true);}this._stepDescriptionVerticalToolbar.setVisible(false);this._stepDescriptionVerticalText.setVisible(false);}this._stepDescription.rerender();this._stepDescriptionVertical.rerender();};b.prototype._toggleViewDescription=function(){if(!this._stepDescriptionText.getVisible()){this._stepDescriptionText.setVisible(true);this._stepDescriptionIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionVerticalIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");}else{this._stepDescriptionText.setVisible(false);this._stepDescriptionIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionVerticalIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");}this._stepDescriptionText.rerender();};b.prototype._toggleViewDescriptionVertical=function(){if(!this._stepDescriptionVerticalText.getVisible()){this._stepDescriptionVerticalText.setVisible(true);this._stepDescriptionVerticalIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionIcon.addStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");}else{this._stepDescriptionVerticalText.setVisible(false);this._stepDescriptionVerticalIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");}this._stepDescriptionVerticalText.rerender();};b.prototype._getHBox=function(){return this._hbox;};b.prototype._playProcedure=function(){if(this._modelViews){var v=sap.ui.getCore().byId(this.getViewport());var s=this.getSelectedIndex();if(s===-1){s=0;}v.playProcedure(this._modelViews,s);}};b.prototype._finishProcedure=function(){this._playButton.setPressed(false);this._playButton.setIcon("sap-icon://media-play");this._playButton.setTooltip(sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PLAY"));this._refreshItems();};b.prototype._finishView=function(){this._playButton.setPressed(false);this._playButton.setIcon("sap-icon://media-play");this._playButton.setTooltip(sap.ui.vk.getResourceBundle().getText("STEP_NAV_PLAYMENU_PLAY"));};b.prototype._pauseAnimation=function(){var v=sap.ui.getCore().byId(this.getViewport());v.pauseAnimation();};b.prototype.setScene=function(s){if(s&&s.getSceneRef()===this._scene){return;}if(s&&s.loaders){for(var i=0;i<s.loaders.length;i++){if(s.loaders[i]instanceof sap.ui.vk.threejs.ContentDeliveryService){this._cdsLoader=s.loaders[i];this._cdsLoader.attachViewGroupUpdated(this._handleCdsViewGroupUpdate,this);break;}}}this._scene=s?s.getSceneRef():null;this._refreshProcedures();this._refreshItems();};b.prototype.setViewport=function(v){this.setAssociation("viewport",v,true);if(v){var t=this;v.attachViewActivated(function(c){var i=t.getItems();var d=c.getParameter("viewIndex");var s=i[d];t.setSelectedItem(s,false,false);});v.attachProcedureFinished(function(c){t._finishProcedure();});v.attachViewFinished(function(c){if(t._userActivated){t._finishView();}});this._createStepDescriptionBoxes();v.addContent(this._stepDescription);v.addContent(this._stepDescriptionVertical);v.setAnimationTimeSlider(this.getAnimationTimeSlider());this.getAnimationTimeSlider().setViewport(v);}};b.prototype._refreshProcedures=function(){this._procedureList.removeAllItems();this._viewportGroups=null;this._modelViews=null;if(this._scene&&this._scene.userData){this._viewportGroups=this._scene.userData.viewportGroups;if(this._viewportGroups&&this._viewportGroups.length>0){this._viewportGroups.forEach(function(v){v.id=THREE.Math.generateUUID();this._procedureList.addItem(new sap.ui.core.Item({key:v.id,text:v.name}));}.bind(this));this._modelViews=this._viewportGroups[0].modelViews;this._currentGroupTitle.setText(this._viewportGroups[0].name).setTooltip(this._viewportGroups[0].name);}}this._refreshItems();};b.prototype.refresh=function(s){this.setScene(s);};var e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAE4AAAA8CAYAAADIQIzXAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFFmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDAgNzkuMTYwNDUxLCAyMDE3LzA1LzA2LTAxOjA4OjIxICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKE1hY2ludG9zaCkiIHhtcDpDcmVhdGVEYXRlPSIyMDE4LTA2LTA1VDEzOjU1OjAzKzEyOjAwIiB4bXA6TW9kaWZ5RGF0ZT0iMjAxOC0wNi0wNVQxNDowMDo1MCsxMjowMCIgeG1wOk1ldGFkYXRhRGF0ZT0iMjAxOC0wNi0wNVQxNDowMDo1MCsxMjowMCIgZGM6Zm9ybWF0PSJpbWFnZS9wbmciIHBob3Rvc2hvcDpDb2xvck1vZGU9IjMiIHBob3Rvc2hvcDpJQ0NQcm9maWxlPSJzUkdCIElFQzYxOTY2LTIuMSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoyNGZiYjQ5MS1mNzFkLTRm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";b.prototype._refreshItems=function(){this._currentStepTitle.setText("");this._separatorTitle.setText("");this._viewGroupSelector.close();this._hbox.removeAllItems();this._items.clear();this._stepDescriptionToolbar.setVisible(false);this._stepDescriptionVerticalToolbar.setVisible(false);this._stepDescriptionText.setVisible(false);this._stepDescriptionIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");this._stepDescriptionVerticalText.setVisible(false);this._stepDescriptionVerticalIcon.removeStyleClass("sapVizKitViewGalleryStepDescriptionIconTransform");if(this._modelViews){var p=function(c){this.setSelectedItem(c.getSource().getParent(),true,true);}.bind(this);this._stepCount.setText(sap.ui.vk.getResourceBundle().getText("VIEWS_TITLE_WITH_COUNT",[0,this._modelViews.length]));var s=1;this._modelViews.forEach(function(m){var i=new sap.m.Image({alt:m.name,src:m.thumbnailData||e,densityAware:false,tooltip:m.name,press:p,layoutData:new sap.m.FlexItemData({shrinkFactor:0})});var c=new sap.m.FormattedText({htmlText:s}).addStyleClass("sapVizKitViewGalleryStepNumberText");i.addStyleClass("sapVizKitStepNavigationStepItem");var d=new sap.m.HBox({items:[c,i]});d.data("modelView",m);d.getImage=function(){return i;};d.getNumber=function(){return c;};this._items.set(m,d);this._hbox.addItem(d);s++;}.bind(this));}};b.prototype.setSelectedItem=function(i,c,u){if(this._selectedItem){if(this._selectedItem!==i){this._selectedItem.getImage().removeStyleClass("selected");this._selectedItem.getNumber().removeStyleClass("sapVizKitViewGalleryStepNumberTextSelected");}}this._selectedItem=i;this._userActivated=!!u;var t=sap.ui.vk.getResourceBundle().getText("VIEWS_TITLE_WITH_COUNT",[this.getSelectedIndex()+1,this.getItems().length]);this._stepCount.setText(t);if(i){i.getNumber().addStyleClass("sapVizKitViewGalleryStepNumberTextSelected");i.getImage().addStyleClass("selected");if(this._isScrollingNecessary(i.getDomRef(),this._scrollContainer.getDomRef())){this._scrollContainer.scrollToElement(i,500);}var v=sap.ui.getCore().byId(this.getViewport());if(v&&i.getCustomData().length>0){var m=i.getCustomData()[0].getValue();if(c){v.activateView(m);}if(m.description){if(this._previousOrientationVertical===false){this._stepDescription.setVisible(true);this._stepDescriptionToolbar.setVisible(true);this._stepDescriptionVerticalToolbar.setVisible(false);}else{this._stepDescriptionVertical.setVisible(true);this._stepDescriptionToolbar.setVisible(false);this._stepDescriptionVerticalToolbar.setVisible(true);this._previousOrientationVertical=true;}}else if(this._previousOrientationVertical===true){this._stepDescriptionVertical.setVisible(false);}else{this._stepDescription.setVisible(false);this._previousOrientationVertical=false;}this._separatorTitle.setText("/");this._currentStepTitle.setText(m.name).setTooltip(m.name);if(m.description!=null){this._stepDescriptionText.setHtmlText(m.description);this._stepDescriptionVerticalText.setHtmlText(m.description);}}this._stepDescription.rerender();this._stepDescriptionVertical.rerender();}this.fireSelectionChange({item:i});return this;};b.prototype.getSelectedItem=function(){return this._selectedItem;};b.prototype.getSelectedIndex=function(){return this.indexOfItem(this.getSelectedItem());};b.prototype._isScrollingNecessary=function(i,s){if(i&&s){var r=i.getBoundingClientRect();return r.left<0||r.right>s.clientWidth;}return false;};b.prototype._setContent=function(c){this.setScene((c&&c instanceof sap.ui.vk.threejs.Scene)?c:null);if(c&&c instanceof sap.ui.vk.threejs.Scene&&c.builders){for(var i=0;i<c.builders.length;i++){c.builders[i]._fireThumbnailLoaded=function(d){var f=this._items.get(d.modelView);if(f){f.getImage().setSrc(d.modelView.thumbnailData);}}.bind(this);}}};b.prototype._onAfterUpdateContentConnector=function(){this._setContent(this._contentConnector.getContent());};b.prototype._handleContentChangesStarted=function(){this.setScene(null);};b.prototype._handleContentReplaced=function(c){var d=c.getParameter("newContent");this._setContent(d);};b.prototype._handleCdsViewGroupUpdate=function(c){if(this._modelViews){this._refreshItems();}else{this._refreshProcedures();this._refreshItems();}};a.injectMethodsIntoClass(b);return b;});
