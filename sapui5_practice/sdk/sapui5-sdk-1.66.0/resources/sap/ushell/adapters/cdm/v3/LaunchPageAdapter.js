// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/adapters/cdm/v3/_LaunchPage/readHome","sap/ushell/adapters/cdm/_LaunchPage/modifyHome","sap/ushell/adapters/cdm/v3/_LaunchPage/readCatalogs","sap/m/library","sap/ushell/utils","sap/ushell/adapters/cdm/v3/utilsCdm","sap/ushell/adapters/cdm/v3/AdapterBase","sap/ushell/adapters/cdm/v3/_LaunchPage/readVisualizations","sap/ushell/navigationMode","sap/ushell/Config"],function(r,m,R,M,u,U,A,o,n,C){"use strict";var g=M.GenericTileMode;var S="sap.ushell.components.tiles.cdm.applauncher";var D="sap.ushell.components.tiles.cdm.applauncherdynamic";function L(a,p,b){A.call(this,a,p,b);this._getTileFromHashInContextOfSite=function(e,s,I){var v=new jQuery.Deferred(),w=s[I];if(!w){w=e(I);s[I]=w;}w.done(function(T){var x={tileIntent:I,tileResolutionResult:T};v.resolve(x);}).fail(function(E){v.reject("Hash '"+I+"' could not be resolved to a tile. "+E);});return v.promise();};this._getTileFromHash=function(I){var e=sap.ushell.Container.getService("ClientSideTargetResolution");var s=e.resolveTileIntent.bind(e);return this._getTileFromHashInContextOfSite(s,this._mCatalogTilePromises,I);};this._getTileFromHashFromSite=function(s,I){var e=sap.ushell.Container.getService("ClientSideTargetResolution");var v=U.formatSite(s);var w=e.resolveTileIntentInContext.bind(e,v);var x={};return this._getTileFromHashInContextOfSite(w,x,I);};this._getTileForUrl=function(T){var e={componentName:T.indicatorDataSource?D:S};return{tileIntent:"#",tileResolutionResult:{tileComponentLoadInfo:e,isCustomTile:false}};};this._prepareTileHash=function(T){var e=sap.ushell.Container.getService("URLParsing"),P={},s,v;if(this._isCatalogTile(T)){return T.tileIntent;}if(this._isGroupTile(T)&&T.target){v=T.target.parameters||[];v.forEach(function(w){if(w.name&&w.value){P[w.name]=[w.value];}});s={target:{semanticObject:T.target.semanticObject,action:T.target.action},params:P,appSpecificRoute:T.target.appSpecificRoute};return"#"+e.constructShellHash(s);}return undefined;};this.getDefaultGroup=function(){var e=new jQuery.Deferred(),s;var v=this;if(!this._oDefaultGroup){s=this._ensureLoaded();}if(s){s.done(function(){e.resolve(v._oDefaultGroup);}).fail(function(w){e.reject("Failed to access default group. "+w);});}else{e.resolve(v._oDefaultGroup);}return e.promise();};this.addGroup=function(T){var e=new jQuery.Deferred(),s=sap.ushell.Container.getService("CommonDataModel"),G,v,w=this;if(!this._isValidTitle(T)){return e.reject("No valid group title").promise();}v="Failed to add the group with title '"+T+"' to the homepage. ";s.getSite().done(function(x){G=u.generateUniqueId(r.getGroupIdsFromSite(x));m.addGroupToSite(x,m.createEmptyGroup(G,T));s.save().done(function(){delete w._ensureLoadedDeferred;e.resolve(x.groups[G],G);}).fail(function(E){e.reject(E);});}).fail(function(E){e.reject(v+E);});return e.promise();};this.setGroupTitle=function(G,N){var e=this,s=new jQuery.Deferred(),v=sap.ushell.Container.getService("CommonDataModel"),O,w;if(typeof G!=="object"||!r.getGroupId(G)){return s.reject("Unexpected group value").promise();}if(!e._isValidTitle(N)){return s.reject("Unexpected oGroup title value").promise();}w="Failed to set new title for group with id '"+r.getGroupId(G)+"'. ";O=r.getGroupTitle(G);v.getSite().done(function(x){if(G){m.setGroupTitle(G,N);}v.save().done(function(){s.resolve();}).fail(function(E){jQuery.sap.log.error(E);s.reject(O);});}).fail(function(E){s.reject(O,w+E);});return s.promise();};this.hideGroups=function(H){var e=new jQuery.Deferred(),s=sap.ushell.Container.getService("CommonDataModel"),G;if(H&&jQuery.isArray(H)){G="Failed to hide group. ";s.getSite().done(function(v){r.getGroupsArrayFromSite(v).forEach(function(w){m.setGroupVisibility(w,jQuery.inArray(r.getGroupId(w),H)===-1);});s.save().done(function(){e.resolve();}).fail(function(E){e.reject("Hiding of groups did not work as expected - "+E);});}).fail(function(E){e.reject(G+E);});}else{e.reject("Invalid input parameter aHiddenGroupIds. Please pass a valid input parameter.");}return e.promise();};this.moveGroup=function(G,e){var s=new jQuery.Deferred(),v=sap.ushell.Container.getService("CommonDataModel"),w,x;if(!G||!r.getGroupId(G)||e<0){return s.reject("Unable to move groups - invalid parameters").promise();}x="Failed to move group with id '"+G.identification.id+"'. ";v.getSite().done(function(y){var z=r.getGroupIdsFromSite(y),B=r.getGroupId(G);if(!z){return s.reject("groupsOrder not found - abort operation of adding a group.");}else if(z.indexOf(B)===e){return s.resolve();}w=u.moveElementInsideOfArray(z,z.indexOf(B),e);if(!w){return s.reject("invalid move group operation - abort.");}m.setGroupsOrder(y,w);v.save().done(function(){s.resolve();}).fail(function(E){s.reject(E);});return undefined;}).fail(function(E){s.reject(x+E);});return s.promise();};this.removeGroup=function(G){var e=new jQuery.Deferred(),s=sap.ushell.Container.getService("CommonDataModel"),v,w;if(typeof G!=="object"){return e.reject("invalid group parameter").promise();}w=r.getGroupId(G);if(!w){return e.reject("group without id given").promise();}v="Failed to remove group with id '"+w+"'. ";s.getSite().done(function(x){m.removeGroupFromSite(x,G);s.save().done(function(){e.resolve();}).fail(function(E){e.reject(E);});}).fail(function(E){e.reject(v+E);});return e.promise();};this.resetGroup=function(G){var e=new jQuery.Deferred(),s=sap.ushell.Container.getService("CommonDataModel"),v=[],w=this,x,y;if(typeof G==="object"&&r.getGroupId(G)){y=r.getGroupId(G);x="Failed to reset group with id '"+y+"'. ";s.getSite().done(function(z){jQuery.extend(true,v,r.getGroupsArrayFromSite(z));if(w.isGroupRemovable(G)===false){s.getGroupFromOriginalSite(y).done(function(B){if(typeof z==="object"&&r.getGroupFromSite(z,y)){m.overwriteGroup(z,B,y);}s.save().done(function(){e.resolve(B);}).fail(function(E){e.reject("Group could not be reset - "+E,v);});}).fail(function(E){e.reject("Group could not be reset - "+E,v);});}else{e.reject("Group could not be reset as it was created by the user",v);}}).fail(function(E){e.reject(x+E,[]);});}return e.promise();};this.getLinkTiles=function(G){return r.getGroupLinks(G);};this.isLinkPersonalizationSupported=function(T){return true;};this._notifyTileAboutRefresh=function(T){if(typeof T.tileRefresh==="function"){T.tileRefresh();}};this.refreshTile=function(T){var e=this._mResolvedTiles[T.id];if(e){if(e.tileComponent){this._notifyTileAboutRefresh(e.tileComponent);}}};this._notifyTileAboutVisibility=function(T,N,O){if(typeof T.tileSetVisible==="function"&&O!==N){T.tileSetVisible(N);}};this.getTileView=function(G){var e=this;return new jQuery.Deferred(function(s){return e._getTileView(G,false).then(function(T){s.resolve(T);},function(v){var E="Tile with ID '"+G.id+"' could not be initialized"+(v?":\n"+v:".");jQuery.sap.log.error(E,null,G.tileType);s.reject(E);});}).promise();};this._getCatalogTileView=function(e){if(typeof e!=="object"){throw new Error(e);}return this._getTileUiComponentContainerSync(e,e,true);};this._getCatalogTileViewControl=function(e){var s=new jQuery.Deferred();if(typeof e!=="object"){var E="Invalid input parameter passed to _getCatalogTileView: "+e;jQuery.sap.log.error(E);return s.reject(E).promise();}return this._getTileUiComponentContainer(e,e,true);};this._createLinkInstance=function(T,I,N,G,e){var s,v,w,x=this.getTileSubtitle(T);var y=G;if(I===true){s=this.getCatalogTileTitle(T);}else{s=this.getTileTitle(T);}v=new y({mode:g.LineMode,subheader:x,header:s,press:function(E){this._genericTilePressHandler(T,E);}.bind(this)});if(N){w=e.i18n.getText(N+"NavigationMode");v.setAriaLabel(w+" "+s+" "+x);}this._mResolvedTiles[T.id].linkTileControl=v;return v;};this._genericTilePressHandler=function(T,e){var s;if(e.getSource().getScope&&e.getSource().getScope()==="Display"){s=this.getTileTarget(T);if(s){if(s[0]==="#"){hasher.setHash(s);}else{window.open(s,"_blank");}}}};this._addTileToSite=function(P,G,N,e){var s=this,v=new jQuery.Deferred(),I=sap.ushell.Container.getService("URLParsing").parseShellHash(N.properties.targetURL),T={"id":s.getTileId(N),"target":{"semanticObject":I.semanticObject,"action":I.action,"parameters":q(I.params)}};P.groups[G.identification.id].payload.tiles.push(T);e.save().done(function(){v.resolve(T);}).fail(function(w){v.reject(w);});return v.promise();};this.addTile=function(e,G){var s=new jQuery.Deferred(),v,w=sap.ushell.Container.getService("CommonDataModel"),x;if(!G){G=this._oDefaultGroup;}if(e.contentProviderId){if(e.externalUrl){return this.addBookmark(this._getBookmarkDataForExtensionCatalogTile(e),G);}return s.reject("Extension Tile without URL").promise();}x=f();x.vizId=e.vizId;this._mResolvedTiles[x.id]={tileIntent:e.tileIntent,tileResolutionResult:e.tileResolutionResult,isLink:false};w.getSite().done(function(y){y.groups[G.identification.id].payload.tiles.push(x);w.save().done(function(){s.resolve(x);}).fail(function(z){s.reject(z);});}).fail(function(E){v="Failed to add tile with id '"+x.id+"' to group with id '"+G.identification.id+"'. ";s.reject(v+E);});return s.promise();};this._getBookmarkDataForExtensionCatalogTile=function(e){var B={title:e.tileResolutionResult.title,subtitle:e.tileResolutionResult.subTitle,icon:e.tileResolutionResult.icon,info:e.tileResolutionResult.info,url:e.externalUrl};if(e.tileResolutionResult.indicatorDataSource&&e.tileResolutionResult.indicatorDataSource.path){B.serviceUrl=e.tileResolutionResult.indicatorDataSource.path;B.serviceRefreshInterval=e.tileResolutionResult.indicatorDataSource.refresh;}return B;};this.removeTile=function(G,T,I){var s,v,w=new jQuery.Deferred(),x=this;if(!G||typeof G!=="object"||!G.identification||!G.identification.id||!T||typeof T!=="object"||!T.id){return w.reject({},"Failed to remove tile. No valid input parameters passed to removeTile method.").promise();}v="Failed to remove tile with id '"+T.id+"' from group with id '"+G.identification.id+"'. ";s=sap.ushell.Container.getService("CommonDataModel");s.getSite().done(function(y){var P,z;I=+I;try{P=y.groups[G.identification.id].payload;}catch(e){w.reject(y.groups[G.identification.id],v);}z=x.getTileType(T)===x.TileType.Link?"links":"tiles";if(x.getTileType(T)===x.TileType.Link){I-=P.tiles.length;}if(I>=0){P[z].splice(I,1);}else{P[z]=P[z].filter(function(B){return B.id!==T.id;});}s.save().done(function(){w.resolve();}).fail(function(E){jQuery.sap.log.error(E);w.reject(y.groups[G.identification.id],E);});}).fail(function(e){w.reject({},v+e);});return w.promise();};this.moveTile=function(T,s,e,v,w,x){var y=new jQuery.Deferred(),z=sap.ushell.Container.getService("CommonDataModel"),B=this,G;if(!T||jQuery.isEmptyObject(T)||s===undefined||s<0||e===undefined||e<0||!v||!v.identification||!v.identification.id||!w||!w.identification||!w.identification.id){return y.reject("Invalid input parameters").promise();}G="Failed to move tile with id '"+T.id+"'. ";z.getSite().done(function(E){var F,H,O=B.getTileType(T)===B.TileType.Link?"links":"tiles";if(!x){x=B._mResolvedTiles[T.id].isLink?"link":"tile";}F=x==="link"?"links":"tiles";if(O!==F&&B._mResolvedTiles[T.id]){B._mResolvedTiles[T.id].isLink=x==="link";}if(F==="links"){e-=E.groups[w.identification.id].payload.tiles.length;}if(O==="links"){s-=E.groups[v.identification.id].payload.tiles.length;}if(v.identification.id===w.identification.id){if(s!==e||O!==F){H=E.groups[w.identification.id].payload;H[O].splice(s,1);H[F].splice(e,0,T);}else{return y.resolve(T).promise();}}else{E.groups[v.identification.id].payload[O].splice(s,1);E.groups[w.identification.id].payload[F].splice(e,0,T);}z.save().done(function(){y.resolve(T);}).fail(function(I){jQuery.sap.log.error(G+I);y.reject(G+I);});return undefined;}).fail(function(E){jQuery.sap.log.error(G+E);y.reject(G+E);});return y.promise();};this._compareCatalogs=function(e,B){if(e.identification.id>B.identification.id){return 1;}return-1;};this.getCatalogs=function(){var e=this,s=new jQuery.Deferred(),v=[],w=sap.ushell.Container.getService("CommonDataModel");function x(y,z,v,G,P,B){var E=y.catalogs[z];if(P&&B){E.contentProviderId=P;B.catalogsMap[z]=E;}v.push(E);G.notify(E);}window.setTimeout(function(){w.getSite().done(function(y){Object.keys(y.catalogs).forEach(function(z){x(y,z,v,s);});w.getExtensionSites().progress(function(z){var P=z.providerId;var E=z.site;var B=Promise.resolve(E);var F={sitePromise:B,site:E,catalogsMap:{}};Object.keys(E.catalogs).forEach(function(G){e._mContentProviders[P]=F;x(E,G,v,s,P,F);});}).done(function(z){z.filter(function(B){return!B.success;}).forEach(function(F,I){v.push({identification:{id:F.providerId},contentProviderId:F.providerId,error:"The following content providers could not provide catalogs: "+F.providerId+(F.error?" -> "+F.error:"")});});s.resolve(v.sort(e._compareCatalogs));});});},0);return s.promise();};this._isStartableInbound=function(I){var N=["Shell-plugin","Shell-bootConfig"],e;if(!I.semanticObject||!I.action){return false;}if(N.indexOf(I.semanticObject+"-"+I.action)>-1){return false;}if(!jQuery.sap.getObject("signature.parameters",undefined,I)){return true;}e=Object.keys(I.signature.parameters).every(function(p){return!I.signature.parameters[p].filter||(!!I.signature.parameters[p].launcherValue||p==="sap-external-url");});return e;};this._isHiddenInbound=function(I){return!!I.hideLauncher;};this._toHashFromInbound=function(I){var s=U.toHashFromInbound(I);if(!s){return undefined;}return"#"+s;};this._getExternalUrlFromInbound=function(I){return jQuery.sap.getObject("signature.parameters.sap-external-url.launcherValue.value",undefined,I)||null;};this._toHashFromOutbound=function(O){var s=U.toHashFromOutbound(O);if(!s){return undefined;}return"#"+s;};this._isCustomTile=function(e){if(u.getMember(e,"sap|flp.type")==="tile"){return true;}return false;};this.getCatalogTiles=function(e){var s=this,v=new jQuery.Deferred();if(typeof e!=="object"||e===null){return v.reject("Invalid input parameter '"+e+"' passed to getCatalogTiles.").promise();}if(e.contentProviderId&&this._mContentProviders[e.contentProviderId]){this._mContentProviders[e.contentProviderId].sitePromise.then(function(w){c.call(s,e,w).done(v.resolve).fail(v.reject);},function(E){v.reject("Failed to get site: "+E);});}else{sap.ushell.Container.getService("CommonDataModel").getSite().done(function(w){c.call(s,e,w).done(v.resolve).fail(v.reject);}).fail(function(E){v.reject("Failed to get site: "+E);});}return v.promise();};this.isCustomTile=function(s){return!(s===S||s===D);};function c(e,s){var v=this,w=new jQuery.Deferred();setTimeout(function(){var x=((e.payload&&e.payload.viz)||[]).reduce(function(y,V){var z,B,E,F,G,I,H,J,N,O,T,K,P,Q,W,X,Y;if(!V){return y;}B=o.get(s,V);if(!B){return y;}E=o.getTypeId(B);F=o.getType(s,E);z=o.getAppId(B);if(z){G=o.getAppDescriptor(s,z);if(!G){return y;}I=r.getInbound(G,o.getTarget(B).inboundId);if(!I){return y;}if(!v._isStartableInbound(I.inbound)||v._isHiddenInbound(I.inbound)){return y;}J=U.mapOne(I.key,I.inbound,G,B,F,s);if(!J||!J.tileResolutionResult){return y;}Q=J.resolutionResult.applicationType;W=J.resolutionResult.additionalInformation;Y=C.last("/core/navigation/enableInPlaceForClassicUIs");X=Y?Y[Q]:false;N=n.computeNavigationModeForHomepageTiles(Q,W,X);O=o.getOutbound(B,I.inbound);H=v._toHashFromOutbound(O);}else{var Z=o.getConfig(B);if(Z===undefined){return y;}J=U.mapOne(undefined,undefined,undefined,B,F,s);if(u.getMember(Z,"sap|flp.target.type")==="URL"){P=u.getMember(Z,"sap|flp.target.url");}}T=J.tileResolutionResult;T.navigationMode=N;if(e.contentProviderId){P=v._getMember(G,"sap|app.crossNavigation.inbounds.Shell-launchURL.signature.parameters.sap-external-url.launcherValue.value");}K={id:V,vizId:V,tileIntent:P||H,tileResolutionResult:T,isCatalogTile:true};if(e.contentProviderId&&P){K.contentProviderId=e.contentProviderId;K.externalUrl=P;}y.push(K);return y;},[]);w.resolve(x);},0);return w.promise();}this.getCatalogError=function(e){if(e.error){return e.error;}return undefined;};this.getCatalogId=function(e){return R.getId(e);};this.getCatalogTitle=function(e){return R.getTitle(e);};this._isFailedCatalogTile=function(T){return!!(T&&this._mFailedResolvedCatalogTiles&&this._mFailedResolvedCatalogTiles[r.getTileId(T)]);};this.getCatalogTileTitle=function(G){if(this._isGroupTile(G)){if(this._isFailedGroupTile(G)){return"";}return this._mResolvedTiles[G.id].tileResolutionResult.title;}if(this._isCatalogTile(G)){if(this._isFailedCatalogTile(G)){return undefined;}return G.tileResolutionResult.title;}return undefined;};this.getCatalogTileSize=function(e){return this.getTileSize(e);};this.getCatalogTileView=function(e){return this._getCatalogTileView(e);};this.getCatalogTileViewControl=function(e){return this._getCatalogTileViewControl(e);};this.getCatalogTilePreviewTitle=function(G){if(this._isGroupTile(G)){return this.getTileTitle(G);}return(G.tileResolutionResult&&G.tileResolutionResult.title)||"";};this.getCatalogTilePreviewSubtitle=function(G){if(this._isGroupTile(G)){return this.getTileSubtitle(G);}return(G.tileResolutionResult&&G.tileResolutionResult.subTitle)||"";};this.getCatalogTilePreviewIcon=function(G){if(this._isGroupTile(G)){return this.getTileIcon(G);}return(G.tileResolutionResult&&G.tileResolutionResult.icon)||"";};this.getCatalogTilePreviewInfo=function(G){if(this._isGroupTile(G)){return this.getTileInfo(G);}return(G.tileResolutionResult&&G.tileResolutionResult.info)||"";};this.getCatalogTileKeywords=function(G){var K=[],e=G;if(!e){jQuery.sap.log.error("Could not find the Tile","sap.ushell.adapters.cdm.LaunchPageAdapter");return K;}if(this._mResolvedTiles&&this._mResolvedTiles[G.id]){e=this._mResolvedTiles[G.id];}if(e&&e.tileResolutionResult&&e.tileResolutionResult.title){K.push(e.tileResolutionResult.title);}if(e&&e.tileResolutionResult&&e.tileResolutionResult.subTitle){K.push(e.tileResolutionResult.subTitle);}return K;};this._visitBookmarks=function(s,v){var e=sap.ushell.Container;var w=e.getService("URLParsing");var x=e.getService("CommonDataModel");var y;var I=w.parseShellHash(s);if(I){y=l(I);}else{y=k(s);}return x.getSite().then(function(z){var G=z.groups;var T=Object.keys(G).filter(function(K){return!G[K].payload.locked;}).map(function(K){return G[K].payload.tiles.filter(function(B){return B.isBookmark&&i(y,B.target);});}).reduce(function(B,E){Array.prototype.push.apply(B,E);return B;},[]);if(!v){return T.length;}return jQuery.when(T.map(v)).then(function(){return T.length;});});};this.addBookmark=function(P,G){var e=this;return new jQuery.Deferred(function(s){var v=sap.ushell.Container;var w=v.getService("URLParsing");var x=v.getService("CommonDataModel");jQuery.when(G||e.getDefaultGroup(),x.getSite()).done(function(G,y){var T,z,I=w.parseShellHash(P.url),B,E=false;if(!I){z=k(P.url);E=true;}else{z=l(I);}T=d(P,z);if(E){B=new jQuery.Deferred();B.resolve(e._getTileForUrl(T));}else{B=e._getTileFromHash(P.url);}B.done(function(N){N.isLink=false;e._mResolvedTiles[T.id]=N;y.groups[G.identification.id].payload.tiles.push(T);x.save().done(function(){s.resolve(T);}).fail(function(F){s.reject(F);});}).fail(function(F){s.reject("Bookmark creation failed because: "+F);});}).fail(function(y){s.reject(y);});}).promise();};this.countBookmarks=function(s){return this._visitBookmarks(s);};this.updateBookmarks=function(s,P){var e=sap.ushell.Container;var v=e.getService("URLParsing");var w=e.getService("CommonDataModel");var x=this._mResolvedTiles;function y(T){return new jQuery.Deferred(function(z){var I,N;var B;var E=false;var F={};if(P.url||P.url===""){I=v.parseShellHash(P.url);if(!I){N=k(P.url);}else{N=l(I);}}if(T.icon!==P.icon){F.icon=P.icon;E=true;}if(T.title!==P.title){F.title=P.title;E=true;}if(T.subTitle!==P.subtitle){F.subtitle=P.subtitle;E=true;}if(P.url&&s!==P.url){F.targetURL=P.url;E=true;}if(T.info!==P.info){F.info=P.info;E=true;}h(T,P,N);if(E&&x[T.id]){B=x[T.id].tileComponent;if(B){B.tileSetVisualProperties(F);}}z.resolve(T);}).promise();}return this._visitBookmarks(s,y).then(function(z){return w.save().then(function(){return z;});});};this.deleteBookmarks=function(s){var e=sap.ushell.Container;var v=e.getService("URLParsing");var w=e.getService("CommonDataModel");var I=v.parseShellHash(s);var x;if(I){x=l(I);}else{x=k(s);}return w.getSite().then(function(y){var G=y.groups;var z=Object.keys(G).map(function(K){var P=G[K].payload;var B=0;P.tiles=P.tiles.filter(function(T){if(T.isBookmark&&i(x,T.target)){++B;return false;}return true;});return B;}).reduce(function(B,E){B+=E;return B;},0);return w.save().then(function(){return z;});});};this.onCatalogTileAdded=function(T){};this._onTileSettingsSave=function(T,s){var e=new jQuery.Deferred(),v,w,N,x,y,O,z,B;if(T&&T.id&&s){N=s.oTitleInput.getValue();y=s.oSubTitleInput.getValue();x=s.oInfoInput.getValue();O=this.getTileTitle(T);z=this.getTileInfo(T);B=this.getTileSubtitle(T);if(O===N&&B===y&&z===x){return undefined;}v=sap.ushell.Container.getService("CommonDataModel");var E=this;v.getSite().done(function(F){if(!F.modifiedTiles){F.modifiedTiles={};}if(!F.modifiedTiles[T.id]){F.modifiedTiles[T.id]={id:T.id};}w={};if(O!==N){w.title=N;F.modifiedTiles[T.id].title=N;T.title=N;}if(B!==y){w.subtitle=y;F.modifiedTiles[T.id].subTitle=y;T.subTitle=y;}if(z!==x){w.info=x;F.modifiedTiles[T.id].info=x;T.info=x;}if(E._mResolvedTiles[T.id].tileComponent){E._mResolvedTiles[T.id].tileComponent.tileSetVisualProperties(w);}else if(E._mResolvedTiles[T.id].linkTileControl){if(w.title){E._mResolvedTiles[T.id].linkTileControl.setHeader(w.title);}if(w.subtitle){E._mResolvedTiles[T.id].linkTileControl.setSubheader(w.subtitle);}if((w.title)||(w.subtitle)){E._mResolvedTiles[T.id].linkTileControl.rerender();}}v.save().fail(function(G){jQuery.sap.log.error(G);e.reject("Could not save personalization changes: "+G);}).done(function(){e.resolve();});}).fail(function(F){jQuery.sap.log.error(F);e.reject("Cannot get site: "+F);});}return e.promise();};this.getTileActions=function(T){var e=[],s,v;if(this._isGroupTile(T)&&!this._isFailedGroupTile(T)){v=new sap.ui.model.json.JSONModel({config:{"display_title_text":this.getTileTitle(T),"display_subtitle_text":this.getTileSubtitle(T),"display_info_text":this.getTileInfo(T)}});s=sap.ushell.components.tiles.utilsRT.getTileSettingsAction(v,this._onTileSettingsSave.bind(this,T),this.getTileType(T));e.push(s);}return e;};function d(P,T){var e=f(P,T);e.isBookmark=true;return e;}function f(P,T){var e={id:u.generateUniqueId([])};h(e,P,T);return e;}function h(T,P,e){P=jQuery.extend(true,{},P);if(e){T.target=e;}if(P.title||P.title===""){T.title=P.title;}if(P.icon||P.icon===""){T.icon=P.icon;}if(P.subtitle||P.subtitle===""){T.subTitle=P.subtitle;}if(P.info||P.info===""){T.info=P.info;}if(P.dataSource){T.dataSource={};jQuery.extend(true,T.dataSource,P.dataSource);delete P.serviceUrl;}else if(P.dataSource===null){delete T.dataSource;delete T.indicatorDataSource;delete P.serviceUrl;}if((P.dataSource||T.dataSource)&&P.serviceUrlPath){T.indicatorDataSource={path:P.serviceUrlPath};}if(P.serviceUrl||P.serviceUrl===""){if(T.dataSource){jQuery.sap.log.warning("`serviceUrl` is marked for deprecation in the future."+"It is not the preferred means for defining a dynamic "+"tile's data source. Please use `oParameter.dataSource`");delete T.dataSource;}T.indicatorDataSource={path:P.serviceUrl};}else if(P.serviceUrl===null&&!T.dataSource){delete T.indicatorDataSource;}if(P.serviceRefreshInterval||P.serviceRefreshInterval===0){T.indicatorDataSource.refresh=P.serviceRefreshInterval;}}function i(T,O){if(T&&O){if(T.url){return T.url===O.url;}return T.semanticObject===O.semanticObject&&T.action===O.action&&j(T.parameters,O.parameters);}return T===O;}function j(P,O){var F,s;P=P||[];O=O||[];if(P.length===O.length){F=t(P);s=t(O);return F===s;}return false;}function t(e){return e.map(function(P){return P.name+P.value;}).sort().join();}function k(s){return{url:s};}function l(I){var T={semanticObject:I.semanticObject,action:I.action,parameters:q(I.params)};if(I.appSpecificRoute){T.appSpecificRoute=I.appSpecificRoute;}return T;}function q(I){return Object.keys(I).map(function(K){var v=I[K]&&I[K][0];return{name:K,value:v||""};});}this._getSiteData=function(){return sap.ushell.Container.getService("CommonDataModel").getSite();};this._addDefaultGroup=function(G,s){var e=r.getDefaultGroup(G);if(!e){e=m.createDefaultGroup(u.generateUniqueId(r.getGroupIdsFromSite(s)));s=m.addGroupToSite(s,e,0);G=r.getGroupsArrayFromSite(s);}this._oDefaultGroup=e;return G;};}L.prototype=Object.create(A.prototype);return L;},true);
