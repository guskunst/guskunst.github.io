// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ui/Device","sap/ushell/utils","sap/ushell/library","sap/m/MessagePopover","sap/ui/core/Component","sap/ui/core/ComponentContainer","sap/ui/core/Control","sap/ui/thirdparty/URI","sap/ushell/EventHub","sap/ushell/components/container/PostMessageAPI"],function(D,u,a,M,C,b,c,U,E,P){"use strict";var p="sap.ushell.components.container.",s=p+"ApplicationContainer",d="sap.ushell.Container.dirtyState.",l,S,r;function f(T){var e=sap.ushell.Container.getService("CrossApplicationNavigation");e.isUrlSupported(T.url).done(function(){T.promise.resolve({"allowed":true,"id":T.id});}).fail(function(){T.promise.resolve({"allowed":false,"id":T.id});});}function i(e){var N={"asyncURLHandler":L.prototype._adaptIsUrlSupportedResultForMessagePopover};if(M&&M.setDefaultHandlers){M.setDefaultHandlers(N);}E.emit("StepDone",e.stepName);}E.once("initMessagePopover").do(i);l=new u.Map();function g(e){return l.get(e.getId());}function h(){return S;}function j(e){var N=jQuery.sap.getUriParameters(e).mParams,O=N["sap-xapp-state"],R;delete N["sap-xapp-state"];R={startupParameters:N};if(O){R["sap-xapp-state"]=O;}return R;}function k(e,N){if(!r){r=jQuery.sap.resources({url:jQuery.sap.getModulePath(p)+"/resources/resources.properties",language:sap.ui.getCore().getConfiguration().getLanguage()});}return r.getText(e,N);}function m(){return new sap.ui.core.Icon({size:"2rem",src:"sap-icon://error",tooltip:L.prototype._getTranslatedText("an_error_has_occured")});}function n(e){var N=e.getAggregation("child"),O;if(N instanceof b){O=N.getComponentInstance().getMetadata().getName().replace(/\.Component$/,"");jQuery.sap.log.debug("unloading component "+O,null,s);}e.destroyAggregation("child");}function o(e,N,O){var Q,R,T,V,W,X,Y,Z={},$,_;T=N.indexOf("?");if(T>=0){X=L.prototype._getParameterMap(N);Z=X.startupParameters;N=N.slice(0,T);}if(N.slice(-1)!=='/'){N+='/';}if(/\.view\.(\w+)$/i.test(O)){W=/^SAPUI5=(?:([^\/]+)\/)?([^\/]+)\.view\.(\w+)$/i.exec(O);if(!W){jQuery.sap.log.error("Invalid SAPUI5 URL",O,s);return L.prototype._createErrorControl();}Y=W[1];$=W[2];_=W[3].toUpperCase();if(Y){$=Y+"."+$;}else{V=$.lastIndexOf(".");if(V<1){jQuery.sap.log.error("Missing namespace",O,s);return L.prototype._createErrorControl();}Y=$.slice(0,V);}}else{Y=O.replace(/^SAPUI5=/,"");}jQuery.sap.registerModulePath(Y,N+Y.replace(/\./g,'/'));L.prototype._destroyChild(e);if($){if(e.getApplicationConfiguration()){Z.config=e.getApplicationConfiguration();}R=sap.ui.view({id:e.getId()+"-content",type:_,viewData:Z||{},viewName:$});e.fireEvent("applicationConfiguration");}else{jQuery.sap.log.debug("loading component "+Y,null,s);var a1=X?{startupParameters:X.startupParameters}:{startupParameters:{}};if(X&&X["sap-xapp-state"]){a1["sap-xapp-state"]=X["sap-xapp-state"];}if(e.getApplicationConfiguration()){a1.config=e.getApplicationConfiguration();}Q=sap.ui.component({id:e.getId()+"-component",componentData:a1,name:Y});e.fireEvent("applicationConfiguration",{"configuration":Q.getMetadata().getConfig()});R=new b({id:e.getId()+"-content",component:Q});}R.setWidth(e.getWidth());R.setHeight(e.getHeight());R.addStyleClass("sapUShellApplicationContainer");e.setAggregation("child",R,true);return R;}function q(e,N){setTimeout(function(){sap.ui.getCore().getEventBus().publish("sap.ushell",e,N);},0);}function t(e,N,O){var Q,R,T,V,W={startupParameters:{}},X,Y=e.getComponentHandle(),Z=sap.ushell.Container.getService("PluginManager"),$,_;u.addTime("createUi5Component");Q=N.indexOf("?");if(Q>=0){V=L.prototype._getParameterMap(N);W={startupParameters:V.startupParameters};if(V["sap-xapp-state"]){W["sap-xapp-state"]=V["sap-xapp-state"];}N=N.slice(0,Q);}if(e.getApplicationConfiguration()){W.config=e.getApplicationConfiguration();}if(N.slice(-1)!=='/'){N+='/';}L.prototype._destroyChild(e);X={id:e.getId()+"-component",name:O,componentData:W};jQuery.sap.log.debug("Creating component instance for "+O,JSON.stringify(X),s);sap.ui.getCore().getEventBus().publish("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",{name:O});if(Y){R=Y.getInstance(X);}else{jQuery.sap.registerModulePath(O,N);jQuery.sap.log.error("No component handle available for '"+O+"'; fallback to component.load()",null,s);R=sap.ui.component({id:e.getId()+"-component",name:O,componentData:W});}e.fireEvent("applicationConfiguration",{"configuration":R.getMetadata().getConfig()});T=new b({id:e.getId()+"-content",component:R});T.setHeight(e.getHeight());T.setWidth(e.getWidth());T.addStyleClass("sapUShellApplicationContainer");e._disableRouterEventHandler=L.prototype._disableRouter.bind(this,R);sap.ui.getCore().getEventBus().subscribe("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",e._disableRouterEventHandler);e.setAggregation("child",T,true);if(Z){$=Z.getPluginLoadingPromise("RendererExtensions");_=$&&$.state();if(_==="pending"){$.done(function(){L.prototype._publishExternalEvent("appComponentLoaded",{component:R});}).fail(function(){L.prototype._publishExternalEvent("appComponentLoaded",{component:R});});}if(_==="resolved"||_==="rejected"){L.prototype._publishExternalEvent("appComponentLoaded",{component:R});}}else{L.prototype._publishExternalEvent("appComponentLoaded",{component:R});}return T;}function v(e){var N;if((e instanceof C)&&(typeof e.getRouter==="function")){N=e.getRouter();if(N&&(typeof N.stop==="function")){jQuery.sap.log.info("router stopped for instance "+e.getId());N.stop();}}}function w(e){var N=document.createElement("a"),O=jQuery.sap.getUriParameters(e).get("sap-client"),Q;N.href=e;Q=N.protocol+"//"+N.host;return new sap.ushell.System({alias:O?Q+"?sap-client="+O:Q,baseUrl:Q,client:O||undefined,platform:"abap"});}function x(e,N){var T=false,O=e.getDomRef(),Q,R;if(O){Q=U(O.src||window.location&&window.location.href||'');R=Q.protocol()+"://"+Q.host();T=(N.source===O.contentWindow)||(N.origin===R);}return T;}function y(e,N,O){var R=JSON.stringify({type:"request",service:N,request_id:jQuery.sap.uid(),body:{}});jQuery.sap.log.debug("Sending post message request to origin ' "+O+"': "+R,null,"sap.ushell.components.container.ApplicationContainer");e.postMessage(R,O);}function z(){var e=this.getDomRef();if(!e||e.tagName!=="IFRAME"){return null;}return e;}function A(N,O,Q){var R=jQuery.sap.getObject("sap-ushell-config.services.PostMessage.config",0),T=Q&&Q.service,V,W,X,Y,Z=false;jQuery.sap.log.debug("Received post message request from origin '"+O.origin+"': "+JSON.stringify(Q),null,"sap.ushell.components.container.ApplicationContainer");if(Q.type!=="request"||!T){return;}for(var $ in S){if(S.hasOwnProperty($)){if(T.indexOf($)!==-1){W=S[$];X=$;Z=true;break;}}}if(Z===false){return;}V=T.split(".")[3];if(R&&R.enabled===false){jQuery.sap.log.warning("Received message for "+V+", but this "+"feature is disabled. It can be enabled via launchpad configuration "+"property 'services.PostMessage.config.enabled: true'",undefined,"sap.ushell.components.container.ApplicationContainer");return;}if(!L.prototype._isTrustedPostMessageSource(N,O)){jQuery.sap.log.warning("Received message from untrusted origin '"+O.origin+"': "+JSON.stringify(O.data),null,"sap.ushell.components.container.ApplicationContainer");return;}function _(e,g1){var h1=JSON.stringify({type:"response",service:Q.service,request_id:Q.request_id,status:e,body:g1});jQuery.sap.log.debug("Sending post message response to origin ' "+O.origin+"': "+h1,null,"sap.ushell.components.container.ApplicationContainer");if(typeof O.source!=="object"||O.source===null){jQuery.sap.log.debug("Cannot send response message to origin ' "+O.origin,"`source` member of request message is not an object","sap.ushell.components.container.ApplicationContainer");return;}O.source.postMessage(h1,O.origin);}function a1(O,Q){var e=new jQuery.Deferred(),g1;if(Q.body&&Q.body.callbackMessage&&Q.body.callbackMessage.service){g1=L.prototype._backButtonPressedCallback.bind(null,O.source,Q.body.callbackMessage.service,O.origin);}e.resolve(N.getShellUIService().setBackNavigation(g1));return e.promise();}function b1(g1,h1){var i1,j1,k1,l1=[g1.id];if(arguments.length>1){l1.unshift(h1);}try{k1=JSON.stringify(g1);}catch(e){jQuery.sap.log.error("Cannot stringify and store expanded system data: "+e);}if(k1){j1=u.getLocalStorage();i1=u.generateLocalStorageKey("sap-system-data",l1);j1.setItem(i1,k1);}}function c1(){var e=sap.ushell.Container.getLogonSystem();var g1=e.getName();var h1=e.getClient();return"sid("+g1+"."+h1+")";}function d1(e){return c1().toLowerCase()===e.toLowerCase();}var e1={matchesLocalSid:d1,getLocalSystemInSidForma:c1,storeSapSystemData:b1,executeSetBackNavigationService:a1,sendResponseMessage:_,oMessage:O,oMessageData:Q,oContainer:N};try{Y=W.oServiceCalls[Q.service.replace(X+".","")];if(Y&&Y.executeServiceCallFn){Y.executeServiceCallFn(e1).done(function(e){_("success",{result:e});}).fail(function(e){_("error",{message:e});});}else{_("error",{message:"Unknown service name: '"+Q.service+"'"});}}catch(f1){_("error",{message:f1.message});}}function B(N,O){var Q=N.getUi5ComponentName&&N.getUi5ComponentName(),R=O.data;if(typeof R==="string"){try{R=JSON.parse(O.data);}catch(e){jQuery.sap.log.debug("Message received from origin '"+O.origin+"' cannot be parsed: "+e,R,"sap.ushell.components.container.ApplicationContainer");return;}}if(typeof Q==="string"){jQuery.sap.log.debug("Skipping handling of postMessage 'message' event with data '"+JSON.stringify(R)+"' on container of UI5 application '"+Q+"'","Only non UI5 application containers can handle 'message' postMessage event","sap.ushell.components.container.ApplicationContainer");return;}if(!N.getActive()){jQuery.sap.log.debug("Skipping handling of postMessage 'message' event with data '"+JSON.stringify(R)+"' on inactive container '"+N.getId()+"'","Only active containers can handle 'message' postMessage event","sap.ushell.components.container.ApplicationContainer");return;}if(R.action==="pro54_setGlobalDirty"&&localStorage.getItem(N.globalDirtyStorageKey)===sap.ushell.Container.DirtyState.PENDING){if(!L.prototype._isTrustedPostMessageSource(N,O)){jQuery.sap.log.warning("Received message from untrusted origin: "+O.origin,R,"sap.ushell.components.container.ApplicationContainer");return;}jQuery.sap.log.debug("getGlobalDirty() pro54_setGlobalDirty SetItem key:"+N.globalDirtyStorageKey+" value: "+R.parameters.globalDirty,null,"sap.ushell.components.container.ApplicationContainer");u.localStorageSetItem(N.globalDirtyStorageKey,R.parameters.globalDirty,true);}else{L.prototype._handleServiceMessageEvent(N,O,R);}}function F(e,N){var O=e._getIFrame(),Q=e.getApplicationType();if(u.isApplicationTypeEmbeddedInIframe(e.getApplicationType(Q))&&O){O.contentWindow.postMessage(JSON.stringify({action:"pro54_disableDirtyHandler"}),"*");N.preventDefault();}}function G(R,e,N){R.write("<div").writeControlData(e).writeAccessibilityState(e).addClass("sapUShellApplicationContainer").writeClasses(e).addStyle("height",e.getHeight()).addStyle("width",e.getWidth()).writeStyles().write(">").renderControl(N);R.write("</div>");}function H(e,N,T,R){var O,Q=function(){var Y=u.getParameterValueBoolean("sap-accessibility");if(Y!==undefined){return Y;}return sap.ushell.Container.getUser().getAccessibilityMode();},V=function(){var Y=false,Z=jQuery.sap.getUriParameters(e)||{mParams:{}};Y=sap.ui.getCore().getConfiguration().getStatistics()&&!Z.mParams.hasOwnProperty("sap-statistics");return Y;},W=function(){var Y=window.hasher&&window.hasher.getHash(),X="",Z;if(Y&&Y.length>0&&Y.indexOf("sap-iapp-state=")>0){Z=/(?:sap-iapp-state=)([^&/]+)/.exec(Y);if(Z&&Z.length===2){X=Z[1];}}return X;};e+=e.indexOf("?")>=0?"&":"?";e+="sap-ie=edge";O=sap.ushell.Container.getUser().getTheme(sap.ushell.User.prototype.constants.themeFormat.NWBC);if(O){e+=e.indexOf("?")>=0?"&":"?";e+="sap-theme="+encodeURIComponent(O);}if(T){e+=e.indexOf("?")>=0?"&":"?";e+="sap-target-navmode="+encodeURIComponent(T);}if(Q()){e+=e.indexOf("?")>=0?"&":"?";e+="sap-accessibility=X";}if(V()){e+=e.indexOf("?")>=0?"&":"?";e+="sap-statistics=true";}if(R){e+=e.indexOf("?")>=0?"&":"?";e+="sap-keepclientsession=1";}var X=W();if(X&&X.length>0){e+=e.indexOf("?")>=0?"&":"?";e+="sap-iapp-state="+X;}return u.appendSapShellParam(e,N);}function I(R,e,N,O){var Q=e.getAggregation("child");if(!Q||e._bRecreateChild){Q=L.prototype._createUi5Component(e,N,O);e._bRecreateChild=false;}L.prototype._renderControlInDiv(R,e,Q);}function J(e,N,V){var O=e.getProperty(N);if(jQuery.sap.equal(O,V)){return;}e.setProperty(N,V);e._bRecreateChild=true;}function K(R,e,N,O,Q){var T;localStorage.removeItem(e.globalDirtyStorageKey);if(Q&&Q.indexOf("SAPUI5.Component=")===0&&N===sap.ushell.components.container.ApplicationType.URL){I(R,e,O,Q.replace(/^SAPUI5\.Component=/,""));return;}if(Q&&Q.indexOf("SAPUI5=")===0&&N===sap.ushell.components.container.ApplicationType.URL){L.prototype._renderControlInDiv(R,e,L.prototype._createUi5View(e,O,Q));return;}jQuery.sap.log.debug("Not resolved as \"SAPUI5.Component=\" or \"SAPUI5=\" , "+"will attempt to load into iframe "+Q);if(!e.getActive()){jQuery.sap.log.debug("Skipping rendering container iframe","Container '"+e.getId()+"' is inactive");return;}try{O=e.getFrameSource(N,O,Q);}catch(V){jQuery.sap.log.error(V.message||V,null,s);e.fireEvent("applicationConfiguration");R.renderControl(L.prototype._createErrorControl());return;}if(sap.ushell.Container){T=L.prototype._getLogoutHandler(e);if(!T){if(u.isApplicationTypeEmbeddedInIframe(N)){T=L.prototype._logout.bind(null,e);l.put(e.getId(),T);sap.ushell.Container.attachLogoutEvent(T);sap.ushell.Container.addRemoteSystem(L.prototype._createSystemForUrl(O));}}else if(!u.isApplicationTypeEmbeddedInIframe(N)){sap.ushell.Container.detachLogoutEvent(T);l.remove(e.getId());}}if(u.isApplicationTypeEmbeddedInIframe(N)){var W=e.getTargetNavigationMode();O=L.prototype._adjustNwbcUrl(O,N,W,e.getIsStateful());u.localStorageSetItem(e.globalDirtyStorageKey,sap.ushell.Container.DirtyState.INITIAL);}if(jQuery.sap.getUriParameters().get("sap-isolation-enabled")==="true"){var X=O.indexOf("#");if(X>=0){var Y=O.substr(0,X);O=Y+"#"+window.hasher.getHash();}else{O+="#"+window.hasher.getHash();}}e.fireEvent("applicationConfiguration");R.write("<iframe").writeControlData(e).writeAccessibilityState(e).writeAttributeEscaped("src",O).addClass("sapUShellApplicationContainer").writeClasses(e).addStyle("height",e.getHeight()).addStyle("width",e.getWidth()).writeStyles().write("></iframe>");}var L=c.extend(s,{metadata:{properties:{additionalInformation:{defaultValue:"",type:"string"},application:{type:"object"},applicationConfiguration:{type:"object"},applicationType:{defaultValue:"URL",type:p+"ApplicationType"},height:{defaultValue:"100%",type:"sap.ui.core.CSSSize"},navigationMode:{defaultValue:"",type:"string"},targetNavigationMode:{defaultValue:"",type:"string"},text:{defaultValue:"",type:"string"},url:{defaultValue:"",type:"string"},visible:{defaultValue:true,type:"boolean"},active:{defaultValue:true,type:"boolean"},"sap-system":{defaultValue:undefined,type:"string"},applicationDependencies:{type:"object"},componentHandle:{type:"object"},ui5ComponentName:{type:"string"},width:{defaultValue:"100%",type:"sap.ui.core.CSSSize"},shellUIService:{type:"object"},appIsolationService:{type:"object"},reservedParameters:{type:"object"},coreResourcesFullyLoaded:{type:"boolean"},isStateful:{defaultValue:false,type:"boolean"},iframeHandlers:{defaultValue:"",type:"string"}},events:{"applicationConfiguration":{}},aggregations:{child:{multiple:false,type:"sap.ui.core.Control",visibility:"hidden"}},library:"sap.ushell",designtime:"sap/ushell/designtime/ApplicationContainer.designtime"},exit:function(){var e,N=this;if(sap.ushell.Container){e=L.prototype._getLogoutHandler(N);if(e){sap.ushell.Container.detachLogoutEvent(e);l.remove(N.getId());}}localStorage.removeItem(N.globalDirtyStorageKey);if(N._unloadEventListener){removeEventListener("unload",N._unloadEventListener);}if(N._disableRouterEventHandler){sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",N._disableRouterEventHandler);}if(N._storageEventListener){removeEventListener("storage",N._storageEventListener);}if(N._messageEventListener){removeEventListener("message",N._messageEventListener);}L.prototype._destroyChild(N);if(c.exit){c.exit.apply(N);}},assignCommunicationHandlers:function(e){S=e;},init:function(){var e=this;e.globalDirtyStorageKey=d+jQuery.sap.uid();this.assignCommunicationHandlers(P.getAPIs());e._unloadEventListener=e.exit.bind(e);addEventListener("unload",e._unloadEventListener);e._storageEventListener=function(N){var O=e.getApplicationType();if(N.key===e.globalDirtyStorageKey&&N.newValue===sap.ushell.Container.DirtyState.PENDING&&u.isApplicationTypeEmbeddedInIframe(O)){var Q=e._getIFrame();if(Q){jQuery.sap.log.debug("getGlobalDirty() send pro54_getGlobalDirty ",null,"sap.ushell.components.container.ApplicationContainer");Q.contentWindow.postMessage(JSON.stringify({action:"pro54_getGlobalDirty"}),'*');}}};addEventListener('storage',e._storageEventListener);e._messageEventListener=L.prototype._handleMessageEvent.bind(null,e);addEventListener('message',e._messageEventListener);},onAfterRendering:function(e){if(this.getIsStateful()){this.rerender=function(){};}if(D.os.ios&&this.$().prop("tagName")==="IFRAME"){this.$().parent().css("overflow","auto");}},renderer:function(R,e){var N=e.getApplication(),O=e.launchpadData,Q;if(!e.getVisible()){L.prototype._renderControlInDiv(R,e);return;}if(e.error){delete e.error;L.prototype._renderControlInDiv(R,e,L.prototype._createErrorControl());}else if(!N){L.prototype._render(R,e,e.getApplicationType(),e.getUrl(),e.getAdditionalInformation());}else if(!N.isResolvable()){L.prototype._render(R,e,N.getType(),N.getUrl(),"");}else if(O){L.prototype._render(R,e,O.applicationType,O.Absolute.url.replace(/\?$/,""),O.applicationData);}else{jQuery.sap.log.debug("Resolving "+N.getUrl(),null,s);N.resolve(function(T){jQuery.sap.log.debug("Resolved "+N.getUrl(),JSON.stringify(T),s);e.launchpadData=T;L.prototype._destroyChild(e);},function(T){var V=N.getMenu().getDefaultErrorHandler();if(V){V(T);}L.prototype._destroyChild(e);e.error=T;});Q=new sap.m.Text({text:L.prototype._getTranslatedText("loading",[N.getText()])});L.prototype._destroyChild(e);e.setAggregation("child",Q);L.prototype._renderControlInDiv(R,e,Q);}}});L.prototype.getFrameSource=function(e,N,O){if(!Object.prototype.hasOwnProperty.call(sap.ushell.components.container.ApplicationType,e)){throw new Error("Illegal application type: "+e);}return N;};L.prototype.setUrl=function(V){J(this,"url",V);};L.prototype.setAdditionalInformation=function(V){J(this,"additionalInformation",V);};L.prototype.setApplicationType=function(V){J(this,"applicationType",V);};L.prototype.createPostMessageRequest=function(e,N){var R=Date.now().toString();return{"type":"request","request_id":R,"service":e,"body":N};};L.prototype.setNewTRApplicationContext=function(e){var N=this._getIFrame();if(!N){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}e=u.appendSapShellParam(e);var R=this.createPostMessageRequest("sap.its.startService",{"url":e});return this.postMessageToIframe(R,N,true).catch(function(O){return Promise.reject({eventData:O,message:"Failed to change application context."});});};L.prototype.postMessageToIframe=function(N,O,W){var Q=this;var R=N.request_id;return new Promise(function(T,V){function X(Z){var $;try{$=JSON.parse(Z.data);if(R!==$.request_id){return;}if("success"===$.status){T($);}else{V($);}window.removeEventListener("message",X);}catch(e){T();jQuery.sap.log.warning("Obtained bad response from framework in response to message "+N.request_id);jQuery.sap.log.debug("Underlying framework returned invalid response data: '"+Z.data+"'");}}var Y=JSON.stringify(N);jQuery.sap.log.debug("Sending postMessage "+Y+" to application container '"+Q.getId()+"'");if(W){window.addEventListener("message",X,false);O.contentWindow.postMessage(Y,"*");}else{O.contentWindow.postMessage(Y,"*");T();}});};L.prototype.postMessageToCurrentIframe=function(e,W){if(W===undefined){W=false;}var N=this._getIFrame();if(!N){if(W){return Promise.reject({message:"Expected opened iframe not found."});}else{return;}}return this.postMessageToIframe(e,N,W);};L.prototype.setNewApplicationContext=function(e,N){var O=this;var Q=this["setNew"+e+"ApplicationContext"];if(!Q){return Promise.reject({message:"Unsupported application type"});}var R=this._getIFrame();if(!R){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}var T=this.createPostMessageRequest("sap.gui.triggerCloseSessionImmediately",{});return this.postMessageToIframe(T,R,true).then(function(){return Q.call(O,N);},function(V){return Promise.reject({eventData:V,message:"Failed to change application context."});});};L.prototype.onApplicationOpened=function(N){var e=this.getIsStateful();if(!e){return Promise.resolve();}var O=this.getApplicationType();if(O==="TR"&&N!=="TR"){var Q=this._getIFrame();if(!Q){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}var R=this.createPostMessageRequest("sap.gui.triggerCloseSession",{});return this.postMessageToIframe(R,Q,false).catch(function(T){return Promise.reject({eventData:T,message:"Failed to change application context."});});}return Promise.resolve();};L.prototype.postMessageRequest=function(e){var N=this._getIFrame();if(!N){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}var R=this.createPostMessageRequest(e,{});return this.postMessageToIframe(R,N,false).catch(function(O){return Promise.reject({eventData:O,message:"Failed to post message."});});};L.prototype._getCommunicationHandlers=h;L.prototype._adaptIsUrlSupportedResultForMessagePopover=f;L.prototype._getLogoutHandler=g;L.prototype._getParameterMap=j;L.prototype._getTranslatedText=k;L.prototype._createErrorControl=m;L.prototype._destroyChild=n;L.prototype._createUi5View=o;L.prototype._publishExternalEvent=q;L.prototype._createUi5Component=t;L.prototype._disableRouter=v;L.prototype._createSystemForUrl=w;L.prototype._isTrustedPostMessageSource=x;L.prototype._handleServiceMessageEvent=A;L.prototype._handleMessageEvent=B;L.prototype._logout=F;L.prototype._renderControlInDiv=G;L.prototype._adjustNwbcUrl=H;L.prototype._render=K;L.prototype._backButtonPressedCallback=y;L.prototype._getIFrame=z;return L;},true);
