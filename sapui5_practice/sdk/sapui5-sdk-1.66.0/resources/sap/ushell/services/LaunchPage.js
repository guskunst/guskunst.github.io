// Copyright (c) 2009-2017 SAP SE, All Rights Reserved
sap.ui.define(["sap/ushell/services/ContentExtensionAdapterFactory"],function(C){"use strict";function L(a,c){var t=this,T=[],A=C.getAdapters();this.oAdapters={"default":a};A.then(function(o){jQuery.extend(this.oAdapters,o);}.bind(this));this.getGroups=function(){var d=new jQuery.Deferred();A.then(function(){var g=Object.keys(t.oAdapters).map(function(s){return t._getAdapter(s).getGroups();});jQuery.when.apply(jQuery,g).done(function(){var b=[].concat.apply([],arguments);d.resolve(b);}).fail(function(){jQuery.sap.log.error("getGroups failed");});});return d.promise();};this.getGroupsForBookmarks=function(){var d=jQuery.Deferred();Promise.all([this.getGroups(),this.getDefaultGroup()]).then(function(r){var g=r[0],D=r[1];if(g.length>0){g=g.filter(function(b){return(!t.isGroupLocked(b)&&t.isGroupVisible(b));}).map(function(b){return{title:(b===D&&sap.ushell.resources.i18n.getText("my_group"))||t.getGroupTitle(b),object:b};});}d.resolve(g);}).catch(function(e){jQuery.sap.log.error("getGroupsForBookmarks failed: "+e.message);});return d.promise();};this.getDefaultGroup=function(){var p=this._getAdapter().getDefaultGroup();p.fail(function(){jQuery.sap.log.error("getDefaultGroup failed");});return p;};this.getGroupTitle=function(g){return this._getAdapter(g.contentProvider).getGroupTitle(g);};this.getGroupId=function(g){return this._getAdapter(g.contentProvider).getGroupId(g);};this.getGroupTiles=function(g){return this._getAdapter(g.contentProvider).getGroupTiles(g);};this.getLinkTiles=function(g){return this._getAdapter(g.contentProvider).getLinkTiles(g);};this.addGroupAt=function(s,i){var p,b=i,a=this._getAdapter();if(a.addGroupAt){p=a.addGroupAt(s,i);p.fail(function(){jQuery.sap.log.error("addGroup "+s+" failed");});}else{var d=new jQuery.Deferred();p=a.addGroup(s);p.done(function(n,g){var m=this.moveGroup(n,b),e=n;m.done(function(){d.resolve(e);});m.fail(function(){d.reject();});}.bind(this));p.fail(function(){jQuery.sap.log.error("addGroup "+s+" failed");d.reject();});return d.promise();}return p;};this.addGroup=function(s){var p=this._getAdapter().addGroup(s);p.fail(function(){jQuery.sap.log.error("addGroup "+s+" failed");});return p;};this.removeGroup=function(g,i){var p=this._getAdapter(g.contentProvider).removeGroup(g,i);p.fail(function(){jQuery.sap.log.error("Fail to removeGroup "+t.getGroupTitle(g));});return p;};this.resetGroup=function(g,i){var p=this._getAdapter(g.contentProvider).resetGroup(g,i);p.fail(function(){jQuery.sap.log.error("Fail to resetGroup "+t.getGroupTitle(g));});return p;};this.isGroupRemovable=function(g){return this._getAdapter(g.contentProvider).isGroupRemovable(g);};this.isGroupLocked=function(g){var a=this._getAdapter(g.contentProvider);if(typeof a.isGroupLocked==="function"){return a.isGroupLocked(g);}return false;};this.isGroupFeatured=function(g){var a=this._getAdapter(g.contentProvider);if(typeof a.isGroupFeatured==="function"){return a.isGroupFeatured(g);}return false;};this.moveGroup=function(g,n){var p=this._getAdapter(g.contentProvider).moveGroup(g,n);p.fail(function(){jQuery.sap.log.error("Fail to moveGroup "+t.getGroupTitle(g));});return p;};this.setGroupTitle=function(g,s){var p=this._getAdapter(g.contentProvider).setGroupTitle(g,s);p.fail(function(){jQuery.sap.log.error("Fail to set Group title: "+t.getGroupTitle(g));});return p;};this.hideGroups=function(h){var d=new jQuery.Deferred(),a=this._getAdapter();if(typeof a.hideGroups!=="function"){d.reject('hideGroups() is not implemented in the Adapter.');}else{a.hideGroups(h).done(function(){d.resolve();}).fail(function(m){jQuery.sap.log.error("Fail to store groups visibility."+m);d.reject();});}return d.promise();};this.isGroupVisible=function(g){var a=this._getAdapter(g.contentProvider);if(typeof a.isGroupVisible==="function"){return a.isGroupVisible(g);}return true;};this.addTile=function(o,g){var p=this._getAdapter(g.contentProvider).addTile(o,g);p.fail(function(){jQuery.sap.log.error("Fail to add Tile: "+t.getCatalogTileId(o));});return p;};this.removeTile=function(g,o,i){var p=this._getAdapter(g.contentProvider).removeTile(g,o,i);p.fail(function(){jQuery.sap.log.error("Fail to remove Tile: "+t.getTileId(o));});return p;};this.moveTile=function(o,s,i,S,b,n){var p=this._getAdapter().moveTile(o,s,i,S,b,n);p.fail(function(){jQuery.sap.log.error("Fail to move Tile: "+t.getTileId(o));});return p;};this.isLinkPersonalizationSupported=function(o){var s=o&&o.contentProvider;var a=this._getAdapter(s);if(typeof a.isLinkPersonalizationSupported==="function"){return a.isLinkPersonalizationSupported(o);}return false;};this.getTileId=function(o){var s=o&&o.contentProvider;return this._getAdapter(s).getTileId(o);};this.getTileTitle=function(o){var s=o&&o.contentProvider;return this._getAdapter(s).getTileTitle(o);};this.getTileType=function(o){var s=o&&o.contentProvider,a=this._getAdapter(s);if(a.getTileType){return a.getTileType(o);}return'tile';};this.getTileView=function(o){var s=o&&o.contentProvider;var d=this._getAdapter(s).getTileView(o);if(!jQuery.isFunction(d.promise)){d=new jQuery.Deferred().resolve(d).promise();}return d;};this.getCardManifest=function(g){var s=g&&g.contentProvider;return this._getAdapter(s).getCardManifest(g);};this.getAppBoxPressHandler=function(o){var s=o&&o.contentProvider,a=this._getAdapter(s);if(a.getAppBoxPressHandler){return a.getAppBoxPressHandler(o);}return undefined;};this.getTileSize=function(o){var s=o&&o.contentProvider;return this._getAdapter(s).getTileSize(o);};this.getTileTarget=function(o){var s=o&&o.contentProvider;return this._getAdapter(s).getTileTarget(o);};this.getTileDebugInfo=function(o){var s=o&&o.contentProvider,a=this._getAdapter(s);if(typeof a.getTileDebugInfo==="function"){return a.getTileDebugInfo(o);}return undefined;};this.isTileIntentSupported=function(o){var s=o&&o.contentProvider,a=this._getAdapter(s);if(typeof a.isTileIntentSupported==="function"){return a.isTileIntentSupported(o);}return true;};this.refreshTile=function(o){var s=o&&o.contentProvider;this._getAdapter(s).refreshTile(o);};this.setTileVisible=function(o,n){var s=o&&o.contentProvider;return this._getAdapter(s).setTileVisible(o,n);};this.registerTileActionsProvider=function(p){if(typeof p!=='function'){throw new Error("Tile actions Provider is not a function");}T.push(p);};this.getTileActions=function(o){var b=[],d,s=o&&o.contentProvider,a=this._getAdapter(s);if(typeof a.getTileActions==='function'){d=a.getTileActions(o);if(d&&d.length&&d.length>0){b.push.apply(b,d);}}for(var i=0;i<T.length;i++){d=T[i](o);if(d&&d.length&&d.length>0){b.push.apply(b,d);}}return b;};this.getCatalogs=function(){return this._getAdapter().getCatalogs();};this.isCatalogsValid=function(){return this._getAdapter().isCatalogsValid();};this.getCatalogData=function(o){var l=this._getAdapter();if(typeof l.getCatalogData!=="function"){jQuery.sap.log.warning("getCatalogData not implemented in adapter",null,"sap.ushell.services.LaunchPage");return{id:this.getCatalogId(o)};}return l.getCatalogData(o);};this.getCatalogError=function(o){return this._getAdapter().getCatalogError(o);};this.getCatalogId=function(o){return this._getAdapter().getCatalogId(o);};this.getCatalogTitle=function(o){return this._getAdapter().getCatalogTitle(o);};this.getCatalogTiles=function(o){var p=this._getAdapter().getCatalogTiles(o);p.fail(function(){jQuery.sap.log.error("Fail to get Tiles of Catalog: "+t.getCatalogTitle(o));});return p;};this.getCatalogTileId=function(o){return this._getAdapter(o.contentProvider).getCatalogTileId(o);};this.getCatalogTileTitle=function(o){var s=o&&o.contentProvider;return this._getAdapter(s).getCatalogTileTitle(o);};this.getCatalogTileSize=function(o){var s=o&&o.contentProvider;return this._getAdapter(s).getCatalogTileSize(o);};this.getCatalogTileViewControl=function(o){var s=o&&o.contentProvider;var l=this._getAdapter(s);if(typeof l.getCatalogTileViewControl==="function"){return l.getCatalogTileViewControl(o);}else{var d=new jQuery.Deferred(),r=this.getCatalogTileView(o);d.resolve(r);return d.promise();}};this.getCatalogTileView=function(o){var s=o&&o.contentProvider;return this._getAdapter(s).getCatalogTileView(o);};this.getCatalogTileTargetURL=function(o){var s=o&&o.contentProvider;return this._getAdapter(s).getCatalogTileTargetURL(o);};this.getCatalogTileTags=function(o){var s=o&&o.contentProvider;var l=this._getAdapter(s);if(typeof l.getCatalogTileTags==="function"){return l.getCatalogTileTags(o);}return[];};this.getCatalogTileKeywords=function(o){var s=o&&o.contentProvider;return this._getAdapter(s).getCatalogTileKeywords(o);};this.getCatalogTilePreviewTitle=function(o){var s=o&&o.contentProvider;return this._getAdapter(s).getCatalogTilePreviewTitle(o);};this.getCatalogTilePreviewSubtitle=function(o){var s=o&&o.contentProvider;var l=this._getAdapter(s);if(l.getCatalogTilePreviewSubtitle){return l.getCatalogTilePreviewSubtitle(o);}};this.getCatalogTilePreviewIcon=function(o){var s=o&&o.contentProvider;return this._getAdapter(s).getCatalogTilePreviewIcon(o);};this.addBookmark=function(p,g){var P,d,m,s;if(!p.title){jQuery.sap.log.error("Add Bookmark - Missing title");throw new Error("Title missing in bookmark configuration");}if(!p.url){jQuery.sap.log.error("Add Bookmark - Missing URL");throw new Error("URL missing in bookmark configuration");}if(g&&this.isGroupLocked(g)){d=new jQuery.Deferred();P=d.promise();m='Tile cannot be added, target group ('+this.getGroupTitle(g)+')is locked!';d.reject(m);jQuery.sap.log.error(m);}else{s=g&&g.contentProvider;P=this._getAdapter(s).addBookmark(p,g);P.fail(function(){jQuery.sap.log.error("Fail to add bookmark for URL: "+p.url+" and Title: "+p.title);});}return P;};this.countBookmarks=function(u){if(!u||typeof u!=="string"){jQuery.sap.log.error("Fail to count bookmarks. No valid URL");throw new Error("Missing URL");}var p=this._getAdapter().countBookmarks(u);p.fail(function(){jQuery.sap.log.error("Fail to count bookmarks");});return p;};this.deleteBookmarks=function(u){if(!u||typeof u!=="string"){throw new Error("Missing URL");}var p=this._getAdapter().deleteBookmarks(u);p.fail(function(){jQuery.sap.log.error("Fail to delete bookmark for: "+u);});return p;};this.updateBookmarks=function(u,p){if(!u||typeof u!=="string"){jQuery.sap.log.error("Fail to update bookmark. No valid URL");throw new Error("Missing URL");}if(!p||typeof p!=="object"){jQuery.sap.log.error("Fail to update bookmark. No valid parameters, URL is: "+u);throw new Error("Missing parameters");}var P=this._getAdapter().updateBookmarks(u,p);P.fail(function(){jQuery.sap.log.error("Fail to update bookmark for: "+u);});return P;};this.onCatalogTileAdded=function(s){return this._getAdapter().onCatalogTileAdded(s);};}L.prototype._getAdapter=function(a){return this.oAdapters[a]||this.oAdapters["default"];};L.hasNoAdapter=false;return L;},true);
