sap.ui.define(["jquery.sap.global","sap/ui/core/CustomizingConfiguration","sap/ui/core/library","sap/ui/core/Component","sap/ui/core/UIComponent","sap/ui/model/json/JSONModel","sap/ui/model/resource/ResourceModel","sap/ui/Device","sap/suite/ui/generic/template/lib/reuseComponentHelper","sap/ui/core/CustomData","sap/suite/ui/generic/template/lib/StableIdDefinition","sap/suite/ui/generic/template/js/StableIdHelper","sap/base/Log","sap/suite/ui/generic/template/js/AnnotationHelper","sap/ushell/Config"],function(q,C,c,a,U,J,R,D,r,b,S,d,L,A,e){"use strict";var V=c.mvc.ViewType;var s=e.last("/core/shell");var E=true;if(s.enableFiori3===false){E=s.enableFiori3;}function g(O){var i=O&&typeof O==="string"?O:(O&&a.getOwnerIdFor(O));var w=i&&sap.ui.component(i);if(w instanceof T){w=w.getAppComponent();}return w;}var G=C.getViewExtension;C.getViewExtension=function(i,w,O){var x=g(O),y=x&&x.getId(),z=G.call(C,i,w,y);return z;};var f=C.getControllerExtension;C.getControllerExtension=function(i,O){var w=g(O),x=w&&w.getId(),y=f.call(C,i,x);return y;};function h(w){var I=new R({bundleName:"sap/suite/ui/generic/template/lib/i18n/i18n"});var x=[];var M=w.getAppComponent().getModel("i18n|"+w.getMetadata().getComponentName()+"|"+w.getEntitySet());if(M){x.push(M);}var y=w.getModel("i18n");if(y){x.push(y);}var z=w.getModel("@i18n");if(z){x.push(z);}var B=true;for(var F="i18n";B;){F=F+"||Parent";B=w.getModel(F);if(B){x.push(B);}}for(var i=x.length-1;i>=0;i--){I.enhance(x[i].getResourceBundle());}w.setModel(I,"i18n");}function j(i,M){var w=i.getAppComponent().getManifestEntry("sap.ui5");var x=w.extends&&w.extends.extensions&&w.extends.extensions["sap.ui.controllerExtensions"];var y=i.getTemplateName();var z=x&&x[y]&&x[y]["sap.ui.generic.app"];var B=i.getEntitySet();var F=z&&z[B]&&z[B].Actions;var H={};var I=k(i);if(F){if(I){l(H,F,I);}else{m(H,F);}}else{var K=z&&z[B]&&z[B]["Sections"];for(var N in K){F=K[N]["Actions"];if(F){m(H,F);}}}i.getModel("_templPriv").setProperty("/generic/listCommons/breakoutActionsEnabled",H);}function k(i){var w;var x=i.getAppComponent().getConfig();var y=x&&x.pages[0]&&x.pages[0].component&&x.pages[0].component.settings;if(y&&y.quickVariantSelectionX){w=y.quickVariantSelectionX.variants;}return w;}function l(B,w,x){var y;for(var z in w){y=true;if(w[z].requiresSelection){y=false;}for(var i in x){var F=w[z].id;var H=x[i];var I=A.getSuffixFromIconTabFilterKey(H);if(I){F=F.concat(I);}B[F]={enabled:y};}}}function m(B,i){var w;for(var x in i){w=true;if(i[x].requiresSelection){w=false;}B[i[x].id]={enabled:w};}}function n(i){if(i.getAppComponent().getMetadata().getComponentName()===""||i.getTemplateName()===""||i.getEntitySet()===""){}return i.getAppComponent().getMetadata().getComponentName()+"::"+i.getTemplateName()+"::"+i.getEntitySet();}function o(i,w,M,x){var y=w.oComponent;var z=y.getAppComponent();var B=w.oTemplateContract.mRoutingTree[w.route];var F=y.getEntitySet();var H=w.utils.isDraftEnabled();var I=null;var K=y.getComponentContainer().getSettings();I=q.extend({},K);delete I.appComponent;delete I.entitySet;delete I.navigationProperty;I.subPages=w.routeConfig.pages;I.routeConfig=w.routeConfig;return new J({entitySet:F,entityType:i,treeNode:B,routingSpec:w.routingSpec,"sap-ui-debug":window["sap-ui-debug"],isDraftEnabled:H,settings:I,manifest:z.getInternalManifest(),metaModel:M,templateSpecific:x&&x(),appComponentName:y.getAppComponent().getMetadata().getComponentName(),stableId:{definition:S,aParameter:[],getStableId:d.getStableId},isFiori3Enabled:E});}function p(i,w){var x=i.oComponent,y=i.createViewController,z=i.methods&&i.methods.getTemplateSpecificParameters,M=x.getModel(),B,F,H,I,K,N=i.routingSpec&&i.routingSpec.noOData;if(N){B=new J({entitySet:{},entityType:{}});I=B.createBindingContext("/entitySet");K=B.createBindingContext("/entityType");}else{B=M&&M.getMetaModel();F=M&&x.getEntitySet();var O=F&&B.getODataEntitySet(F);H=O&&O.entityType;if(!H){return{loaded:function(){return Promise.reject(new Error("Unknown entityset "+F));}};}I=B.createBindingContext(B.getODataEntitySet(F,true));K=B.createBindingContext(B.getODataEntityType(H,true));}h(x);j(x,M);var Q=n(x);var W=sap.ui.getCore().byId(Q);if(W){L.warning("View with ID: "+Q+" already exists - old view is getting destroyed now!");try{W.destroy();}catch(X){L.warning("Error destroying view: "+X);}W=null;}var Y=new J(D);Y.setDefaultBindingMode("OneWay");i.oParameterModel=o(H,i,B,z);x.runAsOwner(function(){var Z=i.preprocessorsData;var $={async:true,preprocessors:{xml:{bindingContexts:{entitySet:I,entityType:K},models:{device:Y,entitySet:B,entityType:B,parameter:i.oParameterModel},preprocessorsData:Z}},id:Q,type:V.XML,viewName:x.getTemplateName(),height:"100%",cache:{keys:w,additionalData:[Z]}};if(x.getDesigntimePath||x.getFlexibilityPath){var _={key:"sap-ui-custom-settings",value:{}};if(x.getDesigntimePath){_.value["sap.ui.dt"]={"designtime":x.getDesigntimePath()};}if(x.getFlexibilityPath){_.value["sap.ui.fl"]={"flexibility":x.getFlexibilityPath()};}$.customData=[new b(_)];}$.controller=y();W=sap.ui.view($);});return W;}function t(i,w,x){var y=i.oController.extensionAPI;var z=q.extend({},y);if(y.getNavigationController){var N=q.extend({},y.getNavigationController());var B=N.navigateInternal;N.navigateInternal=function(F,H){var I=H&&H.routeName;if(I){i.utils.navigateRoute(I,F,w,H&&H.replaceInHistory);}else{B(F,H);}};z.getNavigationController=function(){return N;};}z.getCommunicationObject=function(F){return F===1?x.communicationObject:i.utils.getCommunicationObject(F);};(i.methods.enhanceExtensionAPI4Reuse||q.noop)(z,x);return z;}function P(i,w,x,y,z){y.extensionAPI=t(i,x,y);r.transferEmbeddedComponentProxy(i,w,x,y,z);var B=i.oController.byId(y.containerId);var F=B&&B.getSettings();var H=z.getMetadata().getAllProperties();for(var I in F){if((I==="uiMode"||I==="semanticObject"||I.startsWith("st"))&&!H[I]){delete F[I];}}z.applySettings(F);B.setComponent(z);}function u(i,w,x){return x.componentUsage?i.createComponent({usage:x.componentUsage,id:w}):i.runAsOwner(function(){return a.create({name:x.componentName,id:w});});}function v(i){i.reuseComponentsReady=new Promise(function(w,x){var y=Object.create(null);var z=w.bind(null,y);if(i.viewLevel>0){var B=i.oTemplateContract.mEntityTree[i.routeConfig.entitySet];if(B){var F=function(H,I){L.error("Failed to load reuse component for key "+H,I instanceof Error?I.message:"","sap.suite.ui.generic.template.lib.TemplateComponent");};i.viewRegistered.then(function(){var H=[];for(var I in B.embeddedComponents){var K=B.embeddedComponents[I];var M=K.sectionId&&i.oController.byId(K.sectionId);if(M&&M.getStashed()){delete B.embeddedComponents[I];}else{var N=i.oController.createId(K.containerId+"Content");var O=u(i.oAppComponent,N,K);H.push(O);O.catch(F.bind(null,I));O.then(P.bind(null,i,y,I,K));i.oTemplateContract.oBusyHelper.setBusy(O);}}Promise.all(H).then(z,function(Q){var W=i.oAppComponent.getNavigationController();W.navigateToMessagePage({text:i.oTemplateContract.getText("ST_ERROR"),description:Q instanceof Error?Q.message:""});x();});});return;}}z();});}var T=U.extend("sap.suite.ui.generic.template.lib.TemplateComponent",{metadata:{properties:{templateName:{type:"string",defaultValue:null},entitySet:{type:"string",defaultValue:null},navigationProperty:{type:"string",defaultValue:null},appComponent:{type:"object",defaultValue:null},isRefreshRequired:{type:"boolean",defaultValue:false},isLeaf:{type:"boolean"}},library:"sap.suite.ui.generic.template"},init:function(){(U.prototype.init||q.noop).apply(this);var i=new J({editable:false,enabled:false,bEnableFiori3:E});this.setModel(i,"ui");var w=this.getComponentData();var x=w.registryEntry;var y=Object.create(null);var z=(x.routeConfig&&x.routeConfig.embeddedComponents)||{};for(var K in z){var B=z[K];var F={hidden:!!B.hiddenByDefault};y[K]=F;}var H=new J({generic:{isActive:false,listCommons:{},viewLevel:x.viewLevel,controlProperties:{},supportedIntents:{},embeddedComponents:y}});H.setDefaultBindingMode("TwoWay");this.setModel(H,"_templPriv");v(x);},getManifestEntry:function(K){var i=U.prototype.getManifestEntry.apply(this,arguments);if(/^\/sap\.ui5\/componentUsages(\/.+)?$/.test(K)){i=q.extend(true,{},i,U.prototype.getManifestEntry.apply(this.getAppComponent(),arguments));}return i;},getComponentContainer:function(){return this.oContainer;},onBeforeRendering:function(w){if(w){var x=w.oComponent.getComponentContainer();var M=!w.createViewStarted&&x&&x.getModel();if(M){M.getMetaModel().loaded().then(function(){if(!w.createViewStarted){var y=[];var z=M.metadataLoaded().then(function(i){var F;if(i&&i.lastModified){F=new Date(i.lastModified).getTime()+"";}else{L.error("TemplateComponent: no valid cache key segment last modification date provided by the OData Model");F=new Date().getTime()+"";}return F;});y.push(z);var B=M.annotationsLoaded().then(function(F){var H=0;if(F){for(var i=0;i<F.length;i++){if(F[i].lastModified){var I=new Date(F[i].lastModified).getTime();if(I>H){H=I;}}else{L.error("TemplateComponent: no valid cache key segment last modification date provided by OData annotations");H=new Date().getTime()+"";}}}if(H===0){L.error("TemplateComponent: no valid cache key segment last modification date provided by OData annotations");H=new Date().getTime();}return H+"";});y.push(B);w.createViewStarted=true;p(w,y).loaded().then(function(i){w.oComponent.setAggregation("rootControl",i);w.fnViewRegisteredResolve();x.invalidate();},function(i){w.fnViewRegisteredResolve(i||{});});}});}}},getRouter:function(){if(this.getAppComponent()){return this.getAppComponent().getRouter();}return U.prototype.getRouter.apply(this,arguments);}});return T;});
