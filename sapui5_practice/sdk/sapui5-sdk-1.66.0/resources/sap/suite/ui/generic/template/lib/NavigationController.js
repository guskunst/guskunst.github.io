/*
 * ! SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["jquery.sap.global","sap/ui/base/Object","sap/ui/core/ComponentContainer","sap/ui/core/routing/HashChanger","sap/ui/core/routing/History","sap/ui/core/library","sap/suite/ui/generic/template/lib/ProcessObserver","sap/suite/ui/generic/template/lib/routingHelper","sap/suite/ui/generic/template/lib/TemplateComponent","sap/suite/ui/generic/template/lib/testableHelper","sap/ui/fl/ControlPersonalizationAPI","sap/base/Log"],function(q,B,C,H,a,c,P,r,T,t,b,L){"use strict";var d=c.routing.HistoryDirection;var h=a.getInstance();function f(R){var e=R.substring(R.length-5,R.length);if(e==="query"){return R.substring(0,R.length-5);}return R;}function n(s){if(s.indexOf("/")===0){return s;}return"/"+s;}function A(e){var D="";var R="";var p=Object.keys(e).sort();p.forEach(function(s){var v=e[s];if(q.isArray(v)){var V=v.sort();for(var i=0;i<V.length;i++){var j=V[i];R=R+D+s+"="+j;D="&";}}else{R=R+D+s+"="+v;}});return R;}function g(p,s){p=p||"";var D=(p.charAt(p.length-1)==="/")?"?":"/?";return p+(s?D+s:"");}function k(p,e){var s=A(e);return g(p,s);}function l(i,R,j){var p=i.mRoutingTree[R.name];var s=R.template;var E=R.entitySet;var v=p.level;var O=-1;if(i.oFlexibleColumnLayoutHandler){O=v<3?v:0;}var u=O<0?i.oNavigationObserver:i.aNavigationObservers[O];var w=new P();var x=O<0?i.oHeaderLoadingObserver:i.aHeaderLoadingObservers[O];x.addObserver(w);var y={};var S={appComponent:i.oAppComponent,isLeaf:!R.pages||!R.pages.length,entitySet:E,navigationProperty:R.navigationProperty,componentData:{registryEntry:{oAppComponent:i.oAppComponent,componentCreateResolve:j,route:R.name,routeConfig:R,viewLevel:p.level,routingSpec:R.routingSpec,oNavigationObserver:u,oHeaderLoadingObserver:w,preprocessorsData:y}}};if(R.component.settings){q.extend(S,R.component.settings);}var z;i.oAppComponent.runAsOwner(function(){try{var D=sap.ui.core.Component.create({name:s,settings:S,handleValidation:true,manifest:true});var F;z=new C({propagateModel:true,width:"100%",height:"100%",settings:S});F=D.then(function(G){z.setComponent(G);var p=i.mRoutingTree[R.name];p.componentId=G.getId();return z;});z.loaded=function(){return F;};}catch(e){throw new Error("Component "+s+" could not be loaded");}});return z;}function m(e,p){t.testable(l,"fnCreateComponentInstance");var M={};var s={iHashChangeCount:0,backTarget:0,aCurrentKeys:[],componentsDisplayed:Object.create(null)};var u=[];var v=Promise.resolve();var w=[];var x=[];function G(){var i=p.oRouter,j=i.getTargets()._mTargets,P1=[];Object.keys(j).forEach(function(Q1){var R1=j[Q1],S1=R1._oOptions,T1=i.getRoute(S1.viewName),U1=T1&&T1._oConfig;if(U1&&(!U1.navigation||!U1.navigation.display)){P1.push({oConfig:U1});}});return P1;}t.testable(G,"fnGetAllPages");function y(i){var j=i||G();if(!Array.isArray(j)){j=[j];}j.forEach(function(P1){P1.oComponentContainer=l(e,P1.oConfig,function(){});});return j;}t.testable(y,"fnCreatePages");function z(){var i=p.oRouter.getViews();i.getView({viewName:"root"});return e.mRouteToTemplateComponentPromise.root;}function D(){return p.oAppComponent.getManifestEntry("sap.app").title;}function E(i,j,P1){var Q1=i&&e.componentRegistry[i];var R1=Q1&&Q1.methods.getUrlParameterInfo;return R1?Q1.viewRegistered.then(function(){var S1=j&&n(j);return R1(S1,s.componentsDisplayed[Q1.route]===1).then(function(T1){q.extend(P1,T1);});}):Promise.resolve();}function F(i,j,P1){var Q1=e.mRoutingTree[i];return E(Q1.componentId,P1,j);}function I(j){for(var i=0;i<j.length;i++){if(j[i].title!==w[j.length-i-1]||""){j[i].subtitle=w[j.length-i-1]||"";}}x=j;e.oShellServicePromise.then(function(P1){P1.setHierarchy(j);});}function S(i,j){w[i]=j;var P1=x[x.length-i-1];if(P1){if(P1.title!==j){P1.subtitle=j;}e.oShellServicePromise.then(function(Q1){Q1.setHierarchy(x);});}}var J;function K(){if(!(J instanceof T)){I([]);return;}var j=J.getEntitySet();var P1=p.oTemplateContract.mEntityTree[j];if(!P1||P1.componentId!==J.getId()){I([]);return;}var Q1=e.oFlexibleColumnLayoutHandler&&P1.level<3&&!e.oTemplatePrivateGlobalModel.getProperty("/generic/FCL/isVisuallyFullScreen");var R1=e.oApplicationProxy.getLinkToUpperLayersInfo(true,Q1,j);Promise.all(R1.aInfoObjectPromises).then(function(S1){var T1=[];var U1=location.hash;var V1=U1.indexOf("?");var W1=(V1!==-1&&V1<U1.indexOf("&"))?"?":"&";var X1=U1.split(W1)[0]+"&/";for(var i=S1.length-1;i>=0;i--){var Y1=S1[i];var Z1={intent:X1+Y1.fullLink};T1.push(Z1);if(i===0){Z1.title=D();}else{var P1=p.oTemplateContract.mEntityTree[Y1.entitySet];Z1.title=P1.headerTitle;Z1.icon=P1.titleIconUrl;}}I(T1);});}function O(i,j){var P1;if(!i&&j instanceof T){var Q1=j&&e.componentRegistry[j.getId()];var R1=Q1&&Q1.methods.getTitle;P1=R1&&R1();}else if(!i&&j&&j.title){P1=j.title;}P1=P1||D();J=j;e.oShellServicePromise.then(function(S1){S1.setTitle(P1);K();});}function Q(i){var j=[e.oPagesDataLoadedObserver.getProcessFinished(true)];var P1=null;var Q1=s.iHashChangeCount;var R1=-1;for(var S1 in e.componentRegistry){var T1=e.componentRegistry[S1];var U1=T1.oControllerUtils&&T1.oControllerUtils.oServices.oTemplateCapabilities.oMessageButtonHelper;var V1=s.componentsDisplayed[T1.route]===1;var W1=T1.utils.getTemplatePrivateModel();W1.setProperty("/generic/isActive",V1);if(V1){j.push(T1.oViewRenderedPromise);if(T1.viewLevel>R1){R1=T1.viewLevel;P1=T1.oComponent;}}else{T1.utils.suspendBinding();}if(U1){U1.setEnabled(V1);}}var X1=e.oFlexibleColumnLayoutHandler&&e.oFlexibleColumnLayoutHandler.isAppTitlePrefered();O(X1,i||P1);Promise.all(j).then(function(){if(Q1===s.iHashChangeCount&&q.isEmptyObject(M)){e.oAppComponent.firePageDataLoaded();}});}var R=Q.bind(null,null);function U(i,j){var P1=[];for(var Q1=i;Q1.level>=j;Q1=e.mRoutingTree[Q1.parentRoute]){P1.push(Q1);}return P1.reverse();}function V(j,P1,Q1){if(j.level===0){return null;}var R1=Q1?j.pattern:j.contextPath;if(!R1){return null;}if(R1.indexOf("/")!==0){R1="/"+R1;}for(var i=1;i<P1.length;i++){R1=R1.replace("{keys"+i+"}",P1[i]);}return R1;}var W;var X;t.testable(function(i){X=i;u.push(s);s={backTarget:0};},"setCurrentIdentity");function Y(){return X;}function Z(j,P1){if(q.isArray(j)&&j.length<2){j=j[0];}if(q.isArray(P1)&&P1.length<2){P1=P1[0];}if(q.isArray(j)){if(q.isArray(P1)){if(j.length===P1.length){j=j.sort();P1=P1.sort();return j.every(function(Q1,i){return Q1===P1[i];});}return false;}return false;}return P1===j;}function $(i){if(!X||X.treeNode!==i.treeNode){return false;}for(var j=i.treeNode;j.level>0;j=e.mRoutingTree[j.parentRoute]){if(!j.noKey&&i.keys[j.level]!==X.keys[j.level]){return false;}}if(q.isEmptyObject(i.appStates)!==q.isEmptyObject(X.appStates)){return false;}if(q.isEmptyObject(i.appStates)){return true;}var P1=q.extend(Object.create(null),i.appStates,X.appStates);for(var Q1 in P1){if(!Z(i.appStates[Q1],X.appStates[Q1])){return false;}}return true;}function _(i){var j=Object.create(null);for(var P1=W.identity.treeNode;P1.level>0;P1=e.mRoutingTree[P1.parentRoute]){if(!P1.noKey){j["keys"+P1.level]=W.identity.keys[P1.level];}}var Q1=!q.isEmptyObject(W.identity.appStates);var R1=W.identity.treeNode.sRouteName+(Q1?"query":"");if(Q1){j["query"]=W.identity.appStates;}p.oRouter.navTo(R1,j,i);}function a1(i){var j;if(i){if(W||(X&&X.preset)){W={identity:i.identity,followUpNeeded:true};return;}if(i.identity&&$(i.identity)){return;}j=i.mode;W=i;}else{j=1;}W.followUpNeeded=j<0;e.oBusyHelper.setBusyReason("HashChange",true);if(j<0){window.history.go(j);}else{_(j===1);}}function b1(i){var j=X;if(W&&W.identity&&!W.followUpNeeded){X=W.identity;X.previousIdentity=j;return;}X=Object.create(null);X.previousIdentity=j;var P1=i.getParameter("config");var Q1=f(P1.name);X.treeNode=e.mRoutingTree[Q1];var R1=i.getParameter("arguments");X.appStates=R1["?query"]||Object.create(null);X.keys=[""];for(var S1=X.treeNode;S1.level>0;S1=e.mRoutingTree[S1.parentRoute]){X.keys[S1.level]=S1.noKey?"":R1["keys"+S1.level];}}function c1(i,j){var P1={identity:{treeNode:X.treeNode,keys:X.keys,appStates:q.extend(Object.create(null),X.appStates)},mode:1};if(q.isArray(j)&&j.length<2){j=j[0];}if(j){P1.identity.appStates[i]=j;}else{delete P1.identity.appStates[i];}a1(P1);}function d1(i){var P1=r.determineNavigationPath(i);var Q1={identity:{keys:["",P1.key],appStates:Object.create(null)},mode:1};var R1=a1.bind(null,Q1);if(X.treeNode.level===1){Q1.identity.treeNode=X.treeNode;q.extend(Q1.identity.appStates,X.appStates);return Promise.resolve(R1);}var S1=U(X.treeNode,2);var T1=S1.map(function(j){var V1=V(j,X.keys);var W1=e.oApplicationProxy.getSiblingPromise(V1);return W1.then(function(i){return i;},q.noop);});var U1=Promise.all(T1);return U1.then(function(V1){var W1=e.mEntityTree[P1.entitySet];for(var j=0;V1[j];j++){W1=S1[j];P1=r.determineNavigationPath(V1[j],W1.navigationProperty);Q1.identity.keys.push(P1.key);}Q1.identity.treeNode=W1;if(W1===X.treeNode){q.extend(Q1.identity.appStates,X.appStates);return R1;}var X1=e.oFlexibleColumnLayoutHandler.getAppStatesPromiseForColumnClose(W1,Q1.identity.appStates);return X1.then(function(){return R1;});});}function e1(i,j){if((i&&i.treeNode)!==j.treeNode){return Promise.resolve(false);}if(e.oFlexibleColumnLayoutHandler&&!e.oFlexibleColumnLayoutHandler.areIdentitiesLayoutEquivalent(i,j)){return Promise.resolve(false);}var P1=true;var Q1=i.treeNode.sRouteName;for(var R1=i.treeNode;R1.level>0;R1=e.mRoutingTree[R1.parentRoute]){var S1=R1.noKey||i.keys[R1.level]===j.keys[R1.level];if(!S1&&R1.noOData){return Promise.resolve(false);}P1=P1&&S1;if(R1.noOData){Q1=R1.parentRoute;}}if(P1){return Promise.resolve(true);}var T1=e.mRoutingTree[Q1];var U1=i.keys.slice(0,T1.level+1);var V1=j.keys.slice(0,T1.level+1);var W1=V(T1,U1);var X1=V(T1,V1);return e.oApplicationProxy.areTwoKnownPathesIdentical(W1,X1,T1.level===1);}function f1(i,j){var P1=u[s.backTarget];var Q1=-1;if(i.treeNode.level===0||(e.oFlexibleColumnLayoutHandler&&i.treeNode.fCLLevel===0)){for(;P1.backTarget>0&&P1.identity.treeNode.level>i.treeNode.level;Q1--){P1=u[P1.backTarget];}}var R1=e1(P1.identity,i);var S1=R1.then(function(T1){var U1=T1?Q1:(0+!!j);var V1={identity:i,mode:U1};a1(V1);});e.oBusyHelper.setBusy(S1);}function g1(j,P1){var Q1={keys:[""]};if(j){var R1=r.determineNavigationPath(j,P1);Q1.treeNode=e.mEntityTree[R1.entitySet];for(var i=1;i<Q1.treeNode.level;i++){Q1.keys.push(X.keys[i]);}Q1.keys.push(R1.key);}else{Q1.treeNode=e.mRoutingTree["root"];}return Q1;}function h1(i){var j=g1(i);j.appStates=Object.create(null);var P1;if(j.treeNode===X.treeNode){q.extend(j.appStates,X.appStates);P1={identity:j,mode:1};a1(P1);return;}var Q1=j.treeNode.fCLLevel===0?E(j.treeNode.componentId,null,j.appStates):e.oFlexibleColumnLayoutHandler.getAppStatesPromiseForColumnClose(j.treeNode,j.appStates);e.oBusyHelper.setBusy(Q1.then(f1.bind(null,j,true)));}function i1(i){L.info("Navigate back");if(s.backTarget&&n(h.getPreviousHash()||"")!==n(s.hash)){e.oBusyHelper.setBusyReason("HashChange",true);}s.LeaveByBack=!s.forwardingInfo;if(s.LeaveByBack){s.backSteps=i;}window.history.go(-i);}function j1(j,P1,Q1,R1){var S1=e.oAppComponent.getConfig();var T1=S1&&S1.settings&&S1.settings.objectPageDynamicHeaderTitleWithVM;if(!T1){if(S1&&S1.settings&&S1.settings.objectPageHeaderType==="Dynamic"){T1=(S1&&S1.settings&&S1.settings.objectPageVariantManagement==="VendorLayer")?true:false;}}var U1;var V1=q.sap.getUriParameters();if(V1.mParams["sap-ui-layer"]){var W1=V1.mParams["sap-ui-layer"];for(var i=0;i<W1.length;i++){if(W1[i].toUpperCase()==="VENDOR"){U1=true;break;}}}j=n(j||"");L.info("Navigate to hash: "+j);if(j===s.hash){L.info("Navigation suppressed since hash is the current hash");return;}s.targetHash=j;if(s.backTarget&&n(h.getPreviousHash()||"")===j){i1(1);return;}if(s.oEvent){var X1=s.oEvent.getParameter("config").viewLevel;}if(T1&&U1){if(!R1){if(!e.oFlexibleColumnLayoutHandler){b.clearVariantParameterInURL();}else{if(X1>=Q1){if(Q1===1){b.clearVariantParameterInURL();}else if(Q1===2){var Y1;for(var Z1 in e.componentRegistry){if(e.componentRegistry[Z1].viewLevel===2){Y1=e.componentRegistry[Z1];break;}}var $1=Y1.oController.byId("template::ObjectPage::ObjectPageVariant");b.clearVariantParameterInURL($1);}}}}}e.oBusyHelper.setBusyReason("HashChange",true);s.LeaveByReplace=P1;if(P1){p.oHashChanger.replaceHash(j);}else{p.oHashChanger.setHash(j);}}function k1(i,j,P1,Q1,R1,S1){var T1=j.then(function(U1){i=g(i,U1);if(R1){s.backwardingInfo={count:R1.count,index:R1.index,targetHash:n(i)};i1(R1.count);}else{j1(i,Q1,P1,S1);}return i;});e.oBusyHelper.setBusy(T1);return T1;}function l1(i,j){var P1,Q1,R1,S1,T1,U1;P1=0;Q1=s.iHashChangeCount;R1=null;for(S1=s;S1.oEvent;P1++){T1=S1.oEvent.getParameter("config");U1=T1?T1.viewLevel:-1;if(U1===0||(i&&n(S1.hash).indexOf(j)!==0)){R1={count:P1,index:Q1,routeName:T1?T1.name:undefined};break;}if(S1.backTarget===0){if(i){R1={count:P1+1,index:Q1,routeName:undefined};}break;}Q1=S1.backTarget;S1=u[Q1];}return R1;}function m1(i,j,P1){if(P1===0){return l1();}var Q1=u[s.backTarget];return Q1&&Q1.hash&&n(Q1.hash.split("?")[0])===n(j)&&{count:1,index:s.backTarget};}function n1(i){if(X.treeNode.level===0){return;}var j={treeNode:e.mRoutingTree["root"],keys:[""],appStates:Object.create(null)};var P1=e.oFlexibleColumnLayoutHandler?e.oFlexibleColumnLayoutHandler.getAppStatesPromiseForColumnClose(j.treeNode,j.appStates):F("root",j.appStates);P1.then(f1.bind(null,j,i));e.oBusyHelper.setBusy(P1);}function o1(){var i,j;if(e.oFlexibleColumnLayoutHandler){var P1=s.oEvent;var Q1=P1.getParameter("config");var R1=Q1.name;var S1=e.mRoutingTree[f(R1)];while(S1.level>1){S1=e.mRoutingTree[f(S1.parentRoute)];}j=r.determinePath(S1,P1);}else{j=s.hash;}j=j.split("?")[0];i=l1(true,j);if(i.routeName==="root"&&e.oFlexibleColumnLayoutHandler){n1(true);}else{i1(i.count);}}function p1(i){var j=e.mEntityTree[i.entitySet].sRouteName;var P1=e.mRouteToTemplateComponentPromise[j];return[P1];}function q1(j,P1){var Q1=s.componentsDisplayed;var R1=function(T1){var U1=e.componentRegistry[T1.getId()];(U1.methods.presetDisplayMode||q.noop)(P1,Q1[U1.route]===1);};for(var i=0;i<j.length;i++){var S1=j[i];S1.then(R1);}}function r1(i){var j=i&&e.mEntityTree[i.entitySet];var P1=j?j.level:1;return P1;}function s1(j,P1){var Q1=e.oApplicationProxy.getHierarchySectionsFromCurrentHash();var R1=j;for(var i=P1-2;i>=0;i--){R1=Q1[i]+"/"+R1;}return"/"+R1;}function t1(i,j,P1,Q1,R1){var S1={};var T1=e.oFlexibleColumnLayoutHandler&&e.oFlexibleColumnLayoutHandler.getFCLAppStatesPromise(i,S1);var U1=F(i,S1,j);var V1=(T1?Promise.all([T1,U1]):U1).then(A.bind(null,S1));var W1=m1(Q1,j,P1);var X1=k1(j,V1,P1,Q1,W1,R1);e.oBusyHelper.setBusy(X1);return X1;}function u1(i,j,P1,Q1){var R1=s1(i,j);t1(P1,R1,j,Q1);}function v1(j,P1,Q1,R1,S1,T1){var U1;var V1,W1,X1;var Y1=[];if(typeof j==="string"){U1=j;var Z1=n(U1);if(Z1==="/"){V1=0;}else{X1=Z1.split("/");V1=X1.length-1;}switch(V1){case 0:W1="root";break;case 1:W1=X1[1].split("(")[0];break;default:W1="";var $1="";for(var i=0;i<V1;i++){var _1=X1[i+1];var a2=_1.indexOf("(");if(a2>0){_1=_1.substring(0,a2);}W1=W1+$1+_1;$1="/";}W1=W1.replace("---","/");}}else{var b2=r.determineNavigationPath(j,P1);V1=r1(b2);U1=b2.path;Y1=p1(b2);W1=e.mEntityTree[b2.entitySet].sRouteName;}if(P1){U1=s1(U1,V1);}q1(Y1,R1||0);if(S1){U1=k(U1,S1);j1(U1,Q1,V1,T1);return Promise.resolve(U1);}else{return t1(W1,U1,V1,Q1,T1);}}function w1(i,j,P1,Q1,R1){return v1(i,j,P1,Q1,undefined,R1);}function x1(i,j){s.componentsDisplayed[i]=j;var P1=e.mRoutingTree[i];var Q1=P1.componentId;if(Q1){var R1=e.componentRegistry[Q1];var S1=R1.utils.getTemplatePrivateModel();S1.setProperty("/generic/isActive",j===1);}}function y1(i){var j,P1,Q1,R1,S1,T1=null,U1,V1;if(i){j=i.entitySet;P1=i.text;T1=i.icon;V1=i.description;}if(j){U1=e.oAppComponent.getModel().getMetaModel();if(U1){Q1=U1.getODataEntitySet(j);R1=U1.getODataEntityType(Q1.entityType);S1=R1["com.sap.vocabularies.UI.v1.HeaderInfo"];}if(S1&&S1.TypeImageUrl&&S1.TypeImageUrl.String){T1=S1.TypeImageUrl.String;}}e.oShellServicePromise.then(function(Y1){if(Y1.setBackNavigation){Y1.setBackNavigation(undefined);}});e.oTemplatePrivateGlobalModel.setProperty("/generic/messagePage",{text:P1,icon:T1,description:V1});if(e.oFlexibleColumnLayoutHandler){e.oFlexibleColumnLayoutHandler.displayMessagePage(i,s.componentsDisplayed);}else{var W1=p.oRouter.getTargets();W1.display("messagePage");for(var X1 in s.componentsDisplayed){x1(X1,5);}}Q(i);}function z1(){if(!q.isEmptyObject(M)){var j=null;for(var i=0;!j;i++){j=M[i];}M={};y1(j);}}function A1(i){if(p.oTemplateContract.oFlexibleColumnLayoutHandler){i.viewLevel=i.viewLevel||0;M[i.viewLevel]=i;var j=Promise.all([v,p.oTemplateContract.oPagesDataLoadedObserver.getProcessFinished(true)]);j.then(z1);j.then(e.oBusyHelper.setBusyReason.bind(null,"HashChange",false));return;}y1(i);e.oBusyHelper.setBusyReason("HashChange",false);}function B1(){var i=[];for(var j in e.componentRegistry){var P1=e.componentRegistry[j];if(s.componentsDisplayed[P1.route]===1){i.push(j);}}return i;}function C1(){var i=[];for(var j in e.componentRegistry){i.push(j);}return i;}function D1(i){return X.keys.slice(0,i+1);}function E1(j){var P1="";var Q1=s.hash;var R1=Q1.split("/");var S1="";for(var i=0;i<=j;i++){P1=P1+S1+R1[i];S1="/";}return P1;}function F1(){return s;}function G1(i,P1){if(P1===0){return{name:"root",pattern:""};}var Q1=i.getParameter("config");var R1=Q1.viewLevel;if(R1<P1){return null;}var S1=e.mEntityTree;var T1=Q1.entitySet;var U1;for(var j=R1;j>=P1;j--){U1=S1[T1];T1=U1.parent;}return{name:U1.sRouteName,pattern:U1.pattern};}function H1(i,j,P1){var Q1=P1.getId();var R1=e.componentRegistry[Q1];var S1=R1.route;var T1=j.componentsDisplayed[S1];var U1=T1===1;s.componentsDisplayed[S1]=1;var V1=P1.onActivate(i,U1)||Promise.resolve();return Promise.all([V1,R1.viewRegistered]).then(function(){R1.aKeys=D1(R1.viewLevel);});}function I1(i,j,P1){return H1(i,j,P1).then(R);}function J1(i,j,P1){var Q1={};if(j||P1){var R1=i.getParameter("config").viewLevel;for(var S1=0;S1<R1;S1++){Q1[S1]=e.oPaginatorInfo[S1];}}e.oPaginatorInfo=Q1;}function K1(i){return e.oApplicationProxy.getAlternativeContextPromise(i);}function L1(i){b1(i);X.preset=true;if(e.oFlexibleColumnLayoutHandler){e.oFlexibleColumnLayoutHandler.handleBeforeRouteMatched(i,X);}}function M1(j){if(X&&X.preset){delete X.preset;}else{b1(j);}if(W&&W.followUpNeeded&&W.identity&&!$(W.identity)){a1();return;}e.oBusyHelper.setBusyReason("HashChange",false);var P1=j.getParameter("config").viewLevel;var Q1=n(p.oHashChanger.getHash()||"");L.info("Route matched with hash "+Q1);var R1;if(s.backwardingInfo){R1=s;R1.identity=X.previousIdentity;delete X.previousIdentity;u.push(R1);var S1=R1.iHashChangeCount+1;s={iHashChangeCount:S1,forwardingInfo:{bIsProgrammatic:true,bIsBack:true,iHashChangeCount:S1,targetHash:R1.backwardingInfo.targetHash,componentsDisplayed:R1.componentsDisplayed},backTarget:u[R1.backwardingInfo.index].backTarget,componentsDisplayed:Object.create(null)};}if(s.forwardingInfo&&s.forwardingInfo.targetHash&&s.forwardingInfo.targetHash!==Q1){s.hash=Q1;var T1=s.forwardingInfo.targetHash;delete s.forwardingInfo.targetHash;j1(T1,true);return;}var U1=j.getParameter("config");var V1=r.determinePath(X.treeNode,j);var W1=false;for(var i=0;i<e.aStateChangers.length;i++){var X1=e.aStateChangers[i];if(X1.isStateChange(j)){W1=true;}}if(W1){W=null;s.hash=Q1;K();if(e.oFlexibleColumnLayoutHandler){e.oFlexibleColumnLayoutHandler.handleRouteMatched(j,U1,V1);}return;}e.oTemplatePrivateGlobalModel.setProperty("/generic/routeLevel",P1);var Y1=s.forwardingInfo;delete s.forwardingInfo;if(!Y1){Y1={componentsDisplayed:s.componentsDisplayed};var Z1=s.iHashChangeCount;Y1.iHashChangeCount=Z1+1;var $1=h.getDirection();if(W){Y1.bIsProgrammatic=!!W.identity;Y1.bIsBack=W.mode<0;if(Y1.bIsBack){s.backSteps=0-W.mode;}Y1.bIsForward=!Y1.bIsBack&&($1===d.Forwards);s.LeaveByReplace=W.mode===1;}else{Y1.bIsProgrammatic=(Q1===s.targetHash);Y1.bIsBack=!!(s.LeaveByBack||(!Y1.bIsProgrammatic&&($1===d.Backwards)));Y1.bIsForward=!Y1.bIsBack&&($1===d.Forwards);s.LeaveByReplace=Y1.bIsProgrammatic&&s.LeaveByReplace;}s.LeaveByBack=Y1.bIsBack;R1=s;R1.identity=X.previousIdentity;delete X.previousIdentity;u.push(R1);s={iHashChangeCount:Y1.iHashChangeCount,componentsDisplayed:Object.create(null)};if(R1.LeaveByReplace){s.backTarget=R1.backTarget;}else if(Y1.bIsBack){var _1=R1.backTarget;for(var a2=R1.backSteps||1;a2>0;a2--){_1=u[_1].backTarget;}s.backTarget=_1;}else{s.backTarget=Z1;}}W=null;s.oEvent=j;s.hash=Q1;var b2=function(d2){var e2=j.getParameter("arguments");if(d2){var f2=e2["?query"];s.forwardingInfo=Y1;v1(d2.context,null,true,d2.iDisplayMode,f2||{});return;}I([]);J1(j,Y1.bIsProgrammatic,Y1.bIsBack);if(e.oFlexibleColumnLayoutHandler){v=e.oFlexibleColumnLayoutHandler.handleRouteMatched(j,U1,V1,Y1);}else{if(P1===0||Y1.bIsBack||!Y1.bIsProgrammatic){e.oApplicationProxy.setEditableNDC(false);}var g2=U1.target;var h2=e.mRouteToTemplateComponentPromise[g2];v=new Promise(function(i2,j2){h2.then(function(k2){I1(V1,Y1,k2).then(i2,j2);});});}e.oBusyHelper.setBusy(v);};if(Y1.bIsBack){var c2=P1<2?V1:r.determinePath(e.mRoutingTree[G1(j,1).name],j);e.oBusyHelper.setBusy(K1(c2).then(b2));}else{b2();}}function N1(i){i=q.extend({},i);e.oStatePreserversAvailablePromise.then(M1.bind(null,i),e.oBusyHelper.setBusyReason.bind(null,"HashChange",false));}function O1(){A1({title:e.getText("ST_ERROR"),text:e.getText("ST_GENERIC_UNKNOWN_NAVIGATION_TARGET"),description:""});}if(e.sRoutingType==="f"){p.oRouter.attachBeforeRouteMatched(L1);}p.oRouter.attachRouteMatched(N1);p.oRouter.attachBypassed(O1);p.removeQueryInRouteName=f;p.concatPathAndAppStates=k;p.navigate=j1;p.getAncestralRoute=G1;p.activateOneComponent=H1;p.afterActivation=R;p.addUrlParameterInfoForRoute=F;p.getApplicableStateForComponentAddedPromise=E;p.setVisibilityOfRoute=x1;p.getActiveComponents=B1;p.getAllComponents=C1;p.getRootComponentPromise=z;p.getActivationInfo=F1;p.getCurrentKeys=D1;p.getCurrentHash=E1;p.getAppTitle=D;p.subTitleForViewLevelChanged=S;p.navigateToSuffix=u1;p.navigateByExchangingQueryParam=c1;p.navigateBackToAncestorComponent=o1;p.getSwitchToSiblingPromise=d1;p.getCurrentIdentity=Y;p.navigateToIdentity=f1;p.navigateAfterActivation=h1;p.createComponentInstance=l;return{navigateToRoot:n1,navigateToContext:w1,navigateToMessagePage:A1,navigateBack:i1.bind(null,1)};}function o(e,i){var j={oAppComponent:i.oAppComponent,oRouter:i.oAppComponent.getRouter(),oTemplateContract:i,oHashChanger:H.getInstance(),mRouteToComponentResolve:{}};i.oNavigationControllerProxy=j;var F=new Promise(function(R){j.fnInitializationResolve=R;});i.oBusyHelper.setBusy(F);q.extend(e,m(i,j));q.extend(j,e);j.oRouter._oViews._getViewWithGlobalId=function(v){v.viewName=v.name||v.viewName;for(var p in i.componentRegistry){if(i.componentRegistry[p].route===v.viewName){return i.componentRegistry[p].oComponent.getComponentContainer();}}var R=j.oRouter.getRoute(v.viewName);var s;if(R&&R._oConfig){s=l(i,R._oConfig,j.mRouteToComponentResolve[v.viewName]);}else{s=sap.ui.view({viewName:v.viewName,type:v.type,height:"100%"});}if(v.viewName==="root"){i.rootContainer=s;}return s.loaded();};r.startupRouter(j);}var N=B.extend("sap.suite.ui.generic.template.lib.NavigationController",{metadata:{library:"sap.suite.ui.generic.template"},constructor:function(e){B.apply(this,arguments);t.testableStatic(o,"NavigationController")(this,e);}});N._sChanges="Changes";return N;});
