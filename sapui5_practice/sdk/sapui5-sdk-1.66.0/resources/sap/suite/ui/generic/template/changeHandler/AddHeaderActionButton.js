/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)

		(c) Copyright 2009-2015 SAP SE. All rights reserved
	
 */
sap.ui.define(["jquery.sap.global","sap/suite/ui/generic/template/changeHandler/util/ChangeHandlerUtils","sap/suite/ui/generic/template/changeHandler/util/AnnotationChangeUtilsV2"],function(q,U,A){"use strict";var a={};var I="com.sap.vocabularies.UI.v1.Identification";var D="com.sap.vocabularies.UI.v1.DataFieldForAction";var b="com.sap.vocabularies.UI.v1.Importance";var c="com.sap.vocabularies.UI.v1.ImportanceType/High";a.applyChange=function(C,o,p){var d=C.getDefinition();if(!d.transferred){var P=C.getContent().customChanges[0].parentElementId;var e=C.getContent().customChanges[0].oParentSelector;var f=p.modifier.bySelector(e);var n=C.getContent().newFunctionImport;var N="action::"+n.replace("/","::");var s=P.substring(0,P.lastIndexOf("--"));N=s+N;var g=new sap.m.Button(N,{text:'New Action'});g.addCustomData(new sap.ui.core.CustomData({"key":"Action","value":n}));if(P.indexOf("objectPageHeader")>-1||P.indexOf("--template::ObjectPage::ObjectPageHeader")>-1){f.insertAction(g,C.getContent().customChanges[0].targetIndex);}else{f=f.getHeaderTitle();f.insertAction(g,C.getContent().customChanges[0].targetIndex);}}};a.revertChange=function(C,o,p){};a.completeChangeContent=function(C,s,p){var S=p.modifier.bySelector(s.selector.id,p.appComponent);var P=S.getParent();var o=p.modifier.getSelector(P.getId(),p.appComponent);var d=U.getComponent(S);var e=U.getODataEntityType(d);var E=e.entityType;var f=e[I];var g=f.slice();var B=[];if(S.getParent().getId().indexOf("--objectPageHeader")>-1||S.getParent().getId().indexOf("--template::ObjectPage::ObjectPageHeader")>-1){B=S.getParent().getActions();}else{B=S.getActions();}var h=-1,j=-1,k=-1,r=-1;B.some(function(u,i){if(u.getId&&u.getId()===s.selector.id){h=i;}if(u.getId&&u.getId().indexOf("--edit")>0){j=i;}if(u.getId&&u.getId().indexOf("--delete")>0){k=i;}if(u.getId&&u.getId().indexOf("--relatedApps")>0){r=i;if(h>0){return true;}}});var l=-1;l=U.getIndexFromInstanceMetadataPath(B[h]);l++;var n={Label:{String:"My new Action"},Action:{String:s.content.newFunctionImport},RecordType:D};if(h<(j||k||r)){n[b]={EnumMember:c};}f.splice(l,0,n);var m=A.createCustomAnnotationTermChange(E,f,g,I);m.targetIndex=h+1;m.parentElementId=P.getId();m.oParentSelector=o;var t=A.createCustomChanges(m);q.extend(true,C.getContent(),t);};return a;},true);
