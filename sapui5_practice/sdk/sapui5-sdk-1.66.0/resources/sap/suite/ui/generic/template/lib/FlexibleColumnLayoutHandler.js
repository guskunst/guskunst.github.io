sap.ui.define(["jquery.sap.global","sap/ui/base/Object","sap/f/FlexibleColumnLayoutSemanticHelper","sap/f/library"],function(q,B,F,f){"use strict";var L=f.LayoutType;function o(O){sap.ui.require(["sap/suite/ui/generic/template/lib/routingHelper"],O);}var r=Promise.resolve();var d=2;var c=["begin","mid","end"];var m=["messagePageBeginColumn","messagePageMidColumn","messagePageEndColumn"];function t(i){return c[i]?i:d;}function g(i){return c[t(i)]+"ColumnPages";}function a(C){for(var i=0;i<c.length;i++){C(m[i],g(i));}}function b(v){return m[t(v)];}function e(i){return c[t(i)];}function h(T){var i;if(T instanceof sap.ui.table.Table){i=T.getRows();}else if(T instanceof sap.m.Table){i=T.getItems();}return i;}function j(T){var i=h(T);var R=i?i[0]:false;return R;}function k(s){return(s&&(q.isArray(s.FCLLayout)?s.FCLLayout.sort()[0]:s.FCLLayout))||"";}function l(n,N){var M=N.oTemplateContract.oAppComponent.getConfig();var p=M.settings.flexibleColumnLayout;var s=F.getInstanceFor(n,p);var D=s.getDefaultLayouts();var u;var U;var C;var S;var v=-1;var T=N.oTemplateContract;var w=sap.ui.Device.system.phone?1:(p.maxColumnsCount||3);var x=w>1&&p.initialColumnsCount===2;var y=p.displayNextObjectAfterDelete===true;function z(i){return i.fCLLevel===1||i.fCLLevel===2||(i.level===0&&x);}function A(i){if(i.fCLLevel===3||(i.fCLLevel===0&&i.level>0)){return 1;}var s1=p.initialColumnsCount||1;var t1=Math.max(i.fCLLevel+1,s1);return sap.ui.Device.system.tablet&&t1>2?2:t1;}function E(i,s1,t1,u1){var v1=A(u1);i.showBeginColumn=u1.fCLLevel===0||v1>1;i.showMidColumn=u1.fCLLevel===1||v1>1;i.showEndColumn=u1.fCLLevel>1;if(v1===1){i.target=s1;}else if(u1.level===0){i.target=[s1,i.pages[0].entitySet];}else{i.target=t1.concat([s1]);}return g(u1.fCLLevel);}function G(i,s1){if(i===L.OneColumn&&x){return false;}var t1=s1&&T.mRoutingTree[N.removeQueryInRouteName(s1)];var u1=t1&&t1.defaultLayoutType;if(u1){return i===u1;}return i===D.defaultLayoutType||i===D.defaultTwoColumnLayoutType||i===D.defaultThreeColumnLayoutType;}function H(i,s1,t1){var u1=T.mRouteToTemplateComponentPromise[t1];if(u1){return u1.then(function(v1){return N.activateOneComponent(s1,i,v1);});}return r;}function I(i){var s1=function(t1,u1){if(!u){u1();return;}o(function(v1){var w1={};var x1=N.removeQueryInRouteName(u.event.getParameter("config").name);var y1=true;for(var z1=T.mRoutingTree[x1];y1;z1=T.mRoutingTree[z1.parentRoute]){var A1=z1.fCLLevel;var B1=e(A1);w1[B1]={route:z1.sRouteName,path:v1.determinePath(z1,u.event,i)||"",isVisible:A1>2||U.columnsVisibility[B1+"Column"]};y1=A1===1||A1===2;}t1(w1);});};return new Promise(s1);}function J(i,s1){var t1=I();return t1.then(function(u1){var v1=[];s1=s1||u1;for(var w1 in s1){var x1=u1[w1];if(x1.isVisible){v1.push(H(i,x1.path,x1.route));}else{var y1=T.oTemplatePrivateGlobalModel.getProperty("/generic/routeLevel");var z1=T.mRoutingTree[x1.route];var A1=(y1===z1.level)?2:(3+X(C));N.setVisibilityOfRoute(x1.route,A1);}}return Promise.all(v1).then(N.afterActivation);});}function K(i){var s1=N.getActivationInfo();J(s1,i);}function O(){return!(U.columnsVisibility.beginColumn?U.columnsVisibility.midColumn:U.columnsVisibility.midColumn&&U.columnsVisibility.endColumn);}function P(i){var s1=s.getCurrentUIState();var t1={};t1.end=U&&(U.columnsVisibility.endColumn!==s1.columnsVisibility.endColumn);t1.mid=U&&(U.columnsVisibility.midColumn!==s1.columnsVisibility.midColumn);t1.begin=U&&(U.columnsVisibility.beginColumn!==s1.columnsVisibility.beginColumn);U=s1;T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/midActionButtons",{fullScreen:U.actionButtonsInfo.midColumn.fullScreen!==null,exitFullScreen:U.actionButtonsInfo.midColumn.exitFullScreen!==null,closeColumn:U.actionButtonsInfo.midColumn.closeColumn!==null});T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/endActionButtons",{fullScreen:U.actionButtonsInfo.endColumn.fullScreen!==null,exitFullScreen:U.actionButtonsInfo.endColumn.exitFullScreen!==null,closeColumn:U.actionButtonsInfo.endColumn.closeColumn!==null});var u1=N.getCurrentIdentity();var v1=u1&&u1.treeNode;if(u1){var w1=O();var x1=v1.level-(v1.fCLLevel===2&&!U.columnsVisibility.endColumn);var y1=x1-(x1>1&&!w1)-(U.columnsVisibility.endColumn&&U.columnsVisibility.beginColumn&&x1>2);T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/isVisuallyFullScreen",w1);T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/highestViewLevel",x1);T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL/lowestDetailViewLevel",y1);}if(u1&&C!==U.layout){var z1=G(U.layout,v1.sRouteName)?null:U.layout;N.navigateByExchangingQueryParam("FCLLayout",z1);}else if((t1.begin||t1.mid||t1.end)&&!i){K(t1);}}function Q(i,s1){i=q.extend({},i);var t1=i.getParameter("name");u={name:t1,arguments:i.getParameter("arguments"),event:i};if(z(s1.treeNode)){C=(k(s1.appStates))||s1.treeNode.defaultLayoutType;if(!C){switch(s1.treeNode.fCLLevel){case 0:var u1=s.getNextUIState(0).columnsVisibility;if(u1.midColumn){C=D.defaultTwoColumnLayoutType;}else{C=D.defaultLayoutType;N.navigateByExchangingQueryParam("FCLLayout",C);}break;case 1:C=D.defaultTwoColumnLayoutType;break;case 2:C=D.defaultThreeColumnLayoutType;}}}else{C=s1.treeNode.fCLLevel===0?D.defaultLayoutType:L.EndColumnFullScreen;}n.setLayout(C);}function R(i,s1,t1,u1){v=-1;u.path=t1;u.routeConfig=s1;if(u1){P(true);return J(u1);}}function V(i,s1){return i||s1.defaultLayoutType||s.getNextUIState(s1.fCLLevel).layout;}function W(i,s1){return G(i,s1)?{}:{FCLLayout:[i]};}function X(i){return i===L.EndColumnFullScreen||i===L.MidColumnFullScreen;}function Y(i){return i===L.ThreeColumnsBeginExpandedEndHidden||i===L.ThreeColumnsMidExpandedEndHidden;}function Z(i,s1,t1,u1){if(!i.componentId){return;}var v1=null;var w1=N.getApplicableStateForComponentAddedPromise(i.componentId,v1,u1);t1.push(w1);}function $(i,s1,t1){var u1=W(s1,i.sRouteName);var v1=[];if(!Y(s1)){Z(i,t1,v1,u1);}if(!X(s1)){for(var w1=i;w1.fCLLevel>0;){w1=T.mRoutingTree[w1.parentRoute];Z(w1,t1,v1,u1);}}return Promise.all(v1).then(function(){return u1;});}function _(i,s1){var t1=i.fCLLevel===1?U.actionButtonsInfo.endColumn.closeColumn:L.OneColumn;q.extend(s1,W(t1,i.sRouteName));var u1=[];for(var v1=i;v1;v1=v1.fCLLevel&&T.mRoutingTree[v1.parentRoute]){u1.push(N.addUrlParameterInfoForRoute(v1.sRouteName,s1));}return Promise.all(u1);}function a1(i){if(i===0){return L.OneColumn;}else if(i===1){return L.MidColumnFullScreen;}else if(i===2){return L.EndColumnFullScreen;}else{return"";}}function b1(s1,t1){var u1=T.mRoutingTree[s1];if(!z(u1)){return null;}var v1=V(S,u1);q.extend(t1,W(v1,s1));S=null;if(X(v1)){return null;}var w1=[];for(var i=u1.fCLLevel;i>0;i--){var x1=u1.parentRoute;w1.push(N.addUrlParameterInfoForRoute(x1,t1));u1=T.mRoutingTree[x1];}return Promise.all(w1);}function c1(i,s1){if(i.treeNode.fCLLevel===0||i.treeNode.fCLLevel===3){return true;}var t1=V(k(i.appStates),i.treeNode);var u1=V(k(s1.appStates),s1.treeNode);return X(t1)===X(u1);}function d1(i,s1,t1){T.oApplicationProxy.performAfterSideEffectExecution(function(){var u1=e(i.fCLLevel);var v1=U.actionButtonsInfo[u1+"Column"][s1];var w1=t1?T.mRoutingTree[i.parentRoute]:i;var x1=N.getCurrentIdentity();var y1=$(w1,v1,x1.keys);var z1=y1.then(function(A1){N.navigateToIdentity({treeNode:w1,keys:(w1===x1.treeNode)?x1.keys:x1.keys.slice(0,w1.level+1),appStates:A1});});T.oBusyHelper.setBusy(z1);},true);}function e1(i){return{onCloseColumnPressed:d1.bind(null,i,"closeColumn",true),onFullscreenColumnPressed:d1.bind(null,i,"fullScreen",false),onExitFullscreenColumnPressed:d1.bind(null,i,"exitFullScreen",false)};}T.oTemplatePrivateGlobalModel.setProperty("/generic/FCL",{});function f1(i){var s1=T.mEntityTree[i.entitySet];var t1=T.oNavigationControllerProxy.getCurrentIdentity();var u1=t1.treeNode;return s1.level>u1.level;}function g1(i){C=s.getNextUIState(i).layout;n.setLayout(C);}function h1(){return!O();}function i1(i,s1){var t1=0;for(var u1 in s1){var v1=T.mRoutingTree[u1];if(v1.level>=i.viewLevel&&s1[u1]===1){if(v1.level===i.viewLevel){t1=v1.fCLLevel;}s1[u1]=5+(v1.level>i.viewLevel);}}v=t(t1);g1(t1);var w1=N.oRouter.getTargets();var x1=b(t1);w1.display(x1);}function j1(i){if(i<v||v<0){return U.columnsVisibility[e(i)+"Column"];}return false;}function k1(i,s1){if(!z(s1)){return;}var t1=a1(s1.level);if(G(t1,s1.sRouteName)){return;}i.FCLLayout=[t1];}function l1(){return w;}function m1(i,s1){if(!x){return;}var t1=false;var u1=s.getNextUIState(0).columnsVisibility;if(u1.midColumn){var v1=N.getCurrentIdentity();var w1=v1&&v1.treeNode;t1=w1&&w1.level===0&&k(v1.appStates)!==L.OneColumn;}if(t1){if(i){s1(i);}else{N.navigateByExchangingQueryParam("FCLLayout",L.OneColumn);}}}function n1(){return y;}function o1(){return x;}function p1(i,s1){var t1=j(i);m1(t1,s1);}function q1(i){if(i>2){S="";}else{S=a1(i);}}function r1(i){var s1={};if(i.fCLLevel===1||i.fCLLevel===2){s1.oActionButtonHandlers=e1(i);}if(i.level===0){s1.handleDataReceived=(o1&&o1())?p1:q.noop;s1.isListAndFirstEntryLoadedOnStartup=o1;}return s1;}n.attachStateChange(P.bind(null,false));return{adaptRoutingInfo:E,createMessagePageTargets:a,displayMessagePage:i1,isLevelActive:j1,handleBeforeRouteMatched:Q,handleRouteMatched:R,areIdentitiesLayoutEquivalent:c1,getAppStatesPromiseForColumnClose:_,getFCLAppStatesPromise:b1,isNewHistoryEntryRequired:f1,adaptBreadCrumbUrlParameters:k1,isAppTitlePrefered:h1,getFullscreenLayout:a1,getMaxColumnCountInFCL:l1,isNextObjectLoadedAfterDelete:n1,getFclProxy:r1,isListAndFirstEntryLoadedOnStartup:o1,setStoredTargetLayoutToFullscreen:q1};}return B.extend("sap.suite.ui.generic.template.lib.FlexibleColumnLayoutHandler",{constructor:function(i,n){q.extend(this,l(i,n));}});});
